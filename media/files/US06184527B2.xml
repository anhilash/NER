<?xml version="1.0" encoding="UTF-8"?>
<questel-patent-document lang="en" date-produced="20180805" produced-by="Questel" schema-version="3.23" file="US06184527B2.xml">
  <bibliographic-data lang="en">
    <publication-reference publ-desc="Granted patent as second publication">
      <document-id>
        <country>US</country>
        <doc-number>06184527</doc-number>
        <kind>B2</kind>
        <date>20010206</date>
      </document-id>
      <document-id data-format="questel">
        <doc-number>US6184527</doc-number>
      </document-id>
    </publication-reference>
    <original-publication-kind>B2</original-publication-kind>
    <application-reference is-representative="YES" family-id="25440280" extended-family-id="42112319">
      <document-id>
        <country>US</country>
        <doc-number>08918373</doc-number>
        <kind>A</kind>
        <date>19970826</date>
      </document-id>
      <document-id data-format="questel">
        <doc-number>1997US-08918373</doc-number>
      </document-id>
      <document-id data-format="questel_Uid">
        <doc-number>43170079</doc-number>
      </document-id>
    </application-reference>
    <language-of-filing>en</language-of-filing>
    <language-of-publication>en</language-of-publication>
    <priority-claims>
      <priority-claim kind="national" sequence="1">
        <country>US</country>
        <doc-number>91837397</doc-number>
        <kind>A</kind>
        <date>19970826</date>
        <priority-active-indicator>Y</priority-active-indicator>
      </priority-claim>
      <priority-claim data-format="questel" sequence="1">
        <doc-number>1997US-08918373</doc-number>
      </priority-claim>
    </priority-claims>
    <dates-of-public-availability>
      <publication-of-grant-date>
        <date>20010206</date>
      </publication-of-grant-date>
    </dates-of-public-availability>
    <classifications-ipcr>
      <classification-ipcr sequence="1">
        <text>H01J  40/14        20060101A I20051110RMEP</text>
        <ipc-version-indicator>
          <date>20060101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>H</section>
        <class>01</class>
        <subclass>J</subclass>
        <main-group>40</main-group>
        <subgroup>14</subgroup>
        <classification-value>I</classification-value>
        <generating-office>
          <country>EP</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>M</classification-data-source>
        <action-date>
          <date>20051110</date>
        </action-date>
      </classification-ipcr>
      <classification-ipcr sequence="2">
        <text>H04N   5/33        20060101A I20070721RMEP</text>
        <ipc-version-indicator>
          <date>20060101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>H</section>
        <class>04</class>
        <subclass>N</subclass>
        <main-group>5</main-group>
        <subgroup>33</subgroup>
        <classification-value>I</classification-value>
        <generating-office>
          <country>EP</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>M</classification-data-source>
        <action-date>
          <date>20070721</date>
        </action-date>
      </classification-ipcr>
      <classification-ipcr sequence="3">
        <text>H04N   5/349       20110101A I20130511RHUS</text>
        <ipc-version-indicator>
          <date>20110101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>H</section>
        <class>04</class>
        <subclass>N</subclass>
        <main-group>5</main-group>
        <subgroup>349</subgroup>
        <classification-value>I</classification-value>
        <generating-office>
          <country>US</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>H</classification-data-source>
        <action-date>
          <date>20130511</date>
        </action-date>
      </classification-ipcr>
      <classification-ipcr sequence="4">
        <text>H04N   5/365       20110101A I20130511RHUS</text>
        <ipc-version-indicator>
          <date>20110101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>H</section>
        <class>04</class>
        <subclass>N</subclass>
        <main-group>5</main-group>
        <subgroup>365</subgroup>
        <classification-value>I</classification-value>
        <generating-office>
          <country>US</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>H</classification-data-source>
        <action-date>
          <date>20130511</date>
        </action-date>
      </classification-ipcr>
    </classifications-ipcr>
    <classification-national>
      <country>US</country>
      <main-classification>
        <text>250332000</text>
        <class>250</class>
        <subclass>332000</subclass>
      </main-classification>
      <further-classification sequence="1">
        <text>250208100</text>
        <class>250</class>
        <subclass>208100</subclass>
      </further-classification>
      <further-classification sequence="2">
        <text>250252100</text>
        <class>250</class>
        <subclass>252100</subclass>
      </further-classification>
      <further-classification sequence="3">
        <text>348E05081</text>
        <class>348</class>
        <subclass>E05081</subclass>
      </further-classification>
      <further-classification sequence="4">
        <text>348E05090</text>
        <class>348</class>
        <subclass>E05090</subclass>
      </further-classification>
    </classification-national>
    <patent-classifications>
      <patent-classification sequence="1">
        <classification-scheme office="EP" scheme="CPC">
          <date>20130101</date>
        </classification-scheme>
        <classification-symbol>H04N-005/349</classification-symbol>
        <section>H</section>
        <class>04</class>
        <subclass>N</subclass>
        <main-group>5</main-group>
        <subgroup>349</subgroup>
        <symbol-position>F</symbol-position>
        <classification-value>I</classification-value>
        <classification-status>B</classification-status>
        <classification-data-source>H</classification-data-source>
        <action-date>
          <date>20130101</date>
        </action-date>
      </patent-classification>
      <patent-classification sequence="2">
        <classification-scheme office="EP" scheme="CPC">
          <date>20130101</date>
        </classification-scheme>
        <classification-symbol>H04N-005/33</classification-symbol>
        <section>H</section>
        <class>04</class>
        <subclass>N</subclass>
        <main-group>5</main-group>
        <subgroup>33</subgroup>
        <symbol-position>L</symbol-position>
        <classification-value>I</classification-value>
        <classification-status>B</classification-status>
        <classification-data-source>H</classification-data-source>
        <action-date>
          <date>20130101</date>
        </action-date>
      </patent-classification>
      <patent-classification sequence="3">
        <classification-scheme office="EP" scheme="CPC">
          <date>20130101</date>
        </classification-scheme>
        <classification-symbol>H04N-005/3656</classification-symbol>
        <section>H</section>
        <class>04</class>
        <subclass>N</subclass>
        <main-group>5</main-group>
        <subgroup>3656</subgroup>
        <symbol-position>L</symbol-position>
        <classification-value>I</classification-value>
        <classification-status>B</classification-status>
        <classification-data-source>H</classification-data-source>
        <action-date>
          <date>20130101</date>
        </action-date>
      </patent-classification>
    </patent-classifications>
    <number-of-claims>22</number-of-claims>
    <exemplary-claim>1</exemplary-claim>
    <figures>
      <number-of-drawing-sheets>13</number-of-drawing-sheets>
      <number-of-figures>31</number-of-figures>
      <image-key data-format="questel">US6184527</image-key>
    </figures>
    <invention-title format="original" lang="en" id="title_en">Dither correction for infrared detector arrays</invention-title>
    <references-cited>
      <citation srep-phase="examiner">
        <patcit num="1">
          <text>NAYLOR JR WILLIAM C</text>
          <document-id>
            <country>US</country>
            <doc-number>5526021</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5526021</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="2">
          <text>DUMAS JEAN</text>
          <document-id>
            <country>US</country>
            <doc-number>5712685</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5712685</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="3">
          <text>O'NEIL WILLIAM F</text>
          <document-id>
            <country>US</country>
            <doc-number>5514865</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5514865</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <nplcit num="1">
          <text>Dithered Scan Detector Compensation, W.F. O'Neil, Proc. IRIS Passive Sensors, vol. 1, 1992.</text>
        </nplcit>
      </citation>
    </references-cited>
    <parties>
      <applicants>
        <applicant data-format="original" app-type="applicant" sequence="1">
          <addressbook lang="en">
            <orgname>Raytheon Company</orgname>
            <address>
              <address-1>Lexington, MA, US</address-1>
              <city>Lexington</city>
              <state>MA</state>
              <country>US</country>
            </address>
          </addressbook>
          <nationality>
            <country>US</country>
          </nationality>
        </applicant>
        <applicant data-format="questel" app-type="applicant" sequence="2">
          <addressbook lang="en">
            <orgname>RAYTHEON</orgname>
          </addressbook>
          <nationality>
            <country>US</country>
          </nationality>
        </applicant>
      </applicants>
      <inventors>
        <inventor data-format="original" sequence="1">
          <addressbook lang="en">
            <name>Young, Ching-ju Jennifer</name>
            <address>
              <address-1>Dallas, TX, US</address-1>
              <city>Dallas</city>
              <state>TX</state>
              <country>US</country>
            </address>
          </addressbook>
          <nationality>
            <country>US</country>
          </nationality>
        </inventor>
      </inventors>
      <agents>
        <agent sequence="1" rep-type="agent">
          <addressbook lang="en">
            <orgname>Baker Botts L.L.P.</orgname>
          </addressbook>
        </agent>
      </agents>
    </parties>
    <examiners>
      <primary-examiner>
        <name>Ham, Seungsook</name>
      </primary-examiner>
    </examiners>
    <lgst-data>
      <lgst-status>EXPIRED</lgst-status>
    </lgst-data>
  </bibliographic-data>
  <abstract format="original" lang="en" id="abstr_en">
    <p id="P-EN-00001" num="00001">
      <br/>
      Methods of calculating gain correction values and offset correction values for detector elements of an infrared detector array, under "abnormal" conditions, such as when the scene is in motion or when-there is dither bias.
      <br/>
      The methods can be adapted for one-dimensional scanning arrays or for two-dimensional staring arrays. (FIGS. 3 and 6).
      <br/>
      The array is mechanically dithered so that two or more neighboring detector elements of the array look at the same location of a scene. (FIG. 3, Step 302; FIG. 6, Step 601).
      <br/>
      Then, the fields of pixel data are processed to calculate a gain correction value and an offset correction value for each detector element. (FIG. 3, Steps 305, 309, and 311; FIG. 6, Steps 603, 607, and 611).
      <br/>
      For each detector element, its gain error and its offset error are calculated from local averages, with the local average for a particular detector element including a term for that detector element as well as terms for its neighboring detector elements.
      <br/>
      The basic method may be modified for scene motion, dither bias, or other abnormal conditions.
    </p>
  </abstract>
  <description format="original" lang="en" id="desc_en">
    <heading>TECHNICAL FIELD OF THE INVENTION</heading>
    <p num="1">The present invention relates generally to infrared detectors, and more particularly to a method of compensating for non uniformities among detector elements of an infrared detector array.</p>
    <heading>BACKGROUND OF THE INVENTION</heading>
    <p num="2">
      Infrared detectors provide thermal images for temperature measurement and heat detection.
      <br/>
      They are used for various applications, such as for military, industrial, and medical applications.
      <br/>
      In its simplest form, an infrared detector is a device, such as a photosensitive diode, that generates an electric current when exposed to infrared radiation.
      <br/>
      This current is dependent on the intensity and wavelength of the radiation and can be used in many different ways to produce an infrared picture.
    </p>
    <p num="3">
      Infrared detectors may be configured as a single element (detector), a small array of elements, a long linear array, or a full two-dimensional array.
      <br/>
      When the detector is a full two-dimensional array, the entire image is recorded at once, and the array is referred to as a "staring" array.
      <br/>
      However, with smaller arrays, the image is scanned over the array.
      <br/>
      The small array requires a serial scan to sweep the image in two-dimensions, whereas the linear array requires a "pushbroom" scan to sweep the image across the array in one dimension.
    </p>
    <p num="4">
      The current produced by an infrared detector is amplified and processed to provide a more useful detector output.
      <br/>
      The processing reduces interference due to external and internal causes, such as electrical noise.
    </p>
    <p num="5">
      The ideal response of an infrared detector array is that each detector element exhibit the same linear voltage response for given temperature changes in the irradiation of the array.
      <br/>
      However, one type interference with a good detector signal is electrical noise due to detector non-uniformity among detector elements.
      <br/>
      The uniformity differences have both spatially and temporally dependent causes.
    </p>
    <p num="6">
      A number of methods have been tried for compensating non uniformity of infrared detector arrays.
      <br/>
      Generally, all involve some sort of data processing.
      <br/>
      Some methods use a uniform calibration source, typically using a chopper and controlled temperature.
      <br/>
      Other methods are scene-based, which means that they use an image comprised of one or more objects or patterns.
      <br/>
      The scene-based methods may be further categorized into mechanical and non-mechanical methods.
    </p>
    <p num="7">
      The "dithered scan" method of non uniformity compensation is a scene-based mechanical method.
      <br/>
      The detector array views a scene through suitable optics.
      <br/>
      During a given time frame, the incident flux is sensed by each detector element.
      <br/>
      At the end of the time frame, the array data is delivered for processing and the array is displaced ("dithered") a fixed distance, typicallly a distance equal to the width or height of one detector element, in either the horizontal or vertical direction.
      <br/>
      The scene flux is assumed-to be stable throughout the dither cycle.
      <br/>
      Thus, during the next time frame, each detector element is exposed to the flux seen by one of its neighbors during the prior time frame.
      <br/>
      These detector pairs can be "linked" analytically, such as by averaging their outputs.
      <br/>
      By a suitable choice of a dither pattern, each detector can be linked with several of its neighbors, to adjust gain and offset differences.
      <br/>
      A dithered scan approach is described in an article by William F. O'Neil, "Dithered Scan Detector Compensation", Proc.
      <br/>
      IRIS Passive Detectors, 1992, Vol. 1, pp. 123-134.
    </p>
    <heading>SUMMARY OF THE INVENTION</heading>
    <p num="8">
      One aspect of the invention is a method of calculating gain correction values to compensate gain errors of detector elements of an infrared detector array, using a dither pattern of said array, where the dither steps have a dither bias.
      <br/>
      A maximum gradiant of the scene being detected is determined.
      <br/>
      For a current detector element, a gain ratio of neighboring detector elements is calculated, these neighboring detector elements having dither paths parallel to the direction of the maximum gradient.
      <br/>
      The gain ratios are averaged, thereby obtaining a gain correction value for the current detector element.
      <br/>
      These calculating and averaging steps are repeated for additional sets of neighboring detector elements, thereby determing a gain correction value for each detector element of the array.
    </p>
    <p num="9">
      Thus, as indicated by the above method, the basic dithered gain correction calculations are modified for dither bias.
      <br/>
      Other modifications may be made for scene motion.
      <br/>
      Offset correction calculations may also be modified for dither bias and scene motion.
      <br/>
      Interpolation methods may be used for partial pixel dithering, where the dither step is different from the pixel dimension.
    </p>
    <heading>BRIEF DESCRIPTION OF THE DRAWINGS</heading>
    <p num="10">
      FIGS 1A and 1B are block diagrams of infrared detector systems in accordance with the invention.
      <br/>
      FIG. 2 illustrates a portion of a scene to be viewed by a one dimensional or two dimensional detector array.
      <br/>
      FIGS. 3A and 3B illustrate the basic steps of the method of the invention, as applied to a one-dimensional array.
      <br/>
      FIGS. 4A and 4B illustrate a one dimensional array with gain errors and its dither motion.
      <br/>
      FIGS. 5A and 5B illustrate a one dimensional array with offset errors and its dither motion.
      <br/>
      FIGS. 6A and 6B illustrate the basic steps of the method of the invention, as applied to a two-dimensional array.
      <br/>
      FIG. 7 illustrates the dither pattern for a two-dimensional array.
      <br/>
      FIG. 8 illustrates a detector element and its neighbors for purposes of gain correction for a two-dimensional array.
      <br/>
      FIG. 9 illustrates a detector element and its neighbors for purposes of offset correction for a two-dimensional array.
      <br/>
      FIGS. 10 and 11 illustrate an alternative dither pattern for offset correction for a two-dimensional array.
      <br/>
      FIGS. 12 and 13 illustrate two more diagonal dither patterns for two-dimensional arrays.
      <br/>
      FIG. 14 illustrates an alternative rectangular dither pattern for offset correction for two-dimensional arrays.
      <br/>
      FIG. 15 illustrates an alternative rectangular dither pattern for gain and offset correction for two-dimensional arrays.
      <br/>
      FIG. 16 illustrates the smoothing of gain errors for a "bland" scene.
      <br/>
      FIGS. 17A-17D illustrate how two detector elements might be exposed to different scene paths, as a result of dither bias.
      <br/>
      FIGS. 18A and 18B illustrate dither bias and its correction.
      <br/>
      FIGS. 19A and 19B illustrate the relationship between a dithered scene and a moving scene.
      <br/>
      FIG. 20 illustrates a dither pattern for non-integer dithering.
      <br/>
      FIG. 21 illustrates the values used for calculating offset correction for non-integer dithering.
    </p>
    <heading>DETAILED DESCRIPTION OF THE INVENTION</heading>
    <p num="11">
      The following description includes a description of a method of calculating gain correction values and offset correction values for infrared detector arrays.
      <br/>
      The array is optically or mechanically dithered so that two or more neighboring detector elements of the array look at the same location of a scene.
      <br/>
      A dither motion occurs once per field so that each new field contains pixel values for the same location of the scene but viewed by a different detector element.
      <br/>
      The scene is assumed stable, so that if there were no gain or offset errors, a pixel value would be the same in both fields even though it was sensed by different detector elements.
      <br/>
      Then, the fields of pixel data are processed to calculate a gain correction value and an offset correction value for each detector element.
      <br/>
      The original fields of pixel data are corrected by multiplying each detector element's response by its gain correction and by subtracting its offset correction.
    </p>
    <p num="12">
      As explained below, for each detector element, the gain and offset errors are calculated from local averages.
      <br/>
      The local average for a particular detector element includes a term for that detector element as well as terms for its neighboring detector elements.
      <br/>
      For offset correction, local averages are calculated for "opposing" sets of neighboring detector elements.
      <br/>
      Gain and offset errors are "smoothed" in successive iterations of the method, making the method equivalent to low pass filtering the errors.
      <br/>
      More specifically, the gain and the offset of each detector element can be expressed in matrix form as �Gain� and �Offset�, respectively.
      <br/>
      These matrices are shifted, summed, and averaged, in operations that can be represented as convolutions.
      <br/>
      The convolutions are with "masks" that result in low pass filtered versions of �Gain� and �Offset�. The process is recursive so that after successive iterations, �Gain� and �Offset� become constant.
    </p>
    <p num="13">
      The following description includes embodiments of the method for one-dimensional and two-dimensional arrays.
      <br/>
      In the one-dimensional method, the dither is in one direction.
      <br/>
      In the two-dimensional method, the dither is in two directions.
      <br/>
      For both methods, the embodiments described herein compute local averages with values from "near neighbor" detector elements, resulting in a filter domain of a certain size.
      <br/>
      In other embodiments, local averages could be computed with a larger "neighborhood", with computations modified accordingly, to provide a larger filter domain.
    </p>
    <p num="14">System Overview</p>
    <p num="15">
      FIG. 1A is a block diagram of a one-dimensional infrared detector system in accordance with the invention.
      <br/>
      A detector array 11A has a number of individual detector elements DA-N.
      <br/>
      In the embodiment of FIG. 1A, array 11A scans horizontally.
      <br/>
      However, as explained below, the invention is easily modified for vertical scanning.
    </p>
    <p num="16">
      Each detector element DA-N of array 11A provides a response signal, indicating flux irradiance, on a separate channel.
      <br/>
      Each channel has an amplifier 12 and an analog-to-digital converter 13 that samples the signal.
      <br/>
      The N data signals are delivered in parallel to processor 14.
      <br/>
      At each time, t, the data received by processor 14 are pixel values representing intensity a given sample time.
    </p>
    <p num="17">
      It is assumed that the detector elements DA-N of array 11A have non-uniform responses.
      <br/>
      That is, at least two of the detectors, and probably all of them to one extent or another, do not provide the same response to a given temperature in the scene.
      <br/>
      The invention is designed to compensate these non uniformities regardless of whether they are linear or non-linear.
    </p>
    <p num="18">
      As indicated by the arrows in FIG. 1A, a dither motion is achieved by displacing array 11A in the vertical direction.
      <br/>
      In a simple implementation of the method, the displacement is equal to the height of one detector element D. This can be accomplished with mechanical stepper motors or other mechanical means known in the art.
      <br/>
      After processing, the image data may be manipulated so that the images register in the same place for display.
    </p>
    <p num="19">
      Processor 14 may be any device capable of performing the mathematical operations described below.
      <br/>
      Therefore, processor 14 might be a general purpose processor programmed to perform the appropriate operations with programming stored in a memory 14a.
      <br/>
      Or processor 14 might be dedicated logic circuitry or of some combination of software and hardware driven devices.
    </p>
    <p num="20">
      The output of processor 14 is a corrected signal, from which an image can be generated.
      <br/>
      The embodiments of this description are designed to provide real time correction for displayed images, but the same method could be used for stored image data.
    </p>
    <p num="21">
      FIG. 1B illustrates the same system as FIG. 1A, but with a two-dimensional array 11B.
      <br/>
      As explained below, for two dimensional arrays, in the example of this description, the dither is in both the vertical and horizontal direction.
      <br/>
      The invention can also be modified for a diagonal dither pattern.
    </p>
    <p num="22">
      FIG. 2 illustrates a portion of a scene to be viewed by a one-dimensional array, such as array 11A, or by a two-dimensional array, such as array 11B.
      <br/>
      The scene is divided into a number of pixels, each representing an area whose irradiance flux is sensed by a detector element of array 11A or 11B.
      <br/>
      For simplicity of illustration, only the pixels sensed by a 4 * 4 portion of detector elements are explicitly illustrated.
      <br/>
      In practice, a number of pixels corresponding to the scan of array 11A or to the size of array 11B comprises an image "field".
      <br/>
      The true flux incident upon each pixel, indexed by (x,y) coordinates, is  PHI  (x,y).
      <br/>
      The pixel values for two adjacent pixels, at (x,y) and at (x+1,y), are shown as being light grey and dark grey, respectively.
    </p>
    <p num="23">
      For a two-dimensional array, such as array 11B of FIG. 1B, the desired response of the array to the scene flux of FIG. 2 can be represented as:
      <br/>
      �Image�=g.� PHI �+o
    </p>
    <p num="24">
      where �Image� is a two-dimensional matrix of the response value of each detector element D and � PHI � is a two-dimensional matrix of values representing the actual scene flux at the location viewed by each detector element D. Each value in � PHI � corresponds to one pixel location in the scene space.
      <br/>
      In this ideal response, gain and offset are global values, g and o.
    </p>
    <p num="25">
      An image corrupted only by fixed pattern noise can be represented as:
      <br/>
      �Image�=�Gain�.� PHI �+�Offset�
    </p>
    <p num="26">
      where �Gain� is a two-dimensional matrix that contains the gain values for each detector element D, and �Offset� is a two-dimensional matrix that contains the offset values for each detector element D. Each value in �Gain� is comprised of the global gain, g, plus the detector element's gain error.
      <br/>
      Each value in �Offset� is comprised of the global offset, o, plus the detector element's offset error.
      <br/>
      Thus, the gain and offset errors can be treated as high frequency components of the image.
    </p>
    <p num="27">
      The dithering technique described below uses dithering and local neighbor averaging to smooth the high frequency components of the �Gain� and �Offset� matrices.
      <br/>
      The gain correction is achieved by multiplying a gain correction term to equalize the response gain ratios between neighboring detector elements.
      <br/>
      Offset correction is achieved by subtracting an offset correction term to reduce the difference between individual detector element responses and the local average responses.
      <br/>
      After gain and offset correction, the image could be represented as:  (Equation image '1' not included in text)
    </p>
    <p num="28">As explained below, the gain and offset correction process recursively corrects the images to achieve smoother and smoother gains and offsets until the following result is achieved:  (Equation image '2' not included in text)</p>
    <p num="29">For a one-dimensional array, such as array 11A of FIG. 1A, the above matrices would be replaced by column vectors.</p>
    <p num="30">Non Uniformity Compensation for One-Dimensional Arrays</p>
    <p num="31">
      FIGS. 3A and 3D illustrates the basic steps of the non uniformity compensation method, as applied to a one-dimensional array.
      <br/>
      The embodiment of FIGS. 3A and 3B is for a horizontally scanning array, such as array 11A of FIG. 1A, most of whose detector elements have an "upper" and a "lower" neighboring detector element.
      <br/>
      The exceptions are the "end" detector elements, for which calculations are modified.
      <br/>
      The embodiment of FIGS. 3A and 3B could be adapted for a vertically scanning array, whose detector elements would have a "left" and a "right" neighboring detector element.
      <br/>
      In the case of either a horizontally or vertically scanning array, the method involves two "near neighbors" of each detector element that is not an end detector element, regardless of whether these near neighbors are "left and right" or "upper and lower" neighbors.
    </p>
    <p num="32">
      In the embodiment of FIGS. 3A and 3B, a horizontally scanning array, such as array 11A receives data column-by-column.
      <br/>
      Both gain and offset corrections are also performed column-by-column, consistent with real time data acquisition and processing.
      <br/>
      Gain correction calculations are performed with data from two adjacent columns of two consecutive fields.
      <br/>
      Offset correction calculations are performed with data from the same column from two consecutive fields.
      <br/>
      For a vertically scanning array, the processing would be equivalently performed on horizontal "rows" of data from left and right neighbors.
    </p>
    <p num="33">
      The calculation of gain and offset correction values is not necessarily synchronous with display of the image.
      <br/>
      In the example of FIGS. 3A and 3B, the iterations for gain correction values are repeated until they are constant, then the iterations for offset correction values are repeated until they are constant, before the image is corrected and displayed.
      <br/>
      Thus, pixel data is received and stored and the method of FIGS. 3A and 3B is performed, before the data is corrected for display.
      <br/>
      Alternatively, uncorrected data and partially corrected data may be displayed as the iterations of FIGS. 3A and 3B are being performed.
      <br/>
      Also, the data may be output for further processing or storage in memory.
      <br/>
      The decision of when to use the correction values to generate a display is a matter of time or memory constraints, or of the overall system configuration.
    </p>
    <p num="34">
      Steps 301-306 are the gain correction part of the method.
      <br/>
      A gain correction value for each detector element is calculated before the offset correction values.
      <br/>
      This is because the offset errors do not affect the gain calculation.
    </p>
    <p num="35">
      Step 301 is receiving the data for a first field.
      <br/>
      A field is a set of data, acquired during a complete horizontal scan of array 11.
      <br/>
      Thus, one field contains the pixel values representing a complete scene.
    </p>
    <p num="36">
      FIG. 4A illustrates Step 301 in simplified form, using a horizontally scanning array 41 and scene 42.
      <br/>
      For simplicity of explanation, array 41 has only three detector elements, DA-C, and scene 42 has only 4 * 4 locations to be represented as pixel values.
      <br/>
      Each location of scene 42 has a "true" flux value, ranging from 1 to 16.
      <br/>
      The gains of the three detector elements, DA, DB, and DC, are 1, 2, and 3, respectively.
      <br/>
      As array 41 scans the first field (i.e., Field 1), it provides pixel values, column-by-column.
      <br/>
      With the detector element gains, the received pixel values (detector outputs) of Field 1 are:  (Equation image '3' not included in text)
    </p>
    <p num="37">As explained below, the detector outputs may also have offset errors, which, for simplicity of explanation, are not included in the above values.</p>
    <p num="38">
      Step 302 is dithering array 41.
      <br/>
      The distance of the dither is the height of one detector element.
      <br/>
      For a horizontally scanned array, such as array 11, the dither is in the vertical direction.
      <br/>
      For a vertically scanned array, the dither would be in the horizontal direction.
      <br/>
      In either case, in this example, the dither is a distance substantially the same as the dimension of one detector element in the cross direction of the scan.
    </p>
    <p num="39">
      FIG. 4B illustrates Step 302.
      <br/>
      The scene is assumed to be substantially stable during the dither, so the scene is illustrated as having the same flux values before and after the dither.
      <br/>
      As a result of the dither, pairs of neighboring detector elements are exposed to the same scene path during the dither cycle.
      <br/>
      For example, both DA and DB receive the scene flux from the second row of scene 42.
    </p>
    <p num="40">
      In a modified version of the method, Step 302 could be performed with fractional dithering, to enhance image resolution.
      <br/>
      For example, the dither could be M the pixel height.
      <br/>
      The new pixel values would then be extrapolated to estimate pixel values that would occur with a full dither.
      <br/>
      These extrapolated pixel values would then be used for calculating correction values.
      <br/>
      In another modified version, the dither could be for a distance equal to the pixel dimension plus a fraction.
      <br/>
      It is also possible to dither in distances of two or more pixel dimensions with calculations modified accordingly.
    </p>
    <p num="41">Step 303a is receiving a second field, here Field 2, with array 41 in its new position as illustrated in FIG. 4B. With the detector element gains, the received pixel values for Field 2 are:  (Equation image '4' not included in text)</p>
    <p num="42">Like the values of Field 1, these values do not include offset errors.</p>
    <p num="43">
      Step 303b is retrieving two adjacent columns of data from each field.
      <br/>
      As an alternative to Steps 303a and 303b, the process could be performed "on the fly" with pairs of columns of data being processed from Field 2 as the field is being scanned.
      <br/>
      Also, the columns whose data is being used for calculations could be spaced rather than adjacent.
    </p>
    <p num="44">
      Step 304 is applying the gain correction values from the previous iteration, if any, to the data for the two columns of the new field (Field 2) and the corresponding data in the previous field (Field 1).
      <br/>
      By "corresponding" is meant the pixel values in the same two columns.
      <br/>
      In the first iteration, there are no previously calculated correction values, but in subsequent iterations, each value will be multiplied by an associated gain correction value.
      <br/>
      By "associated" is meant that the pixel value is corrected with a correction value of the detector element that sensed that pixel value.
      <br/>
      After Step 304, the data for the current two columns of both fields is now gain-corrected with current gain correction values, although it may still contain offset errors.
    </p>
    <p num="45">
      Step 305 is calculating a new gain correction for each detector element.
      <br/>
      In general terms, this calculation involves a computation of a "gain ratio" for each detector element.
      <br/>
      Then, for each detector element, the gain ratios of that detector element and of its two neighbors are averaged.
    </p>
    <p num="46">
      In mathematical terms, Step 305 is performed by computing, for each detector element, a gain correction value from its UN (upper neighbor) gain ratio and its LN (lower neighbor) gain ratio.
      <br/>
      The general form of the gain correction (GC) computation is:  (Equation image '5' not included in text)
    </p>
    <p num="47">
      This calculation is an average of contributing gain ratios.
      <br/>
      The detector element whose gain correction value is being calculated contributes a term, as do its two near neighbors.
      <br/>
      The unity term is equivalent to a gain ratio of 1/1, so that the detector element's own gain is used to determine the average.
      <br/>
      The quotient, 3, is the number of contributing detector elements (the detector element under consideration and its upper and lower neighbors).
    </p>
    <p num="48">Using the data of FIGS. 4A and 4B as a specific example, to begin Step 305, differencing the received pixel values in the first two columns of Field 1 generates the following data:  (Equation image '6' not included in text)</p>
    <p num="49">Differencing the received pixel values in the first two columns of Field 2 generates the following data:  (Equation image '7' not included in text)</p>
    <p num="50">Each difference value is "associated" with a detector element, in the sense that the same detector element detected the two pixel values, from which the difference value was calculated.</p>
    <p num="51">
      The difference values from Fields 1 and 2 are used to obtain gain ratios.
      <br/>
      These ratios compare difference values of neighboring detector elements.
      <br/>
      For each detector element, an upper neighbor (UN) gain ratio and a lower neighbor (LN) gain ratio are computed.
      <br/>
      The following table illustrates how these gain ratios are calculated:
    </p>
    <p num="52">
      --
      <br/>
      --          DELTA 1  DELTA 2            DELTA 1/ DELTA 2  DELTA 2/ DELTA 1
      <br/>
      --                1                --
      <br/>
      --         2      4                2/4     4/2
      <br/>
      --         6      9                6/9     9/6
      <br/>
      --         12                           --
    </p>
    <p num="53">
      Each  DELTA 1/ DELTA 2 value is a UN gain ratio--the difference value associated with a detector element's UN divided by the difference value associated with that detector element.
      <br/>
      Each  DELTA 2/ DELTA 1 value is a LN gain ratio--the difference value associated with a detector element's lower neighbor divided by the difference value associated with that detector element.
    </p>
    <p num="54">
      As an example of calculating these ratios, in Field 2, DB sensed pixel values with a difference value of 4.
      <br/>
      In Field 1, DB 's upper neighbor, DA, sensed pixel values in the same locations but with a difference value of 2.
      <br/>
      Thus, the UN gain ratio for DB is 2/4.
    </p>
    <p num="55">
      As indicated, because DA has no upper neighbor, no UN gain ratio is available for DA.
      <br/>
      Also, because DC has no lower neighbor, DC has no LN gain ratio.
    </p>
    <p num="56">As an example, for detector element DB, the gain correction is calculated as:  (Equation image '8' not included in text)</p>
    <p num="57">where 2/4 is DB 's UN gain ratio and 9/6 is DB 's LN gain ratio.</p>
    <p num="58">
      If a detector element is an "end" detector element, it has either no UN or no LN.
      <br/>
      In this case, when calculating the gain correction value, there are only two contributing detector elements.
      <br/>
      For example, for the "end" detector element, DA, which has no upper neighbor, the gain correction is calculated as:  (Equation image '9' not included in text)
    </p>
    <p num="59">
      where 4/2 is DA 's LN gain ratio.
      <br/>
      Likewise, for the other end detector element, DC, which has no lower neighbor, the gain correction is calculated as:  (Equation image '10' not included in text)
    </p>
    <p num="60">where 6/9 is DC 's UN gain ratio.</p>
    <p num="61">
      The following table sets out the gain correction values obtained as a result of Step 305, based on the first two columns of Fields 1 and 2.
      <br/>
      Each detector element has an associated gain correction value.
      <br/>
      In the next iteration of Step 304, these values will be used to correct the next column of data.  (Equation image '11' not included in text)
    </p>
    <p num="62">
      In step 306, the gain correction values are updated.
      <br/>
      This is accomplished by multiplying the old gain correction values GC (i.e. those updated from the previous iteration) and the gain correction values NEW_GC computed in Step 305.
    </p>
    <p num="63">
      Steps 303b through 306 are repeated for successive pairs of columns of data across the detector array.
      <br/>
      As stated above, the column pairs can be adjacent to each other or spaced.
      <br/>
      The next iteration can re-use one column or use two new columns.
      <br/>
      The iterations are repeated until the calculated gain correction values become substantially constant.
    </p>
    <p num="64">
      Steps 307-316 are the offset correction part of the non-uniformity compensation method.
      <br/>
      The offset correction is performed in two parts.
    </p>
    <p num="65">
      It is assumed that data for at least two fields is stored in memory as a result of the gain correction calculations.
      <br/>
      Continuing the example above, data for Field 1 and Field 2 is available.
      <br/>
      In Step 307, two corresponding columns are retrieved for offset correction calculations.
    </p>
    <p num="66">
      FIGS. 5A and 5B illustrate the same scene as illustrated in FIGS. 4A and 4B, but with the detector elements having offset errors rather than gain errors.
      <br/>
      As in FIGS. 4A and 4B, the scene is assumed to be stable, so the flux values are illustrated as being the same from field-to-field.
      <br/>
      Each detector element is assumed to have an offset error, with detector elements DA, DB, and DC having offset values of 1, 2, and 3, respectively.
      <br/>
      Thus, for the first column of Field 1, the received pixel values are:
    </p>
    <p num="67">
      3
      <br/>
      5
      <br/>
      7
    </p>
    <p num="68">
      where each value is the sum of the "true" pixel value and the offset error of the detector element that sensed it.
      <br/>
      For the first column of Field 2, the received pixel values are:
      <br/>
      2
      <br/>
      4
      <br/>
      6
    </p>
    <p num="69">
      In Step 308, the updated gain correction values from Step 306 and the updated offset correction values calculated in the previous iteration, if any, are applied to the pixel values for the new column in both the new field and the previous field.
      <br/>
      In the first iteration of Step 308, there are no previously computed offset corrections.
      <br/>
      In the next iteration of Step 308, previously computed offset correction values will be available, and will be used to correct the new column of data in both Field 1 and Field 2.
    </p>
    <p num="70">
      In Step 309, offset correction values for each detector element are calculated, using the difference of the output of that detector element and of its upper neighbor.
      <br/>
      These offset correction values are referred to herein as "upper neighbor offset correction values".
      <br/>
      This calculation first determines, for each detector element, the difference between the output of a detector element and the output of the detector element's upper neighbor, at the same location of the scene.
      <br/>
      Using the received values set out above, and assuming the gain correction from Step 308, the UN difference values are:
      <br/>
      - = -
      <br/>
      4-3=1
      <br/>
      6-5=1
    </p>
    <p num="71">
      As indicated, detector element DA has no upper neighbor and thus has no UN difference value.
      <br/>
      Next, for each detector element, its difference value is divided by 2 (the number of contributing detector elements).
      <br/>
      Expressed in mathematical form, each upper neighbor (UN) offset correction (OC) value is calculated as:  (Equation image '12' not included in text)
    </p>
    <p num="72">
      The above offset correction value could be equivalently expressed as a detector element's local average output, subtracted from that detector element's output.
      <br/>
      For example, for DB :  (Equation image '13' not included in text)
    </p>
    <p num="73">where I represents a detector element's output.</p>
    <p num="74">
      For the first iteration, the UN offset correction values are:
      <br/>
      OCA = -
      <br/>
      OCS =1/2=0.4
      <br/>
      OCC =1/2=0.5
    </p>
    <p num="75">
      In Step 310, the UN offset correction values calculated in Step 309 are applied to the output values for the current column in both the new field and the previous field.
      <br/>
      Thus, for Field 1 (the previous field), the corrected outputs are:
      <br/>
      3-0=3
      <br/>
      5-0.5=4.5
      <br/>
      7-0.5=6.5
    </p>
    <p num="76">
      and for Field 2 (the new field), the corrected outputs are:
      <br/>
      2-0=2
      <br/>
      4-05.=3.5
      <br/>
      6-0.5=5.5
    </p>
    <p num="77">
      In Step 311, an offset correction value for each detector element is calculated from the corrected data of Step 310, using the difference of the output of that detector element and its lower neighbor.
      <br/>
      These offset correction values are referred to herein as "lower neighbor offset correction values".
      <br/>
      The upper and lower neighbors are referred to herein as "opposing" neighbors.
    </p>
    <p num="78">
      The lower neighbor offset correction calculation determines, for each detector element, the difference between the corrected output of a detector element and the corrected output of that detector element's lower neighbor, at the same scene location.
      <br/>
      The resulting difference values are:
      <br/>
      3-3.5=-0.5
      <br/>
      4.5-5.5=-1
      <br/>
      - = -
    </p>
    <p num="79">
      As indicated, detector element DC has no lower neighbor and thus has no LN difference value.
      <br/>
      Next, for each detector element, its difference value is divided by 2 (the number of contributing detector elements).
      <br/>
      Expressed in mathematical form, each lower neighbor (LN) offset correction (OC) value is calculated as:  (Equation image '14' not included in text)
    </p>
    <p num="80">
      Like the UN offset correction value calculation, the above LN offset correction value calculation can be equivalently expressed as the local average of a detector element and its lower neighbor, subtracted from that detector element's output.
      <br/>
      For example, for DB :  (Equation image '15' not included in text)
    </p>
    <p num="81">where I represents a detector element's output.</p>
    <p num="82">Thus, the LN offset correction values are:  (Equation image '16' not included in text)</p>
    <p num="83">In Step 312, these offset correction values are applied to the current column of data in both the previous field and the current field.</p>
    <p num="84">In Step 313, the offset correction values are updated by adding to the old offset correction (i.e., that of the previous iteration) the UN offset correction value calculated in Step 309 and the LN offset correction value calculated in Step 311.</p>
    <p num="85">
      Steps 307-313 are repeated, column by column, until the offset correction values are substantially constant.
      <br/>
      The successive columns can be adjacent or spaced.
    </p>
    <p num="86">In Step 314, the gain and offset correction values are now used to correct the data in Field n and Field n+1 for display.</p>
    <p num="87">
      Step 315 is correcting for "dead" detector elements, which are those that do not detect a signal or can otherwise be known to be defective.
      <br/>
      A pixel value sensed by another detector element in an adjacent field can be substituted for the pixel value that should have been detected by the dead detector element.
      <br/>
      For example, if DA were dead, the pixel value detected by its lower neighbor DB in Field 2 can be substituted for the same pixel in Field 1.
    </p>
    <p num="88">
      The data for the current column has now been both gain corrected and offset corrected and is now ready for display.
      <br/>
      In Step 316, Fields n and n+1 are displayed.
    </p>
    <p num="89">Non Uniformity Compensation for Two-Dimensional Arrays</p>
    <p num="90">
      The dithered scan method of non uniformity compensation can be used with two-dimensional arrays, as well as one-dimensional arrays.
      <br/>
      In the case of a two-dimensional array, most of its detector elements have adjoining (i.e. "near") neighbors on all four sides.
      <br/>
      The exceptions are the detector elements on the first and last columns and the first and last rows.
      <br/>
      These "end" detector elements have only three neighbors, and in the case of corner detector elements, they have only two neighbors.
      <br/>
      Also, each detector element has other detector elements that touch at its corners and that can also be considered neighbors.
      <br/>
      As explained below, for a two-dimensional array, gain correction calculations use local averages of gain ratios of each detector element and its four adjoining neighbors, whereas offset correction calculations use local averages of outputs of each detector element and of its four adjoining neighbors and of two of its corner neighbors.
    </p>
    <p num="91">
      FIGS. 6A and 6B illustrate the basic steps of the method, as applied to a two-dimensional array.
      <br/>
      As indicated below, both gain correction and offset correction require data from a number of time-contiguous fields.
      <br/>
      Gain correction uses data from four fields and offset correction uses data from six fields.
      <br/>
      However, the dither pattern is the same so that gain correction and offset correction may use the same input data.
    </p>
    <p num="92">
      Steps 601-604 are the gain correction part of the method.
      <br/>
      Step 601 is receiving four dithered fields of pixel values.
      <br/>
      The dither pattern is box-shaped, so that each detector element views four scene locations during a dither cycle.
      <br/>
      At the end of the cycle, the array is in its original position.
      <br/>
      Each dither is assumed to be the height or width of one detector element, but as discussed above in connection with FIG. 3, fractional dithering could be used to enhance resolution.
      <br/>
      Also, the dither could be for a distance of more than one pixel dimension or of fractional parts thereof.
      <br/>
      The dither could also be diagonal, with the selection of neighbors modified accordingly.
    </p>
    <p num="93">
      FIG. 7 illustrates the dithering motion of Step 601.
      <br/>
      Four positions of a single detector element, DA, are shown, one position for each of four fields.
      <br/>
      The four fields are identified as Fields1-4.
      <br/>
      At each dither position, a new pixel value is acquired representing the flux intensity as sensed by DA.
      <br/>
      During the four field times, each detector element of the array undergoes a similar dither pattern, and acquires a pixel value from a different location.
      <br/>
      Thus, after one dither cycle, four fields of pixel data have been acquired.
      <br/>
      As with the one-dimensional array, the dither causes neighboring detector elements to be exposed to the same scene path.
    </p>
    <p num="94">
      Step 602 is correcting the pixel values for the four fields with gain correction values calculated in the previous iteration.
      <br/>
      In the first iteration, there are no previously calculated values, and the initial gain correction value is 1.
    </p>
    <p num="95">
      Step 603 is calculating a new gain correction for each detector element.
      <br/>
      In general, this calculation first involves a computation of a gain ratio for each detector element.
      <br/>
      Then, for each detector element, the gain ratios of that detector element and of its four neighbors are averaged.
    </p>
    <p num="96">
      FIG. 8 illustrates DA with its four neighbors, DB, DC, DD, and DE, during each of the four fields of FIG. 7.
      <br/>
      As stated above, it is assumed that the flux is stable during the four-field dither cycle.
      <br/>
      In Field,, DA detects the flux value,  PHI  (x,y) . In Field2, DA has moved one space to the right and detects the flux value  PHI  (x+1, y).
      <br/>
      In Field3, DB is now in position to detect the flux value  PHI  (x+1,y) Finally, in Field4, DB detects the flux value  PHI  (x,y).
    </p>
    <p num="97">The following table sets out the responses of FIG. 8, where G is the gain and O is the offset for a detector element:</p>
    <p num="98">
      --
      <br/>
      -- Field          DA              DB
      <br/>
      -- 1              GA  *   PHI (x, y) + OA
      <br/>
      -- 2              GA  *   PHI (x + 1, y) + OA
      <br/>
      -- 3                                   GB  *   PHI (x + 1, y) +
      <br/>
      --  OB
      <br/>
      -- 4                                   GB  *   PHI (x, y) +
      <br/>
      --  OB
    </p>
    <p num="99">
      For each detector element, the difference between two adjacent flux values detected by that detector element is calculated.
      <br/>
      For DA, the difference value is:
      <br/>
      DELTA A =(GA. PHI  (x,y)+OA)-(GA. PHI  (x+1,y)+OA)
    </p>
    <p num="100">
      and for DB, the difference value is:
      <br/>
      DELTA B =(GB. PHI  (x+1,y)+OB)-(GB. PHI  (x,y)+OB).
    </p>
    <p num="101">The gain ratio between detector elements DA and DB is:  (Equation image '17' not included in text)</p>
    <p num="102">Similar gain ratios can be calculated for any pair of neighboring detector elements.</p>
    <p num="103">
      The gain correction for DA is derived from the gain ratios of DA and of its four neighbors.
      <br/>
      In mathematical terms, the gain correction for DA is described by:  (Equation image '18' not included in text)
    </p>
    <p num="104">Similar calculations can be made to obtain a gain correction value for each detector element.</p>
    <p num="105">
      Step 604 is updating the gain correction values by multiplying the newly calculated gain correction values and the old gain correction values.
      <br/>
      If each detector element's output were multiplied by its gain correction, the result would be a corrected output value.
      <br/>
      For example, after Step 604, DA 's pixel value is:  (Equation image '19' not included in text)
    </p>
    <p num="106">
      Using matrix notation, the gain correction calculations can be described in terms of the entire array.
      <br/>
      The scene flux collected by the array during a four-field dither cycle can be depicted as � PHI �, � PHI �-, � PHI �-.Arrow-up bold., and � PHI �.Arrow-up bold., where each arrow indicates the scene location relative to the initial location.
      <br/>
      The responses -of the detector elements during the dither cycle are represented by four image matrices: �IField1 �, �IField2 �, �IField3 �, and �IField4 �. Thus:  (Equation image '20' not included in text)
    </p>
    <p num="107">
      The difference values for Fields 1 and 2 are calculated as:
      <br/>
      �IField 1 �-�IField 2 �=�Gain�.(� PHI �-� PHI � --&gt; )
    </p>
    <p num="108">and the shifted image difference values for Fields 3 and 4 are:  (Equation image '21' not included in text)</p>
    <p num="109">
      which is equivalent to:
      <br/>
      �IField 4 �.dwnarw.-�IField 3 �.dwnarw.=�Gain�.dwnarw..(� PHI �-� PHI � --&gt; )
    </p>
    <p num="110">This operation is the same as that used to obtain  DELTA A and  DELTA B, as described above for detector elements DA and DB.</p>
    <p num="111">From the above difference and shifted difference equations, the gain ratios between neighboring detector elements can be calculated as:  (Equation image '22' not included in text)</p>
    <p num="112">which is the same calculation described above for obtaining gain rationA,B.</p>
    <p num="113">The gain ratios for other pairs of detector elements are:  (Equation image '23' not included in text)</p>
    <p num="114">The gain correction may be defined as the averaged sum of the gain ratios:  (Equation image '24' not included in text)</p>
    <p num="115">
      The convolution operation on the �Gain� matrix (in braces) represents the shifted, summed, and averaged �Gain� matrix.
      <br/>
      The operation of convolution with the diamond-shaped mask results in a spatially smoothed (two-dimensionally filtered) version of the �Gain� matrix.
    </p>
    <p num="116">
      For end detector elements, including those at the corners, the calculations are modified.
      <br/>
      In a manner analogous to calculating gain corrections for the end detector elements of a one-dimensional array, only the values of available neighbors are part of the local average.
    </p>
    <p num="117">Steps 601-604 are repeated, using successive sets of four fields of data, until the gain correction values become substantially constant.</p>
    <p num="118">
      Referring again to FIGS. 6A and 6B, after the gain correction values are calculated, Steps 605-612 are performed for offset correction values.
      <br/>
      The same dither pattern is used for offset correction as for gain correction.
      <br/>
      However, for each detector element, two additional neighbors are used, as compared to those used for gain correction.
    </p>
    <p num="119">
      FIG. 9 illustrates the neighbor detector elements used to estimate the offset correction for DA.
      <br/>
      As indicated, DA has three lower left neighbors (LLNS), which are DB, DC, and DD, and three upper right neighbors (URNs), which are DE, DF, and DG.
      <br/>
      Although the following description is in terms of these sets of neighboring detector elements, it should be understood that the method could be modified so as to use upper left neighbors and lower right neighbors.
      <br/>
      In both cases, the two sets of neighboring detector elements are in opposing corners, and are referred to herein as "opposing" sets of neighbors.
      <br/>
      Also, the method could be modified so that the two sets of neighboring detector elements are comprised of some number of detector elements other than three.
    </p>
    <p num="120">
      Referring to FIGS. 6A and 6B and to FIG. 9, offset correction is performed in two parts.
      <br/>
      First, in Step 605, the offset correction for each detector element is calculated with pixel values from the detector element and its LLNs.
      <br/>
      This data is in Fieldn through Fieldn+3.
      <br/>
      If these offset correction values were applied, the result would be a residual offset error for each detector element.
      <br/>
      These residual offset errors are further corrected with pixel values from the detector element and its URNs.
      <br/>
      This data is in Fieldn+2 through Fieldn+5.
    </p>
    <p num="121">
      Referring again to FIG. 2 and to FIG. 9, during each four-field dither cycle, a detector element views the same scene location as three of its neighbors.
      <br/>
      The following table sets out the scene flux incident on DA and its neighbors during Field, through Fieldn+5.
    </p>
    <p num="122">
      --
      <br/>
      --        Scene Flux Locations
      <br/>
      -- Field  DA     DB     DC     DD     DE     DF
      <br/>
      --     DG
      <br/>
      -- n       PHI  (x,y)  PHI  (x - 1,y)  PHI  (x - 1,  PHI  (x,y + 1)
      <br/>
      --                                y + 1)
      <br/>
      -- n + 1  PHI  (x + 1,y)  PHI  (x,y)  PHI  (x,y + 1)  PHI  (x + 1,
      <br/>
      --                                            y + 1)
      <br/>
      -- n + 2  PHI  (x + 1,  PHI  (x,y - 1)  PHI  (x,y)  PHI  (x + 1,y)  PHI  (x +
      <br/>
      --  2,  PHI  (x + 2,  PHI  (x + 1,
      <br/>
      --        y - 1)                                     y - 1) y - 2) y - 2)
      <br/>
      -- n + 3  PHI  (x,y - 1)  PHI  (x - 1,  PHI  (x - 1,y)  PHI  (x,y)  PHI  (x +
      <br/>
      --  1,  PHI  (x + 1,  PHI  (x,y - 2)
      <br/>
      --                    y - 1)                         y - 1) y - 2)
      <br/>
      -- n + 4  PHI  (x,y)                                      PHI  (x + 1,  PHI
      <br/>
      --  (x + 1,  PHI  (x,y - 1)
      <br/>
      --                                                        y)          y - 1)
      <br/>
      -- n + 5  PHI  (x + 1,y)                                      PHI  (x + 2,
      <br/>
      --   PHI  (x + 2,  PHI  (x + 1,
      <br/>
      --                                                        y)          y - 1) y
      <br/>
      --  - 1)
    </p>
    <p num="123">
      During Fieldn through Fieldn+3, DA, DB, DC, and DD, successively viewed the same scene flux,  PHI  (x,y).
      <br/>
      If the assumption is made that the scene is stable during these fields, and if each detector element had the same offset, the four detector elements would have the same responses.
      <br/>
      The gain is assumed to have already been corrected to a constant, g, for all detector elements.
      <br/>
      However, because of the offset errors, there are differences between the detector element responses.
      <br/>
      These differences are the basis of calculating the offset correction.
    </p>
    <p num="124">In Step 606, the data to be used for offset correction calculations is corrected with the previously calculated gain correction values and with any previously calculated offset correction values.</p>
    <p num="125">
      In Step 607, the offset corrections from the LLNs are calculated.
      <br/>
      These offset corrections are referred to herein as "LLN offset corrections".
      <br/>
      For DA, the calculation is as follows:  (Equation image '25' not included in text)
    </p>
    <p num="126">where  (Equation image '26' not included in text)</p>
    <p num="127">By substitution,  (Equation image '27' not included in text)</p>
    <p num="128">
      The offset correction is updated in Step 608 by adding it to any previously calculated offset correction.
      <br/>
      As an example of the corrected data at this point, if DA 's response were corrected by subtracting its offset correction, DA 's corrected response would be:  (Equation image '28' not included in text)
    </p>
    <p num="129">
      At this point, DA has a residual offset, which is the spatial average of offsets from DA and its LLNs, DB, DC, DD.
      <br/>
      Similar calculations are made for each detector element.
    </p>
    <p num="130">
      Using matrix notation, the offset correction can be described in terms of the entire array.
      <br/>
      At the end of the dither cycle, four image fields are received and are shifted as:  (Equation image '29' not included in text)
    </p>
    <p num="131">The LLN offset correction is defined as:  (Equation image '30' not included in text)</p>
    <p num="132">When subtracting the offset correction term from the image, the residual offset becomes:  (Equation image '31' not included in text)</p>
    <p num="133">
      Mathematically, the smoothing of offset errors is the same as convolving the offset matrix with a rectangular mask.
      <br/>
      Recursively applying offset corrections to the images is like a low pass filtering process to the offset noise, which will eventually smooth out the high frequency components of the �Offset� matrix.
    </p>
    <p num="134">
      In Steps 609-612, DA is grouped with its URNs, DE, DF, and DG, to calculate its URN offset correction.
      <br/>
      Referring to the table above, these detector elements receive the scene flux value  PHI  (x+1,y-1) in Fieldn+2 through Fieldn+5.
      <br/>
      These are the four fields retrieved in Step 609.
      <br/>
      The output values in these fields are corrected in Step 610 with current gain and offset correction values.
      <br/>
      In Step 611, an analogous calculation as described above for LLNs can be used for URNs, where the offset correction for DA is calculated by averaging the offset error of DA with those of DE, DF, and DG.
      <br/>
      The offset correction values are again updated in Step 612.
    </p>
    <p num="135">
      Steps 605-612 are repeated for every four 20 successive fields, alternating the LLN and URN corrections.
      <br/>
      The alternating corrections ensure that end detector elements are corrected at least once by at least one neighbor.
    </p>
    <p num="136">
      For offset errors introduced by dither bias, a weighting factor can be applied to the correction value during the offset correction loops.
      <br/>
      The weighting factor,  ALPHA &lt;1, is applied such that only fractions of the calculated offset errors are corrected.
      <br/>
      The combination of a small weighting factor and the alternating neighbor calculations will cancel correction errors introduced by dither bias and/or scene motion.
    </p>
    <p num="137">
      A variety of dither patterns, single steps of multi-step loops, with either vertical, horizontal, or diagonal steps, can be chosen for offset correction.
      <br/>
      The common feature of the various dither patterns is that a number of neighboring detector elements are exposed to the same scene flux during a correction cycle.
      <br/>
      For the rectangular dither pattern described above, corrections can also be calculated with different combinations of neighboring detector elements.
      <br/>
      For example, fields 1 and 2 (with a single horizontal dither step) could be used to correct offset errors using left neighbors, followed by right neighbors.
      <br/>
      Then, fields 2 and 3 (with a single vertical dither step) could be used to correct offset errors using down neighbors, followed by up neighbors, etc.
    </p>
    <p num="138">
      FIGS. 10 and 11 illustrate an alternative dither pattern for offset correction.
      <br/>
      The pattern is diagonal, and in the example of FIG. 10 is upper right diagonal/return/upper left diagonal/return.
      <br/>
      FIG. 11 illustrates DA and its four diagonal neighbors, DB, DC, DD, and DE.
      <br/>
      During a four-field dither cycle, DA views three different scene pixels and its four diagonal neighbors also view one or two of the three scene pixels in the same cycle.
      <br/>
      Local differences are calculated from values of that detector element and its four neighbors to obtain offset corrections.
    </p>
    <p num="139">
      FIGS. 12 and 13 illustrates two other diagonal dither patterns.
      <br/>
      These patterns may be used for both gain and offset correction.
    </p>
    <p num="140">
      FIG. 14 illustrates an alternative rectangular dither pattern for offset correction.
      <br/>
      FIG. 15 illustrates an alternative dither pattern for gain and offset correction.
    </p>
    <p num="141">Recursive Operation</p>
    <p num="142">
      The process of FIG. 3 (for one dimensional arrays) and FIG. 6 (for two dimensional arrays) may be performed over many iterations.
      <br/>
      Gain corrections are recursively applied to each new image, with each iteration reducing the gain differences among detector elements.
      <br/>
      Likewise, the recursive application of offset corrections to each new image reduces the offset differences among detector elements.
    </p>
    <p num="143">
      In practice, gain non uniformities are not expected to be as big as offset non uniformities, and a rather smoothed gain matrix should be obtained in a few iterations.
      <br/>
      Offset correction is anticipated to be applied continuously.
      <br/>
      Gain errors can be corrected in the beginning of an image sequence, or when there is major change in scene radiance.
      <br/>
      The residual gain errors will also be smoothed out in the offset correction loops.
    </p>
    <p num="144">Dither Correction Issues: Gradient Effects, Dither Bias, and Scene Motion</p>
    <p num="145">
      Gain errors are corrected at the beginning of an image sequence or when there is a major change in scene radiance.
      <br/>
      As discussed above, gain ratios are calculated based on a pair of detector elements seeing the same scene gradiant at different times.
      <br/>
      If there is no local scene gradiant, the gain ratio cannot be obtained and no gain smoothing between the pair of detector elements can be performed.
      <br/>
      However, if there is no local scene gradiant, the residual gain errors can be treated as offset errors that will be smoothed out in the offset correction loops.
    </p>
    <p num="146">
      FIG. 16 illustrates the smoothing of gain errors for a "bland" scene (one with minimal scene gradiant).
      <br/>
      The offset correction will be valid until the scene flux starts to drift away from the flux level when the offset correction factors are estimated.
    </p>
    <p num="147">
      FIGS. 17A-17D illustrate how two detector elements might be exposed to slightly different scene paths, due to a dither bias.
      <br/>
      One path is shown with dotted lines, the other with solid lines.
      <br/>
      Detector element DA follows the path  PHI 1 to  PHI 2, whereas detector element DB follows the path  PHI 1 ' to  PHI 2 '.
    </p>
    <p num="148">
      "Dither bias" occurs when there is an error between the intended and the actual displacement of the dither array.
      <br/>
      It will not cause a major breakdown for the gain ratio calculations as long as the common scene path shared by the neighboring detector elements is parallel to the direction of maximum local scene gradiant.
      <br/>
      This is the case illustrated in FIG. 17A. When there is not enough scene gradiant along the dither path; as shown in FIGS. 17C and 17D, a good gain ratio estimate will be difficult to obtain, with or without dither bias.
      <br/>
      Theshholds can be set based on the direction and degree of the local gradiant, as well as the dither path and dither bias.
    </p>
    <p num="149">
      Scene motion adds complexity to the gain correction process.
      <br/>
      However, scene motion will possibly add another dimension in resolving the gain ratios among the detector elements.
      <br/>
      In other words, the gain ratio that cannot be resolved due to lack of local gradiant in the dithering direction can certainly be estimated if the scene changes so rapidly that the neighboring detector elements are experiencing the same scene dynamics during the same period of time.
    </p>
    <p num="150">
      It is anticipated that the gain correction error will be low if a reasonable threshhold is set to reject the ratios calculated under unstable dithering and/or scene conditions, in which case, the gain correction applied for those pixels can be derived from the last good frame or from a pre-calibration default.
      <br/>
      A weighted gain correction may also be defined such that at each gain correction cycle, the new correction factor will be weighted less ( ALPHA &lt;1).
      <br/>
      This will result in a slower convergence in gain error smoothing, but the randomness of the errors, which are also lowered with the small weight, will eventually be cancelled out over several iterations.  (Equation image '32' not included in text)
    </p>
    <p num="151">
      Perfect dithering is not always possible and usually a fixed bias can be observed and/or measured.
      <br/>
      Random dither error does not cause the dither correction to break down because randomly generated noise tends to be smoothed out over time by the repeated smoothing in the offset correction process.  (Equation image '33' not included in text)
    </p>
    <p num="152">
      FIG. 18A illustrates the effect when a constant fixed positive bias exists in the system.
      <br/>
      The arrows show the dither pattern for detector element DA during one cycle.
      <br/>
      In the first scene, the scene patch seen by DA at time t is shaded, and the areas outlined with dotted lines represent the scene patches seen by DA at later times in the same cycle.
      <br/>
      The scene patches are not connected to each other due to the positive dither bias.
      <br/>
      During the remainder of the cycle, the LL (lower left) neighboring detector elements of DA do not see exactly the same scene that was exposed to DA at time t. Instead, they each see a slightly different scene patch.
      <br/>
      These differences are shaded in the image scenes from t+1 to t+3.
    </p>
    <p num="153">
      The assumption that all neighboring detector elements see the same scene flux is violated, and the offset errors are wrongly estimated and corrected by the flux differences received by DA and by its neighbors.
      <br/>
      However, if there is no local scene gradiant in this region, then there is no flux difference between the dark gray region and the light gray region, and thus no errors will be introduced in the offset correction process.
    </p>
    <p num="154">
      FIG. 18B shows the dither bias effects when the offset correction value for DA is calculated from DA and its upper right (UR) neighboring detector elements.
      <br/>
      The dither bias generated correction error for UR correction has similar magnitude but opposite sign to the error generated during LL neighbor correction.
      <br/>
      The alternating correction pattern effectively cancels out the correction errors introduced by dither motion bias.
    </p>
    <p num="155">A weighting factor ( ALPHA &lt;1) may be also applied during offset correction such that only fractions of the estimated offset errors are corrected at each cycle.  (Equation image '34' not included in text)</p>
    <p num="156">This partial correction results in slightly slower convergence of the true offset errors, but significantly lowers the errors introduced by dithering motion bias.</p>
    <p num="157">
      When the scene moves fast enough, the fixed step dithering fails to line up the neighboring detector elements so that they see exactly the same scene flux during one correction cycle.
      <br/>
      FIGS. 19A and 19B illustrate the relationship between the dithered scene and the moving scene in the simple one-step dithering case.
      <br/>
      In the example of FIGS. 19A and 19B, the detector elements are dithered one scene pixel to the right from time t to t+1.
      <br/>
      At time t+2, detector elements are dithered back (left) to see the same scene at time t. For the stationary scene of FIG. 18A, detector elements DA and DB are exposed to the same scene flux during this time period.
      <br/>
      When the scene starts to move toward the left, the detector elements see slightly different scene fluxes each time.
      <br/>
      If the scene is moving with a constant velocity, and dither is occurring in a regular sample period, the differences between the scene fluxes seen by detectors DA and DB can be predicted as:  (Equation image '35' not included in text)
    </p>
    <p num="158">The basic offset correction formula for the one-step dither case is described as:  (Equation image '36' not included in text)</p>
    <p num="159">The scene compensated offset correction may be defined as:  (Equation image '37' not included in text)</p>
    <p num="160">With proper substitution from the above equations and definitions, the calculated offset correction value for DA becomes:  (Equation image '38' not included in text)</p>
    <p num="161">After applying the scene compensated offset correction to DA 's response, the corrected image response and the residual offset error for DA becomes:  (Equation image '39' not included in text)</p>
    <p num="162">The above derivations prove that if the scene velocity is instantaneously and locally constant, proper averaging of sequential frames will be able to compensate the correction errors resulting from the scene motion in the dither correction process.</p>
    <p num="163">Non-Integer Dithering</p>
    <p num="164">
      "Non-interger dithering" is dithering that is not equal to the dimension of one pixel, either in the horizontal or vertical direction.
      <br/>
      As an example, for half-pixel dithering, the dither equations-for full-pixel dithering can be modified.
      <br/>
      FIG. 20 illustrates a half-pixel dither pattern.
    </p>
    <p num="165">
      For half-pixel dithering, the gain correction uses the same formula as for full pixel dithering as long as the common scene path parallels the direction with maximum scene gradiant.
      <br/>
      The offset correction formulas become:  (Equation image '40' not included in text)
    </p>
    <p num="166">
      Here IB and IC represent the output of two neighboring detector elements, DB and DC of detector DA from opposite directions.
      <br/>
      As indicated, the first term uses non-dithered output values (not from the same location), whereas the second term uses a dithered output value (from the same scene location as the current detector element).
      <br/>
      FIG. 21 illustrates these values in relation to the dither pattern.
    </p>
    <p num="167">Other Embodiments</p>
    <p num="168">
      Although the invention has been described with reference to specific embodiments, this description is not meant to be construed in a limiting sense.
      <br/>
      Various modifications of the disclosed embodiments, as well as alternative embodiments, will be apparent to persons skilled in the art.
      <br/>
      It is, therefore, contemplated that the appended claims will cover all modifications that fall within the true scope of the invention.
    </p>
  </description>
  <claims format="original" lang="en" id="claim_en">
    <claim num="1">
      <claim-text>What is claimed is:</claim-text>
      <claim-text>1.</claim-text>
      <claim-text>A method of calculating gain correction values to compensate gain errors of detector elements of a detector array, using a dither movement of said array, comprising the steps of</claim-text>
      <claim-text>selecting a set of detector elements which includes a current detector element and at least one neighboring detector element; determining whether a gradient of scene information detected by one of the detector elements of the set exceeds a threshold; responding to detection in said determining step of a gradient exceeding the threshold by calculating a gain ratio for detector elements of the set based on dither paths thereof which are substantially parallel to the direction of the gradient exceeding the threshold; generating a gain correction value for the current detector element as a function of the calculated gain ratio;</claim-text>
      <claim-text>and repeating said selecting, determining, responding and generating steps for additional sets of neighboring detector elements which each include a different current detector element, thereby determining a gain correction value for each of a number of the detector elements.</claim-text>
    </claim>
    <claim num="2">
      <claim-text>2. The method of claim 1, wherein said averaging step includes averaging a unity value representing a gain ratio for the current detector element.</claim-text>
    </claim>
    <claim num="3">
      <claim-text>3. The method of claim 1, including the step of effecting a dither movement which includes a dither bias.</claim-text>
    </claim>
    <claim num="4">
      <claim-text>4. The method of claim 1, wherein said responding step includes the step of calculating a further gain ratio for detector elements of the set based on dither paths thereof which are substantially parallel to the direction of the gradient exceeding the threshold;</claim-text>
      <claim-text>and wherein said generating step includes the step of averaging said gain ratios for the current detector element.</claim-text>
    </claim>
    <claim num="5">
      <claim-text>5. The method of claim 1, including the step of calculating for each of the detector elements of the array, based on scene information detected by the array during the dither movement, a respective offset correction value to compensate an offset error of that detector element.</claim-text>
    </claim>
    <claim num="6">
      <claim-text>6. The method of claim 1, including the step of causing said detector array to be responsive to infrared radiation.</claim-text>
    </claim>
    <claim num="7">
      <claim-text>7. A weighted method of calculating gain correction values to compensate gain errors of detector elements of an infrared-detector array, using a dither pattern of said array, comprising the steps of: calculating a gain correction value for a current detector element by calculating gain ratios of a first set of neighboring detector elements of said current detector element; multiplying said gain correction value by a weighting factor,  varies as ; adding to the results of said multiplying step, a correction term of (1- varies as ), thereby obtaining a gain correction value for said current detector element;</claim-text>
      <claim-text>and repeating all of the above steps for additional detector elements, thereby determining a weighted gain correction value for each of a number of current detector elements.</claim-text>
    </claim>
    <claim num="8">
      <claim-text>8. The method of claim 7, wherein said calculating step includes the step of averaging said gain ratios, and wherein said averaging step includes averaging a unity value representing a gain ratio for said current detector element.</claim-text>
    </claim>
    <claim num="9">
      <claim-text>9. A weighted method of calculating offset correction values to compensate offset errors of detector elements of an infrared detector array, using a dither pattern of said array, comprising the steps of: averaging dithered output values from a first set of neighboring detector elements of a current detector element; multiplying the results of said averaging step times a correction factor, said correction factor being a value less than one, thereby obtaining a weighted average; multiplying the output of said current detector element times said correction factor, thereby obtaining a weighted output; subtracting said weighted average from said weighted output, thereby obtaining an offset correction value for said current detector element;</claim-text>
      <claim-text>and repeating all of the above steps for additional sets of neighboring detector elements, thereby determining an offset correction value for a each of a number of current detector elements.</claim-text>
    </claim>
    <claim num="10">
      <claim-text>10. The method of claim 9, wherein said averaging, multiplying, and subtracting steps are performed twice, each time for an opposing set of neighboring detector elements.</claim-text>
    </claim>
    <claim num="11">
      <claim-text>11. The method of claim 9, wherein said averaging step includes averaging the output of said current detector element.</claim-text>
    </claim>
    <claim num="12">
      <claim-text>12. An interpolation method of calculating offset correction values to compensate offset errors of detector elements of an infrared detector array, using a dither pattern of said array where the dither step is a distance different from the dimensions of said detector elements, comprising the steps of: interpolating non-dithered output values of a first set of neighboring detector elements of a current detector element; averaging dithered output values of said neighboring detector elements; subtracting the result of said averaging step from the result of said interpolating step, thereby obtaining an offset correction value for said current detector element;</claim-text>
      <claim-text>and repeating all of the above steps for additional sets of neighboring detector elements, thereby determining offset correction values for a each of a number of current detector elements.</claim-text>
    </claim>
    <claim num="13">
      <claim-text>13. The method of claim 12, wherein said interpolating, averaging and subtracting steps are performed twice, each time for an opposing set of neighboring detector elements.</claim-text>
    </claim>
    <claim num="14">
      <claim-text>14. The method of claim 12, wherein said averaging step includes averaging the output of said current detector element.</claim-text>
    </claim>
    <claim num="15">
      <claim-text>15. A method of determining gain correction values to compensate gain errors of detector elements of a detector array, comprising the steps of: effecting a dither movement of the array while obtaining information from a scene; evaluating for each detector element whether a criterion is satisfied, the criterion being a function of scene information obtained during the dither movement;</claim-text>
      <claim-text>and selectively determining the gain correction values only for those detector elements for which the criterion is satisfied; wherein said evaluating step is carried out by using for a given detector element a criterion which is a function of whether scene information in the region of the given detector element has a gradient which exceeds a threshold.</claim-text>
    </claim>
    <claim num="16">
      <claim-text>16. A method according to claim 15, wherein said selectively determining step includes the step of calculating a gain ratio based on scene information detected by a subset of the detector elements which are in the region of the given detector element, and determining the gain correction value for the given detector element as a function of the calculated gain ratio.</claim-text>
    </claim>
    <claim num="17">
      <claim-text>17. The method of claim 16, wherein said step of calculating the gain ratio is carried out based on scene information corresponding to dither paths which extend parallel to a direction of the gradient which exceeds the threshold.</claim-text>
    </claim>
    <claim num="18">
      <claim-text>18. The method of claim 17, wherein said selectively determining step includes the step of calculating a further gain ratio based on scene information detected by the subset of detector elements, and wherein said step of determining the gain correction value for the given detector element includes the step of averaging the calculated gain ratios that are associated with the given detector element.</claim-text>
    </claim>
    <claim num="19">
      <claim-text>19. The method of claim 18, wherein said subset of detector elements includes the given detector element, and wherein said step of calculating gain ratios includes calculation of at least one gain ratio which is based on scene information detected by the given detector element.</claim-text>
    </claim>
    <claim num="20">
      <claim-text>20. The method of claim 15, including the step of calculating for each of the detector elements of the array, based on scene information detected by the array during the dither movement, a respective offset correction value to compensate an offset error of that detector element.</claim-text>
    </claim>
    <claim num="21">
      <claim-text>21. The method of claim 15, wherein said step of effecting a dither movement includes the dither movement having a dither bias.</claim-text>
    </claim>
    <claim num="22">
      <claim-text>22. The method of claim 15, wherein the detector array is responsive to infrared radiation, and wherein the step of obtaining information from the scene includes the step of measuring infrared information.</claim-text>
    </claim>
  </claims>
</questel-patent-document>