<?xml version="1.0" encoding="UTF-8"?>
<questel-patent-document lang="en" date-produced="20180805" produced-by="Questel" schema-version="3.23" file="US06185301B2.xml">
  <bibliographic-data lang="en">
    <publication-reference publ-desc="Granted patent as second publication">
      <document-id>
        <country>US</country>
        <doc-number>06185301</doc-number>
        <kind>B2</kind>
        <date>20010206</date>
      </document-id>
      <document-id data-format="questel">
        <doc-number>US6185301</doc-number>
      </document-id>
    </publication-reference>
    <original-publication-kind>B2</original-publication-kind>
    <application-reference family-id="13135059" extended-family-id="13742986">
      <document-id>
        <country>US</country>
        <doc-number>09033157</doc-number>
        <kind>A</kind>
        <date>19980302</date>
      </document-id>
      <document-id data-format="questel">
        <doc-number>1998US-09033157</doc-number>
      </document-id>
      <document-id data-format="questel_Uid">
        <doc-number>14039588</doc-number>
      </document-id>
    </application-reference>
    <language-of-filing>en</language-of-filing>
    <language-of-publication>en</language-of-publication>
    <priority-claims>
      <priority-claim kind="national" sequence="1">
        <country>JP</country>
        <doc-number>6019297</doc-number>
        <kind>A</kind>
        <date>19970228</date>
        <priority-active-indicator>Y</priority-active-indicator>
      </priority-claim>
      <priority-claim data-format="questel" sequence="1">
        <doc-number>1997JP-0060192</doc-number>
      </priority-claim>
    </priority-claims>
    <dates-of-public-availability>
      <publication-of-grant-date>
        <date>20010206</date>
      </publication-of-grant-date>
    </dates-of-public-availability>
    <classifications-ipcr>
      <classification-ipcr sequence="1">
        <text>H04B   3/23        20060101A I20051008RMEP</text>
        <ipc-version-indicator>
          <date>20060101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>H</section>
        <class>04</class>
        <subclass>B</subclass>
        <main-group>3</main-group>
        <subgroup>23</subgroup>
        <classification-value>I</classification-value>
        <generating-office>
          <country>EP</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>M</classification-data-source>
        <action-date>
          <date>20051008</date>
        </action-date>
      </classification-ipcr>
    </classifications-ipcr>
    <classification-national>
      <country>US</country>
      <main-classification>
        <text>379406080</text>
        <class>379</class>
        <subclass>406080</subclass>
      </main-classification>
      <further-classification sequence="1">
        <text>370290000</text>
        <class>370</class>
        <subclass>290000</subclass>
      </further-classification>
    </classification-national>
    <classifications-ecla>
      <classification-ecla sequence="1">
        <text>H04B-003/23</text>
        <section>H</section>
        <class>04</class>
        <subclass>B</subclass>
        <main-group>3</main-group>
        <subgroup>23</subgroup>
      </classification-ecla>
    </classifications-ecla>
    <patent-classifications>
      <patent-classification sequence="1">
        <classification-scheme office="EP" scheme="CPC">
          <date>20130101</date>
        </classification-scheme>
        <classification-symbol>H04B-003/23</classification-symbol>
        <section>H</section>
        <class>04</class>
        <subclass>B</subclass>
        <main-group>3</main-group>
        <subgroup>23</subgroup>
        <symbol-position>F</symbol-position>
        <classification-value>I</classification-value>
        <classification-status>B</classification-status>
        <classification-data-source>H</classification-data-source>
        <action-date>
          <date>20130101</date>
        </action-date>
      </patent-classification>
    </patent-classifications>
    <number-of-claims>10</number-of-claims>
    <exemplary-claim>1</exemplary-claim>
    <figures>
      <number-of-drawing-sheets>6</number-of-drawing-sheets>
      <number-of-figures>6</number-of-figures>
      <image-key data-format="questel">US6185301</image-key>
    </figures>
    <invention-title format="original" lang="en" id="title_en">Echo canceler having plurality of adaptive filter circuits</invention-title>
    <references-cited>
      <citation srep-phase="examiner">
        <patcit num="1">
          <text>BOYER KIM L</text>
          <document-id>
            <country>US</country>
            <doc-number>4554417</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US4554417</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="2">
          <text>YATSUZUKA YOUTARO, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5263020</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5263020</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="3">
          <text>SANO HIDEO</text>
          <document-id>
            <country>US</country>
            <doc-number>5313498</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5313498</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="4">
          <text>FURUKAWA HIROKI, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5463618</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5463618</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="5">
          <text>SHAW DAVID G</text>
          <document-id>
            <country>US</country>
            <doc-number>5610909</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5610909</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="6">
          <text>SIH GILBERT C</text>
          <document-id>
            <country>US</country>
            <doc-number>5644596</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5644596</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="7">
          <text>KUBO MASATO</text>
          <document-id>
            <country>US</country>
            <doc-number>5748725</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5748725</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="8">
          <text>ONO YOSHIHIRO, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5859914</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5859914</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="9">
          <text>SUGIYAMA AKIHIKO</text>
          <document-id>
            <country>US</country>
            <doc-number>5867486</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5867486</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="10">
          <text>OH STEPHEN S</text>
          <document-id>
            <country>US</country>
            <doc-number>5937060</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5937060</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="11">
          <text>ISHII TOMOKO, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5960077</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5960077</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="12">
          <text>RASMUSSON JIM AGNE JERKER</text>
          <document-id>
            <country>US</country>
            <doc-number>5978473</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5978473</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="13">
          <text>SIH GILBERT C, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5999828</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5999828</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="14">
          <text>FLANAGAN RICHARD THOMAS, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>6009083</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US6009083</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="15">
          <text>MORI SHINSAKU, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5535149</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5535149</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="16">
          <text>DEGENHARDT ACHIM</text>
          <document-id>
            <country>US</country>
            <doc-number>5828589</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5828589</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="17">
          <document-id>
            <country>DE</country>
            <doc-number>19506324</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>DE19506324</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="18">
          <text>KOKUSAI DENSHIN DENWA CO LTD</text>
          <document-id>
            <country>EP</country>
            <doc-number>0508847</doc-number>
            <kind>A2</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>EP-508847</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <nplcit num="1">
          <text>Patent Abstracts of Japan, "Control System For Voice Switch Used Jointly With Echo Canceler", 0534210 (Dec. 14, 1993), Abstract of Igai Kazunori, 07170337, (Jul. 4, 1995).</text>
        </nplcit>
      </citation>
    </references-cited>
    <parties>
      <applicants>
        <applicant data-format="original" app-type="applicant" sequence="1">
          <addressbook lang="en">
            <orgname>NEC Corporation</orgname>
            <address>
              <address-1>Tokyo, JP</address-1>
              <city>Tokyo</city>
              <country>JP</country>
            </address>
          </addressbook>
          <nationality>
            <country>JP</country>
          </nationality>
        </applicant>
        <applicant data-format="questel" app-type="applicant" sequence="2">
          <addressbook lang="en">
            <orgname>NEC</orgname>
          </addressbook>
          <nationality>
            <country>JP</country>
          </nationality>
        </applicant>
      </applicants>
      <inventors>
        <inventor data-format="original" sequence="1">
          <addressbook lang="en">
            <name>Muraoka, Shinya</name>
            <address>
              <address-1>Tokyo, JP</address-1>
              <city>Tokyo</city>
              <country>JP</country>
            </address>
          </addressbook>
          <nationality>
            <country>JP</country>
          </nationality>
        </inventor>
      </inventors>
      <agents>
        <agent sequence="1" rep-type="agent">
          <addressbook lang="en">
            <orgname>Foley &amp; Lardner</orgname>
          </addressbook>
        </agent>
      </agents>
    </parties>
    <examiners>
      <primary-examiner>
        <name>Hudspeth, David R.</name>
      </primary-examiner>
    </examiners>
    <lgst-data>
      <lgst-status>LAPSED</lgst-status>
    </lgst-data>
  </bibliographic-data>
  <abstract format="original" lang="en" id="abstr_en">
    <p id="P-EN-00001" num="00001">
      <br/>
      In an echo canceler, a first adaptive filter circuit calculates first tap coefficients using a first convergence coefficient, and generates a first pseudo echo signal, and a first subtracter subtracts the first pseudo echo signal from a transmitting signal to generate a first error signal.
      <br/>
      A second adaptive filter circuit calculates second tap coefficients using a second convergence coefficient, and generates a second pseudo echo signal, and a second substrate subtracts the second pseudo echo signal from the transmitting signal to generate a second error signal.
      <br/>
      A control circuit selects one set of the first tap coefficients and the second tap coefficients in accordance with a received signal, the transmitting signal, and the first and second error signals.
      <br/>
      A third adaptive filter circuit generates a third pseudo echo signal in accordance with the set of tap coefficients selected by the control circuit and the received signal, and a third subtracter subtracts the third pseudo echo signal from the transmitting signal to generate a third error signal.
    </p>
  </abstract>
  <description format="original" lang="en" id="desc_en">
    <heading>BACKGROUND OF THE INVENTION</heading>
    <p num="1">
      1.
      <br/>
      Field of the Invention
    </p>
    <p num="2">The present invention relates to an echo canceler for eliminating the echoes generated at a proximal end of a transmission line of a telecommunication system through which speakers at the opposite ends of the line can talk to each other.</p>
    <p num="3">2. Description of the Related Art</p>
    <p num="4">
      In a prior art echo canceler, a single adaptive filter circuit and a single subtractor are provided.
      <br/>
      That is, in this adaptive filter circuit, tap coefficients are calculated in accordance with an error signal and a received signal, and a pseudo echo signal is generated in accordance with the tap coefficients and the received signal.
      <br/>
      Also, the subtracter subtracts the pseudo echo signal from a transmitting signal, thus cancelling echoes in the transmitting signal.
      <br/>
      In the prior art echo canceler, however, when the background noise is large at the proximal end of a line or when it is impossible to determine whether the line is for a 2-wire system or a 4-wire system, the characteristics of detecting double-talk are degraded, and the characteristics of tap coefficients are not stable.
      <br/>
      This will be explained later in detail.
    </p>
    <heading>SUMMARY OF THE INVENTION</heading>
    <p num="5">It is an object of the present invention to provide an echo canceler that can stably provide excellent characteristics of tap coefficients without degrading the characteristics of detecting double-talk, even when the background noise is large at the proximal end of the line or when it is impossible to determine if the line is for a 2-wire system or a 4-wire system.</p>
    <p num="6">
      According to the present invention, in an echo canceler, a first adaptive filter circuit calculates first tap coefficients using a first convergence coefficient, and generates a first pseudo echo signal, and a first subtracter subtracts the first pseudo echo signal from a transmitting signal to generate a first error signal.
      <br/>
      A second adaptive filter circuit calculates second tap coefficients using a second convergence coefficient, and generates a second pseudo echo signal, and a second subtracter subtracts the second pseudo echo signal from the transmitting signal to generate a second error signal.
      <br/>
      A control circuit selects one set of the first tap coefficients and the second tap coefficients in accordance with a received signal, the transmitting signal, and the first and second error signals.
      <br/>
      A third adaptive filter circuit generates a third pseudo echo signal in accordance with the set of tap coefficients selected by the control circuit and the received signal, and a third subtracter subtracts the third pseudo echo signal from the transmitting signal to generate a third error signal serving as an actual transmitting signal.
    </p>
    <p num="7">In this echo canceler, the first and second filter circuits are constantly operating for tap estimation regardless of the operation of the control circuit.</p>
    <heading>BRIEF DESCRIPTION OF THE DRAWINGS</heading>
    <p num="8">
      The present invention will be more clearly understood from the description as set forth below with reference to the accompanying drawings, wherein:
      <br/>
      FIG. 1 is a block circuit diagram illustrating a first prior art echo canceler;
      <br/>
      FIG. 2 is a flowchart showing the operation of the adaptive filter control circuit of FIG. 1;
      <br/>
      FIG. 3 is a block circuit diagram illustrating a second prior art echo canceler;
      <br/>
      FIG. 4 is a flowchart showing the operation of the adaptive filter control circuit of FIG. 3;
      <br/>
      FIG. 5 is a block circuit diagram illustrating an embodiment and the echo canceler according to the present invention; and
      <br/>
      FIG. 6 is a flowchart showing the operation of the adaptive filter control circuit of FIG. 5.
    </p>
    <heading>DESCRIPTION OF THE PREFERRED EMBODIMENT</heading>
    <p num="9">Before the description of the preferred embodiment, prior art echo cancelers will be explained with reference to FIGS. 1, 2, 3 and 4.</p>
    <p num="10">
      In FIG. 1, which illustrates a first prior art echo canceler, a line 1 is connected to a telephone set to be used by a proximal end speaker, and a line 2 is connected to a modem for a distal end speaker.
      <br/>
      As a result, the proximal end speaker and the distal end speaker can exchange voice signals by way of the lines 1 and 2.
      <br/>
      Hereinafter, a voice signal proceeding from the line 1 to the line 2 is referred as a transmitting signal S, and a voice signal proceeding from the line 2 to the line 1 is referred to as a received signal X.
    </p>
    <p num="11">
      An echo canceler 3 is provided between the lines 1 and 2, particularly, on the side of the line 1.
      <br/>
      The received signal X is subjected to a digital/analog (D/A) conversion on the line 1 and also to a 4-wire/2-wire conversion before outputting to the proximal end speaker.
      <br/>
      The voice being transmitted from the proximal end speaker is subjected to a 2-wire/4-wire conversion and an A/D conversion before outputting to the echo canceler 3.
      <br/>
      That is, the transmitting signal S is a linear digital signal or a pulse code modulation (PCM) signal.
    </p>
    <p num="12">
      The echo canceler 3 is normally designed to suppress the voice (echo) being received that is leaking to the line 1 through which the voice being transmitted is travelling at the time of a 2-wire/4-wire conversion on the line 1.
      <br/>
      The echo canceler 3 is formed by a tap coefficient calculating circuit 31, a pseudo echo generating circuit 32, a subtracter 33 and an adaptive filter control circuit 34.
      <br/>
      Note that the tap coefficient calculating circuit 31 and the pseudo echo generating circuit 32 form an adaptive filter circuit.
    </p>
    <p num="13">
      The transmitting signal S can be represented by the formula (1):
      <br/>
      S=A+B  (1)
    </p>
    <p num="14">Where A is the voice spoken by the proximal end speaker and the background noise, and</p>
    <p num="15">B is the echo generated at the 2-wire/4-wire conversion in the line 1.</p>
    <p num="16">
      The subtracter 33 subtracts a pseudo echo signal HX from the transmitting signal S by the formula (2) to obtain an error signal E:
      <br/>
      E=S-HX  (2)
    </p>
    <p num="17">
      The pseudo echo signal HX is generated from the pseudo echo generating circuit 32.
      <br/>
      If the voice generated from the proximal end speaker is very small and the tap coefficients of the tap coefficient calculating circuit 31 are converged E.apprxeq 0 (slashed zero)  In this case, if the proximal end speaker is not silent, E.apprxeq.A.
    </p>
    <p num="18">The pseudo echo signal HK for each signal symbol is calculated by the pseudo echo calculating circuit 32 using the formula (3)  (Equation image '1' not included in text)</p>
    <p num="19">Where Hi is an i-th tap coefficient; and</p>
    <p num="20">X(N-i) is a received signal symbol at (N-i) time before the current time.</p>
    <p num="21">For example, X0 denotes the current symbol of the received signal X, X1 denotes a symbol of the received signal X which precedes the current symbol by one symbol, . . . , and XN denotes a symbol of the received signal X which precedes the current symbol by N symbols.</p>
    <p num="22">
      The tap coefficient calculating circuit 31 has N taps and N tap coefficients Hi (i=1, 2, . . . , N).
      <br/>
      For this purpose, the tap coefficient calculating circuit 31 includes N tap memories for storing the tap coefficients and an N-stage shift register for shifting the received signal X. The received signal X is input to the tap coefficient calculating circuit 31 to update the tap coefficients Hi (i=1, 2, . . . , N) for each symbol.
      <br/>
      That is, a new tap coefficient Hi ' for the current tap coefficient Hi is estimated by the following formula (4):  (Equation image '2' not included in text)
    </p>
    <p num="23">where i is a tap number (i=1, 2, . . . , N);</p>
    <p num="24">MU  is a convergence coefficient.</p>
    <p num="25">
      Note that the tap coefficient calculating circuit 31 also includes a multiplexer, an adder, a subtracter and a control circuit therefor, in order to carry out the formula (4).
      <br/>
      Thus, the tap coefficients Hi are usually converged by the tap coefficient calculating circuit 31, so that the error signal E is brought close to zero.
      <br/>
      In this case, the larger the convergence coefficient  MU , the larger the convergence speed.
    </p>
    <p num="26">
      The tap estimation using the formula (4) should be carried out only when the received signal X shows a sufficiently high level and the echo component due to the received signal X is much larger than the voice of the proximal end speaker or the background noise in the transmitting signal S. Otherwise, the operation of the tap estimation has to be suspended to avoid any degradation in the characteristics of tap coefficients.
      <br/>
      In this case, the last tap coefficients are maintained.
      <br/>
      The determination of whether or not the tap estimation operation is carried out is made by the adaptive filter control circuit 34 which generates a control signal C and transmits it to the tap coefficient calculating circuit 31.
      <br/>
      Here, if C="1", the tap coefficient calculating circuit 31 is operated, while if C="0", the tap coefficient calculating circuit 31 is not operated.
    </p>
    <p num="27">The operation of the adaptive filter circuit circuit 34 of FIG. 1 is explained next with reference to FIG. 2.</p>
    <p num="28">The routine of FIG. 2 is carried out by receiving one symbol of the received signal X.</p>
    <p num="29">
      First, at step 201, it is determined whether or not the following formula (5) is satisfied:
      <br/>
      X&lt;p1  (5)
    </p>
    <p num="30">
      where p1 is a constant.
      <br/>
      If X&lt;p1, this means that the distal end speaker is recognized as silent.
      <br/>
      Therefore, the control proceeds to step 204 which causes the control signal C to be "0", so that the tap estimation operation is not carried out, Otherwise, the control proceeds to step 202.
    </p>
    <p num="31">
      At step 202, it is determined whether or not the following formula (6) is satisfied:
      <br/>
      S&gt;p2 * X  (6)
    </p>
    <p num="32">
      where p2 is a constant not larger than 0.5. If S&gt;p2 * X, this means that the proximal end speaker and the distal end speaker are both recognized to be obviously talking.
      <br/>
      This is a so-called double-talk state.
      <br/>
      Therefore, the control proceeds to step 204 which causes the control signal C to be "0", so that the tap estimation operation is not carried out, Otherwise, the control proceeds to step 203.
    </p>
    <p num="33">
      At step 203, it is determined whether or not the following formula (7) is satisfied:
      <br/>
      E&gt;p3 * S  (7)
    </p>
    <p num="34">
      where p3 is a constant.
      <br/>
      This means that an echo suppression amount (S/E) of the echo canceler 3 is so small that the voice component other than the echo takes a large proportion in the transmitting signal S. Therefore, in order to avoid any degradation in the characteristics of tap coefficients, the control proceeds to step 204 which causes the control signal C to be "0", so that the tap estimation operation is not carried out, Otherwise, the control proceeds to step 205 which causes the control signal C to be "1", so that the tap estimation operation is carried out.
    </p>
    <p num="35">The above-described first prior art echo canceler, however, accompanied by the following problems.</p>
    <p num="36">
      At step 202, the constant p2 is required to be accurately defined by the line 1.
      <br/>
      Also, when the level of the received signal X is higher than that of the transmitting signal S, it is difficult to detect any double-talk state.
      <br/>
      Contrary to this, if a smaller value is selected for the constant p2 in order to alleviate this problem, a double-talk state with be erroneously detected when the echo level is raised.
      <br/>
      In addition, even if the formula (6) at step 202 is satisfied, when a background noise occurs at the side of the proximal end speaker, a double-talk state will also be erroneously detected.
    </p>
    <p num="37">Also, at step 203, if a double-talk state is correctly discriminated from a state where the tap coefficients are converging, a single-talk state will be mistaken for a double-talk state, so that the tap coefficients will stop converging.</p>
    <p num="38">
      Additionally, if a 4-wire telephone set is linked to the line 1 for some reason or another, acoustic coupling can take place between the generated echo and the telephone set, and such coupling may be a non-linear response, and in this case, the response level of the echo may be low.
      <br/>
      Therefore, if an echo suppression amount E/S represented by the formula (7) is used, this amount may be rather small and/or unstable, and hence, this amount cannot adequately be used for any determination.
    </p>
    <p num="39">Further, when the response level of the echo of the line 2 is very low, when no echo takes place by connecting a 4-wire telephone set to the line 2, or when a non-linear echo exists, the echo suppression amount becomes small, so that a double-talk state may erroneously be detected.</p>
    <p num="40">In FIG. 3, which illustrates a second prior art echo canceler (see: JP-A-7-170337), a variable attenuator 35 is added to the elements of FIG. 1, thus suppressing residual echo by turning ON and OFF the variable attenuator 35 without being affected by the delay of an echo path.</p>
    <p num="41">
      The operation of the adaptive filter control circuit 35 of FIG. 3 is explained next with reference to FIG. 4.
      <br/>
      In FIG. 4, steps 401, 402 and 403 are provided instead of steps 202 and 203 of FIG. 2.
      <br/>
      That is, only if the determination at step 201 is negative, does the control proceed to steps 401, 402 and 403.
    </p>
    <p num="42">
      At step 401, it is determined whether or not the following formula (8) is satisfied:
      <br/>
      S/E &lt;= C1 * (SM/EM)  (8)
    </p>
    <p num="43">
      Also, at step 402, it is determined whether or not the following formula (9) is satisfied:
      <br/>
      S/E &lt;= C2 * (SM/EM)  (9)
    </p>
    <p num="44">
      In the formulae (8) and (9), C1 and C2 are constants having a relationship such that
      <br/>
      0&lt;C1 &lt;C2 &lt;1
    </p>
    <p num="45">
      For example, C1 =1/4 and C2 =1/2.
      <br/>
      Also, SM and EM represent the average power of the transmitting signal S and the average value of the subtracter 33, respectively, when only the distal end speaker is talking so that the tap coefficients have been converged sufficiently in a single-talk state.
      <br/>
      Note that S and M of the formula (8) and (9) at steps 401 and 402 represent the current average power of the transmitting signal S and the current output value of the subtracter 33, respectively.
    </p>
    <p num="46">
      If S/E &lt;= C1 * (SM/EM), this means that a complete double-talk state is realized.
      <br/>
      Therefore, the control proceeds to step 204 which causes the control signal C to be "0", so that the tap estimation operation is not carried out.
    </p>
    <p num="47">
      If C1 * (SM/EM)&lt;S/E &lt;= C2 * (SM/EM), this means that an intermediate state between a double-talk state and a single-talk state exists.
      <br/>
      Therefore, the control proceeds to step 403 which turns ON the variable attenuator 35, and then, proceeds to step 204.
    </p>
    <p num="48">
      If S/E&gt;C2 * (SM/EM), this means that a complete single-talk state is realized.
      <br/>
      Therefore, the control proceeds to step 205 which causes the control signal C to be "1", so that the tap estimation operation is carried out.
    </p>
    <p num="49">
      In the above-described second prior art echo canceler, when the background noise is large on the side of the proximal end speaker or the like, the value of SM/EM constantly shows a small value.
      <br/>
      Therefore, since the constants C1 and C2 are smaller than 1, the formulae (8) and (9) at steps 401 and 402 are constantly dissatisfied.
      <br/>
      As a result, the tap estimation operation is constantly carried out which degrades the characteristics of tap coefficients, which may diverge at worst.
    </p>
    <p num="50">In FIG. 5, which illustrates an embodiment of the present invention, a canceler 3' includes three adaptive filter circuits.</p>
    <p num="51">
      The first adaptive filter circuit is formed by a tap coefficient calculating circuit 11 and a pseudo echo generating circuit 12 corresponding to the tap coefficient calculating circuit 31 and the pseudo echo generating circuit 32 of FIG. 1.
      <br/>
      A subtracter 13 corresponding to the subtracter 33 of FIG. 1 subtracts a pseudo echo signal HX1 from the transmitting signal S by a formula similar to the formula (2):
      <br/>
      E1=S-HX1
    </p>
    <p num="52">
      The second adaptive filter circuit is formed by a tap coefficient calculating circuit 14 and a pseudo echo generating circuit 15 corresponding to the tap coefficient calculating circuit 31 and the pseudo echo generating circuit 32 of FIG. 1.
      <br/>
      A subtracter 16 corresponding to the subtracter 33 of FIG. 1 subtracts a pseudo echo signal HX2 from the transmitting signal S by a formula similar to the formula (2):
      <br/>
      E2=S-HX2
    </p>
    <p num="53">
      In the first and second adaptive filter circuits, the pseudo echo signals HX1 and HX2 are calculated in the pseudo echo generating circuits 12 and 15, respectively, for each symbol using the formula (3), and the tap coefficients H1 and H2 are calculated in the tap coefficient calculating circuits 11 and 14, respectively, for each symbol using the formula (4).
      <br/>
      That is, the first adaptive filter circuit (11, 12) operates similarly as the second adaptive filter (14, 15), but the first and second adaptive filter circuits have convergence coefficients that are different from each other.
      <br/>
      The tap coefficient calculating circuit 11 uses  MU 1 and the tap coefficient calculating circuit 13 uses  MU 2, where  MU 1&gt; MU 2.
      <br/>
      Thus, in a single-talk state where only the distal end speaker is talking, the first adaptive filter circuit (11, 12) shows a quick convergence to provide a relationship of Es&lt;E2, whereas, in a case where the proximal end speaker starts talking and/or the background noise becomes large to degrade the characteristics of the tap coefficients, a relationship of E1&gt;E2 appears because the characteristics of the tap coefficients are degraded slowly for the tap coefficient calculating circuit 14.
    </p>
    <p num="54">
      The third adaptive filter is formed by a tap coefficient memory 17, a N-stage shift register 18 and a pseudo echo generating circuit 19 corresponding to the pseudo echo generating circuit 33 of FIG. 1.
      <br/>
      A subtracter 20 corresponding to the subtracter 33 of FIG. 1 subtracts a pseudo echo signal HX3 from the transmitting signal by a formula similar to the formula (2):
      <br/>
      E3=S-HX3
    </p>
    <p num="55">
      In the third adaptive filter circuit, the pseudo echo signal HX3 is calculated in the pseudo echo generating circuit 19 for each symbol using the formula (3).
      <br/>
      However, in the third adaptive filter circuit, the tap coefficients are not calculated, but the tap coefficients are supplied from a filter selected 21 to the tap coefficient memory 17.
    </p>
    <p num="56">
      For every M symbols, the filter selector 21 receives tap coefficients H1 from the tap coefficient calculating circuit 11, tap coefficients H2 from the tap coefficient calculating circuit 14, and tap coefficients H3 from the tap coefficient memory 17.
      <br/>
      Note that the tap coefficients H3 are stored temporarily in the register 17a.
      <br/>
      Then, the filter selector 20 selects one of the three sets of tap coefficients as optimal tap coefficients H4 according to a control signal C provided by an adaptive filter control circuit 22 and transmits them to the tap coefficient memory 17.
    </p>
    <p num="57">The adaptive filter control circuit 21 receives the transmitting signal S from the line 1, the received signal X from the line 2, the error signal E1 from the subtracter 13, and the error signal E2 from the subtracter 16, and determines the state of transmission and reception and the state of the tap coefficients in the tap coefficient calculating circuits 11 and 14 by every M symbols.</p>
    <p num="58">
      The tap coefficient memory 17 constantly stores N tap coefficients and outputs them to the pseudo echo generating circuit 19 for each symbol.
      <br/>
      On the other hand, as stated above, the tap coefficients of the tap coefficient memory 17 are updated by every M symbols to make tap coefficients H4 be provided by the filter selector 20 as optimal tap coefficients during the next M symbols.
      <br/>
      In this case, the tap coefficients that have been stored in the tap coefficient memory 17 until the updating are outputted as the tap coefficients H3 to the filter selector 20.
    </p>
    <p num="59">
      Since the adaptive filter selector 20 and the adaptive filter control circuit 21 are operated for every M symbols, the pseudo echo generating circuit 19 and the subtracter 20 needs to be operated for a delayed transmitting signal and a delayed received signal.
      <br/>
      For this purpose, delay circuits 23 and 24 are provided.
      <br/>
      That is, the delay circuit 23 delays the transmitting signal S by M symbols and transmits it to the subtractor 20.
      <br/>
      Also, the delay circuit 24 delays the received signal X by M symbols and transmits it to the shift register 18.
    </p>
    <p num="60">The operation of the adaptive filter control circuit 22 of FIG. 5 is explained next with reference to FIG. 6.</p>
    <p num="61">The routine of FIG. 6 is carried out by receiving every M symbol of the received signal X.</p>
    <p num="62">
      First, at step 601, in the same way as in step 201 of FIG. 2, it is determined whether or not the following formula (10) is satisfied:
      <br/>
      X&lt;p4  (10)
    </p>
    <p num="63">
      where p4 is a constant.
      <br/>
      If X&lt;p4, this means that the distal end speaker is recognized as silent.
      <br/>
      Therefore, the control proceeds to step 605 which causes the control signal C to be C3 for selecting the tap coefficients H3.
      <br/>
      As a result, the tap coefficients H3 are again stored in the tap coefficient memory 17', in other words, the tap estimation operation is substantially stopped.
      <br/>
      Further, at step 606, the adaptive filter control circuit 22 initializes the tap coefficients of the tap coefficient calculating circuits 11 and 14 by using the tap coefficients H3.
      <br/>
      Otherwise, the control proceeds to step 602.
    </p>
    <p num="64">
      As step 602, it is determined whether or not the following formula (11) is satisfied:
      <br/>
      S&gt;p5 * X  (11)
    </p>
    <p num="65">
      where p5 is a constant.
      <br/>
      Note that 0.5 can most appropriately be used for the constant p5.
      <br/>
      This is because the CCITT Standards provide that an echo signal should be at a level of 0.5 times of that of a received signal at most and the constant p5 should be exploited maximally in order to prevent a double-talk state from being erroneously detected due to the echo signal.
    </p>
    <p num="66">
      At step 602, if S&gt;p5.X, this determines that a single-talk state of the proximal end speaker or a double-talk state is realized.
      <br/>
      Therefore, the control proceeds to step 605, so that the tap coefficients H3 are again stored in the tap coefficient memory 17.
      <br/>
      Also, at step 606, the tap coefficients of the tap coefficient calculating circuits 11 and 14 are initialized by using the tap coefficients H3.
      <br/>
      Otherwise, the control proceeds to step 603.
    </p>
    <p num="67">
      At step 603, it is determined whether or not the following formula (12) is satisfied:
      <br/>
      p6 * .vertline.E1.vertline.&lt;.vertline.E2.vertline.  (12)
    </p>
    <p num="68">
      where p6 is a constant.
      <br/>
      If p6 * .vertline.E1.vertline.&lt;.vertline.E2.vertline., this determines that a signal is currently being received, and the voice of the proximal end speaker and the background noise do not affect the tap estimation operation.
      <br/>
      Therefore, the control proceeds to step 608 which causes the control signal C to be C1 for selecting the tap coefficients H1.
      <br/>
      As a result, the tap coefficients H1 are stored in the tap coefficient memory 17.
      <br/>
      Otherwise, the control proceeds to step 604.
    </p>
    <p num="69">
      At step 604, it is determined whether or not the following formula (13) is satisfied:
      <br/>
      p7 * .vertline.E2.vertline.&lt;.vertline.S.vertline.  (13)
    </p>
    <p num="70">
      where p7 is a constant.
      <br/>
      If p7 * .vertline.E2.vertline.&lt;.vertline.S.vertline., this determines that the tap coefficients are fairly converged.
      <br/>
      Therefore, the control proceeds to step 607 which causes the control signal C to be C2 for selecting the tap coefficients H2.
      <br/>
      As a result, the tap coefficients H2 are stored in the tap coefficient memory 17.
      <br/>
      Otherwise, this determines that a voice is being received but the characteristics of the tap coefficients are being degraded by external disturbances (voice, background sound, etc.) on the side of the proximal end speaker.
      <br/>
      Therefore, the control proceeds to step 605 which causes the control signal C to be C3 for selecting the tap coefficients H3.
      <br/>
      As a result, the tap coefficients H3 are again stored in the tap coefficient memory 17.
      <br/>
      Also, at step 606, the tap coefficients of the tap coefficient calculating circuits 11 and 14 are initialized by using the tap coefficients H3.
    </p>
    <p num="71">As explained hereinabove, according to the presently invention, since the two adaptive filter circuits are constantly operating for the tap estimation, any deceleration in the convering rate and any suspension of convergence due to a wrong determination of a double-talk state can be effectively avoided.</p>
    <p num="72">
      Also, the current state of transmission and reception is not determined only by the levels of the transmitting signal and the received signal and the tap coefficients are estimated by means of two different convergence coefficients in the two adaptive filter circuits, so that the current state of transmission and reception is determined by determining whether the characteristics of tap coefficients are being improved or degraded.
      <br/>
      As a result, even when the background noise is large, the tap estimation operation can be carried out without degrading the characteristics of tap coefficients.
      <br/>
      Additionally, the need for accurately selecting parameters by means of the line is eliminated.
    </p>
    <p num="73">Further, a determination of a double-talk state can be made quickly and accurately for the above-mentioned reasons.</p>
    <p num="74">Moreover, even if a non-linear echo exists, the tap coefficients are converged, through somewhat slowly, so that echo can be suppressed to a certain extent.</p>
  </description>
  <claims format="original" lang="en" id="claim_en">
    <claim num="1">
      <claim-text>What is claimed is:</claim-text>
      <claim-text>1.</claim-text>
      <claim-text>An echo canceler comprising:</claim-text>
      <claim-text>a first adaptive filter circuit for receiving a receiving signal, calculating first tap coefficients using a first convergence coefficient, and generating a first pseudo echo signal in accordance with said first tap coefficients and said receiving signal; a first subtracter, connected said first adaptive filter circuit, for receiving a transmitting signal and subtracting said first pseudo echo signal from said transmitting signal to generate a first error signal; a second adaptive filter circuit for receiving said received signal, calculating second tap coefficients using a second convergence coefficient smaller than said first convergence coefficient, and generating a second pseudo echo signal in accordance with said second tap coefficients and said received signal; a second subtracter, connected to said second adaptive filter circuit, for receiving said transmitting signal and subtracting said second pseudo echo signal from said transmitting signal to generate a second error signal; a control circuit, connected to said first and second adaptive filter circuits and said first and second subtractors, for selecting one set of said first tap coefficients and said second tap coefficients in accordance with said received signal, said transmitting signal, and said first and second error signals; a third adaptive filter circuit, connected to said control circuit, for receiving said received signal and said transmitting signal and generating a third pseudo echo signal in accordance with the set of tap coefficients selected by said control circuit and said received signal;</claim-text>
      <claim-text>and a third subtractor, connected to said third adaptive filter circuit, for subtracting said third pseudo echo signal from said transmitting signal to generate a third error signal.</claim-text>
    </claim>
    <claim num="2">
      <claim-text>2. The echo canceller as set forth in claim 1, wherein said control circuit comprises: means for determining whether or not an average power of said received signal is smaller than a first value; means for determining whether or not a ratio of an average power of said transmitting signal to the average power of said received signal is larger than a second value; means for determining whether or not a ratio of an average power of said first error signal to an average power of said second error signal is smaller than a third value; means for determining whether or not a ratio of the average power of said second error signal to an average power of said transmitting signal is smaller than a fourth value; means for selecting said first tap coefficients when the average power of said received signal is not smaller than said first value, the ratio of the average power of said transmitting signal to the average power of said received signal is not larger than said second value, and the ratio of the average power of said first error signal to the average power of said second error signal is smaller than said third value;</claim-text>
      <claim-text>and means for selecting said second tap coefficients when the average power of said received signal is not smaller than said first value, the ratio of the average power of said transmitting signal to the average power of said received signal is not larger than said second value, the ratio of the average power of said first error signal to the average power of said second error signal is not smaller than said third value, and the ratio of the average power of said second error signal to the average power of said transmitting signal is smaller than said fourth value.</claim-text>
    </claim>
    <claim num="3">
      <claim-text>3. The echo canceler as set forth in claim 2, wherein said control circuit comprises means for fixing said selected tap coefficients when the average power of said received signal is smaller than said first value, when the average power of said received signal is not smaller than said first value and the ratio of the average power of said transmitting signal to the average power of said received signal is larger than said second value, and when the average power of said received signal is not smaller than said first value, the ratio of the average power of said transmitting signal to the average power of said received signal is not larger than said second value, the ratio of the average power of said first error signal to the average power of said second error signal is not smaller than said third value, and the ratio of the average power of said second error signal to the average power of said transmitting signal is not smaller than said fourth value.</claim-text>
    </claim>
    <claim num="4">
      <claim-text>4. The echo canceler as set forth in claim 2, wherein said second value is 0.5</claim-text>
    </claim>
    <claim num="5">
      <claim-text>5. The echo canceler as set forth in claim 1, further comprising: a first delay circuit connected to said third adaptive filter circuit, the received signal being supplied via said first delay circuit to said third adaptive filter circuit;</claim-text>
      <claim-text>and a second delay circuit connected to said third subtracter, the transmitting signal being supplied via said second delay circuit to said third subtracter.</claim-text>
    </claim>
    <claim num="6">
      <claim-text>6. An echo canceler comprising: a first adaptive filter circuit for receiving a received signal, calculating first tap coefficients using a first convergence coefficient for each symbol of said received signal, and generating a first pseudo echo signal in accordance with said first tap coefficients and said received signal for each symbol of said received signal; a first subtracter, connected to said first adaptive filter circuit, for receiving a transmitting signal and subtracting said first pseudo echo signal from said transmitting signal to generate a first error signal; a second adaptive filter circuit for receiving said received signal, calculating second tap coefficients using a second convergence coefficient smaller than said first convergence coefficient for each symbol of said received signal, and generating a second pseudo echo signal in accordance with said second tap coefficients and said received signal for each symbol of said received signal; a second subtracter, connected to said second adaptive filter circuit, for receiving said transmitting signal and subtracting said second pseudo echo signal from said transmitting signal to generate a second error signal; a tap coefficient memory for storing third tap coefficients; a shift register for storing said received signal; a pseudo echo generating circuit, connected to said tap coefficient memory and said shift register, for generating a third pseudo echo signal in accordance with the tap coefficients stored in said tap coefficient memory and said received signal stored in said shift register; a third subtracter, connected to said pseudo echo generating, for subtracting said third pseudo echo signal from said transmitting signal to generate a second error signal; a selector, connected to said first and second adaptive filters and said tap coefficient memory, for selecting one set of said first, second tap coefficients and transmitting a selected set of said first, second and third tap coefficients to said tap coefficient memory;</claim-text>
      <claim-text>and a control circuit, connected to said first and second adaptive filter circuits and said first and second subtracters, for operating said selector in accordance with said received signal, said transmitting signal, and said first and second error signals for every M symbols of said received signal.</claim-text>
    </claim>
    <claim num="7">
      <claim-text>7. The echo canceler as set forth in claim 6, wherein said control circuit comprises: means for determining whether or not an average power of said receiving signal is smaller than a first value; means for determining whether or not a ratio of an average power of said transmitting signal to the average power of said received signal is larger than a second value; means for determining whether or not a ratio of an average power of said first error signal to an average power of said second error signal is smaller than a third value; means for determining whether or not a ratio of the average power of said second error similar to an average power of said transmitting signal is smaller than a fourth value; means for causing said selector to select said first tap coefficients when the average power of said received signal is not smaller than said first value, the ratio of the average power of said transmitting signal to the average power of said received signal is not larger than said second value, and the ratio of the average power of said first error signal to the average power of said second error signal is smaller than said third value; means for causing said selector to select said second tap coefficients when the average power of said received signal is not smaller than said first value, the ratio of the average power of said transmitting signal to the average power of said received signal is not larger than said second value, the ratio of the average power of said first error signal to the average power of said second error signal is not smaller than said third value, and the ratio of the average power of said second error signal to the average power of said transmitting signal is smaller than said fourth value;</claim-text>
      <claim-text>and means for causing said selector to select said third tap coefficients when the average power of said received signal is smaller than said first value, when the average power of said received signal is not smaller than said first value and the ratio of the average power of said transmitting signal to the average power of said received signal is larger than said second value, and when the average power of said received signal is not smaller than said first value, the ratio of the average power of said transmitting signal to the average power of said received signal is not larger than said second value, the ratio of the average power of said first error signal to the average power of said second error signal is not smaller than said third value, and the ratio of the average power of said second error signal to the average power of said transmitting signal is not smaller than said fourth value.</claim-text>
    </claim>
    <claim num="8">
      <claim-text>8. The echo canceler as set forth in claim 7, wherein said second value is 0.5.</claim-text>
    </claim>
    <claim num="9">
      <claim-text>9. The echo canceler as set forth in claim 7, wherein said control circuit further comprises means for initializing said first and second tap coefficients of said first and second adaptive filter circuits by said third tap coefficients when said selector is caused to select said third tap coefficient.</claim-text>
    </claim>
    <claim num="10">
      <claim-text>10. The echo canceler as set forth in claim 6, further comprising: a first delayed circuit connected to said third adaptive filter circuit, the received signal being supplied via said first delay circuit to said third adaptive filter circuit;</claim-text>
      <claim-text>and a second delay circuit connected to said third subtracter, the transmitting signal being supplied via said second delay circuit to said third subtracter.</claim-text>
    </claim>
  </claims>
</questel-patent-document>