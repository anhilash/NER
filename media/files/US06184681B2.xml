<?xml version="1.0" encoding="UTF-8"?>
<questel-patent-document lang="en" date-produced="20180805" produced-by="Questel" schema-version="3.23" file="US06184681B2.xml">
  <bibliographic-data lang="en">
    <publication-reference publ-desc="Granted patent as second publication">
      <document-id>
        <country>US</country>
        <doc-number>06184681</doc-number>
        <kind>B2</kind>
        <date>20010206</date>
      </document-id>
      <document-id data-format="questel">
        <doc-number>US6184681</doc-number>
      </document-id>
    </publication-reference>
    <original-publication-kind>B2</original-publication-kind>
    <application-reference family-id="22687726" extended-family-id="5803">
      <document-id>
        <country>US</country>
        <doc-number>09187130</doc-number>
        <kind>A</kind>
        <date>19981105</date>
      </document-id>
      <document-id data-format="questel">
        <doc-number>1998US-09187130</doc-number>
      </document-id>
      <document-id data-format="questel_Uid">
        <doc-number>70719</doc-number>
      </document-id>
    </application-reference>
    <language-of-filing>en</language-of-filing>
    <language-of-publication>en</language-of-publication>
    <priority-claims>
      <priority-claim kind="national" sequence="1">
        <country>US</country>
        <doc-number>18713098</doc-number>
        <kind>A</kind>
        <date>19981105</date>
        <priority-active-indicator>Y</priority-active-indicator>
      </priority-claim>
      <priority-claim data-format="questel" sequence="1">
        <doc-number>1998US-09187130</doc-number>
      </priority-claim>
      <priority-claim kind="national" sequence="2">
        <country>US</country>
        <doc-number>3396598</doc-number>
        <kind>A</kind>
        <date>19980303</date>
        <priority-linkage-type>2</priority-linkage-type>
        <priority-active-indicator>N</priority-active-indicator>
      </priority-claim>
      <priority-claim data-format="questel" sequence="2">
        <doc-number>1998US-09033965</doc-number>
      </priority-claim>
    </priority-claims>
    <dates-of-public-availability>
      <publication-of-grant-date>
        <date>20010206</date>
      </publication-of-grant-date>
    </dates-of-public-availability>
    <classifications-ipcr>
      <classification-ipcr sequence="1">
        <text>G01R  33/44        20060101A I20051008RMEP</text>
        <ipc-version-indicator>
          <date>20060101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>G</section>
        <class>01</class>
        <subclass>R</subclass>
        <main-group>33</main-group>
        <subgroup>44</subgroup>
        <classification-value>I</classification-value>
        <generating-office>
          <country>EP</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>M</classification-data-source>
        <action-date>
          <date>20051008</date>
        </action-date>
      </classification-ipcr>
      <classification-ipcr sequence="2">
        <text>G01V   3/32        20060101A I20051008RMEP</text>
        <ipc-version-indicator>
          <date>20060101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>G</section>
        <class>01</class>
        <subclass>V</subclass>
        <main-group>3</main-group>
        <subgroup>32</subgroup>
        <classification-value>I</classification-value>
        <generating-office>
          <country>EP</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>M</classification-data-source>
        <action-date>
          <date>20051008</date>
        </action-date>
      </classification-ipcr>
    </classifications-ipcr>
    <classification-national>
      <country>US</country>
      <main-classification>
        <text>324303000</text>
        <class>324</class>
        <subclass>303000</subclass>
      </main-classification>
    </classification-national>
    <classifications-ecla>
      <classification-ecla sequence="1">
        <text>G01N-024/08A</text>
        <section>G</section>
        <class>01</class>
        <subclass>N</subclass>
        <main-group>024</main-group>
        <subgroup>08A</subgroup>
      </classification-ecla>
      <classification-ecla sequence="2">
        <text>G01V-003/32</text>
        <section>G</section>
        <class>01</class>
        <subclass>V</subclass>
        <main-group>3</main-group>
        <subgroup>32</subgroup>
      </classification-ecla>
    </classifications-ecla>
    <patent-classifications>
      <patent-classification sequence="1">
        <classification-scheme office="EP" scheme="CPC">
          <date>20130101</date>
        </classification-scheme>
        <classification-symbol>G01V-003/32</classification-symbol>
        <section>G</section>
        <class>01</class>
        <subclass>V</subclass>
        <main-group>3</main-group>
        <subgroup>32</subgroup>
        <symbol-position>F</symbol-position>
        <classification-value>I</classification-value>
        <classification-status>B</classification-status>
        <classification-data-source>H</classification-data-source>
        <action-date>
          <date>20130101</date>
        </action-date>
      </patent-classification>
      <patent-classification sequence="2">
        <classification-scheme office="EP" scheme="CPC">
          <date>20130101</date>
        </classification-scheme>
        <classification-symbol>G01N-024/081</classification-symbol>
        <section>G</section>
        <class>01</class>
        <subclass>N</subclass>
        <main-group>24</main-group>
        <subgroup>081</subgroup>
        <symbol-position>L</symbol-position>
        <classification-value>I</classification-value>
        <classification-status>B</classification-status>
        <classification-data-source>H</classification-data-source>
        <action-date>
          <date>20130101</date>
        </action-date>
      </patent-classification>
    </patent-classifications>
    <number-of-claims>22</number-of-claims>
    <exemplary-claim>1</exemplary-claim>
    <figures>
      <number-of-drawing-sheets>12</number-of-drawing-sheets>
      <number-of-figures>23</number-of-figures>
      <image-key data-format="questel">US6184681</image-key>
    </figures>
    <invention-title format="original" lang="en" id="title_en">Apparatus and method for computing a distribution of spin-spin relaxation times</invention-title>
    <references-cited>
      <citation srep-phase="examiner">
        <patcit num="1">
          <text>SEZGINER ABDURRAHMAN, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5977768</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5977768</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="2">
          <text>TAICHER ZVI, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>4717878</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US4717878</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="3">
          <text>CLARK BRIAN, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>4949045</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US4949045</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="4">
          <text>KLEINBERG ROBERT L, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5023551</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5023551</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="5">
          <text>KLEINBERG ROBERT L, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5055787</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5055787</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="6">
          <text>PALTIEL ZVI</text>
          <document-id>
            <country>US</country>
            <doc-number>5212447</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5212447</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="7">
          <text>MILLER MELVIN</text>
          <document-id>
            <country>US</country>
            <doc-number>5280243</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5280243</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="8">
          <text>SEZGINER ABDURRAHMAN</text>
          <document-id>
            <country>US</country>
            <doc-number>5363041</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5363041</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="9">
          <text>FREEDMAN ROBERT</text>
          <document-id>
            <country>US</country>
            <doc-number>5381092</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5381092</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="10">
          <text>FREEDMAN ROBERT, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5486762</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5486762</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="11">
          <text>KLEINBERG ROBERT L, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5557201</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5557201</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="12">
          <text>SEZGINER ABDURRAHMAN</text>
          <document-id>
            <country>US</country>
            <doc-number>5596274</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5596274</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="13">
          <text>SEZGINER ABDURRAHMAN, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5705927</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5705927</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="14">
          <text>TAICHER GERSH ZVI, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5757186</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5757186</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="15">
          <text>KLEINBERG ROBERT L, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5796252</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5796252</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="16">
          <document-id>
            <country>EP</country>
            <doc-number>0237323</doc-number>
            <kind>B1</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>EP-237323</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="17">
          <text>WESTERN ATLAS INT INC</text>
          <document-id>
            <country>GB</country>
            <doc-number>2311139</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>GB2311139</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="18">
          <text>WESTERN ATLAS INT INC</text>
          <document-id>
            <country>GB</country>
            <doc-number>2311864</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>GB2311864</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="19">
          <text>WESTERN ATLAS INT INC</text>
          <document-id>
            <country>GB</country>
            <doc-number>2330658</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>GB2330658</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="20">
          <text>OXFORD INSTR LTD</text>
          <document-id>
            <country>WO</country>
            <doc-number>9207279</doc-number>
            <kind>A1</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>WO9207279</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="21">
          <text>NUMAR CORP</text>
          <document-id>
            <country>WO</country>
            <doc-number>9701772</doc-number>
            <kind>A1</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>WO9701772</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="22">
          <text>NUMAR CORP</text>
          <document-id>
            <country>WO</country>
            <doc-number>9829639</doc-number>
            <kind>A1</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>WO9829639</doc-number>
          </document-id>
        </patcit>
      </citation>
    </references-cited>
    <related-documents>
      <continuation-in-part>
        <relation>
          <parent-doc>
            <document-id>
              <country>US</country>
              <doc-number>3396598</doc-number>
              <kind>A</kind>
              <date>19980303</date>
            </document-id>
          </parent-doc>
        </relation>
      </continuation-in-part>
    </related-documents>
    <parties>
      <applicants>
        <applicant data-format="original" app-type="applicant" sequence="1">
          <addressbook lang="en">
            <orgname>Schlumberger Technology Corporation</orgname>
            <address>
              <address-1>Houston, TX, US</address-1>
              <city>Houston</city>
              <state>TX</state>
              <country>US</country>
            </address>
          </addressbook>
          <nationality>
            <country>US</country>
          </nationality>
        </applicant>
        <applicant data-format="questel" app-type="applicant" sequence="2">
          <addressbook lang="en">
            <orgname>SCHLUMBERGER TECHNOLOGIES</orgname>
          </addressbook>
          <nationality>
            <country>US</country>
          </nationality>
        </applicant>
      </applicants>
      <inventors>
        <inventor data-format="original" sequence="1">
          <addressbook lang="en">
            <name>Heidler, Ralf</name>
            <address>
              <address-1>Stafford, TX, US</address-1>
              <city>Stafford</city>
              <state>TX</state>
              <country>US</country>
            </address>
          </addressbook>
          <nationality>
            <country>US</country>
          </nationality>
        </inventor>
        <inventor data-format="original" sequence="2">
          <addressbook lang="en">
            <name>Dworak, Roger A.</name>
            <address>
              <address-1>Sugar Land, TX, US</address-1>
              <city>Sugar Land</city>
              <state>TX</state>
              <country>US</country>
            </address>
          </addressbook>
          <nationality>
            <country>US</country>
          </nationality>
        </inventor>
        <inventor data-format="original" sequence="3">
          <addressbook lang="en">
            <name>Luong, Bruno</name>
            <address>
              <address-1>Stafford, TX, US</address-1>
              <city>Stafford</city>
              <state>TX</state>
              <country>US</country>
            </address>
          </addressbook>
          <nationality>
            <country>US</country>
          </nationality>
        </inventor>
        <inventor data-format="original" sequence="4">
          <addressbook lang="en">
            <name>Poitzsch, Martin E.</name>
            <address>
              <address-1>Sugar Land, TX, US</address-1>
              <city>Sugar Land</city>
              <state>TX</state>
              <country>US</country>
            </address>
          </addressbook>
          <nationality>
            <country>US</country>
          </nationality>
        </inventor>
      </inventors>
      <agents>
        <agent sequence="1" rep-type="agent">
          <addressbook lang="en">
            <name>Ryberg, John J.</name>
          </addressbook>
        </agent>
        <agent sequence="2" rep-type="agent">
          <addressbook lang="en">
            <name>Jeffery, Brigitte L.</name>
          </addressbook>
        </agent>
      </agents>
    </parties>
    <examiners>
      <primary-examiner>
        <name>Arana, Louis</name>
      </primary-examiner>
    </examiners>
    <lgst-data>
      <lgst-status>GRANTED</lgst-status>
    </lgst-data>
  </bibliographic-data>
  <abstract format="original" lang="en" id="abstr_en">
    <p id="P-EN-00001" num="00001">
      <br/>
      The present invention is directed to a method for computing a distribution of spin-spin relaxation times.
      <br/>
      The spin-echo amplitudes are obtained by hardware integration of the receiver voltages over a time window.
      <br/>
      A linear operator is utilized to map a relaxation-time distribution to spin-echoes, produce a singular value decomposition (SVD) of the linear operator, determine vectors of the SVD, and compress the spin-echo data using the vectors.
      <br/>
      To eliminate a telemetry bottleneck, the T2 spectrum is computed downhole and transmitted to the surface.
    </p>
  </abstract>
  <description format="original" lang="en" id="desc_en">
    <heading>CROSS-REFERENCES</heading>
    <p num="1">
      This is a continuation-in-part of U.S. patent application Ser.
      <br/>
      No. 09/033,965, filed Mar. 3, 1998.
    </p>
    <heading>BACKGROUND OF THE INVENTION</heading>
    <p num="2">The present invention relates generally to an apparatus and method for measuring nuclear magnetic resonance properties of an earth formation traversed by a borehole, and more particularly, to an apparatus and method for computing a distribution of spin--spin relaxation times.</p>
    <p num="3">
      It is well recognized that atomic particles of an earth formation having non-zero nuclear spin magnetic moment, for example protons, have a tendency to align with a static magnetic field imposed on the formation.
      <br/>
      Such a magnetic field may be naturally generated, as is the case for the earth's magnetic field, BE.
      <br/>
      An RF pulse applying a second magnetic field transverse to BE creates a magnetization component in the transverse plane (perpendicular to BE) which precesses about the BE vector with a characteristic resonance known as the Larmor frequency,  OMEGA L, which depends on the strength of the static magnetic field and the gyromagnetic ratio of the particle.
      <br/>
      Hydrogen nuclei (protons) precessing about a magnetic field BE of 0.5 gauss, for example, have a characteristic frequency of approximately 2 kHz.
      <br/>
      If a population of hydrogen nuclei were made to precess in phase, the combined magnetic fields of the protons can generate a detectable oscillating voltage in a receiver coil, conditions known to those skilled in the art as free induction decay or a spin echo.
      <br/>
      Hydrogen nuclei of water and hydrocarbons occurring in rock pores produce nuclear magnetic resonance (NMR) signals distinct from signals arising from other solids.
    </p>
    <p num="4">
      U.S. Pat. No. 4,717,878 issued to Taicher et al. and U.S. Pat. No. 5,055,787 issued to Kleinberg et al., describe NMR tools which employ permanent magnets to polarize hydrogen nuclei and generate a static magnetic field, B0, and RF antennas to excite and detect nuclear magnetic resonance to determine porosity, free fluid ratio, and permeability of a formation.
      <br/>
      The atomic nuclei align with the applied field, B0, with a time constant of T1.
      <br/>
      After a period of polarization, the angle between the nuclear magnetization and the applied field can be changed by applying an RF field, B1, perpendicular to the static field B0, at the Larmor frequency fL = GAMMA B0 /2 PI , where  GAMMA  is the gyromagnetic ratio of the proton and B0 designates the static magnetic field strength.
      <br/>
      After termination of the RF pulse, the protons precess in the plane perpendicular to B0.
      <br/>
      A sequence of refocusing RF pulses generates a sequence of spin-echoes which produce a detectable NMR signal in the antenna.
    </p>
    <p num="5">
      U.S. Pat. No. 5,280,243 issued to Melvin Miller describes a nuclear magnetic resonance tool for formation evaluation while drilling.
      <br/>
      The tool includes a probe section consisting of a permanent magnet disposed in a longitudinally extending annular recess outside the drill collar and an antenna disposed on a non-conductive magnetic sleeve outside the drill collar.
      <br/>
      The gradient of the static magnetic field magnitude is in the radial direction.
      <br/>
      The antenna produces an RF magnetic field substantially perpendicular to both the longitudinal axis of the tool and the static field direction.
      <br/>
      With the '243 apparatus, the magnet must be long in axial extent compared to its diameter for the magnetic fields to approximate its intended 2-D dipole behavior.
    </p>
    <p num="6">
      U.S. Pat. No. 5,757,186 issued to Taicher et al. describes a measurement-while-drilling tool which includes a sensing apparatus for making nuclear magnetic resonance measurements of the earth formation.
      <br/>
      The NMR sensing apparatus is mounted in an annular recess formed into the exterior surface of the drill collar.
      <br/>
      In one embodiment, a flux closure is inserted into the recess.
      <br/>
      A magnet is disposed on the outer radial surface of the flux closure.
      <br/>
      The magnet is constructed from a plurality of radial segments which are magnetized radially outward from the longitudinal axis of the tool.
      <br/>
      The flux closure is required to provide suitable directional orientation of the magnetic field.
    </p>
    <p num="7">
      The tools disclosed in the '243 and '186 patents suffer from common problems: both tools require using a nonconductive magnet and placing the magnet outside the drill collar.
      <br/>
      For the '243 tool, the outside surface of the drill collar must contain a recessed area to accommodate the nonconductive magnet.
      <br/>
      For the '186 tool, the outside surface of the drill collar must contain a recessed area to accommodate the flux closure, nonconductive magnet, and antenna.
      <br/>
      Because the strength of the drill collar is a function of its radii, reducing the external diameter to accommodate the magnet only or the flux closure, magnet, and antenna results in an unacceptably weak section of the drill collar which may bend or break during the drilling operation
    </p>
    <p num="8">
      U.S. Pat. No. 5,557,201 issued to Kleinberg et al. describes a pulsed nuclear magnetism tool for formation evaluation while drilling.
      <br/>
      The tool includes a drill bit, drill string, and a pulsed nuclear magnetic resonance device housed within a drill collar made of nonmagnetic alloy.
      <br/>
      The tool includes a channel, within the drill string and pulsed NMR device, through which drilling mud is pumped into the borehole.
      <br/>
      The pulsed NMR device comprises two tubular magnets, which are mounted with like poles facing each other, surrounding the channel, and an antenna coil mounted in an exterior surface of the drill string between the magnets.
      <br/>
      This tool is designed to resonate nuclei at a measurement region known to those skilled in the art as the saddle point.
    </p>
    <p num="9">
      U.S. Pat. No. 5,705,927 issued to Sezginer et al. also describes a pulsed nuclear magnetism tool for formation evaluation while drilling.
      <br/>
      The tool includes shimming magnets, located either inside or outside the tool, which suppress the magnetic resonance signal of the borehole fluids by raising the magnitude of the static magnetic field in the borehole so that the Larmor frequency in the borehole is above the frequency of the oscillating field produced by an RF antenna located in a recessed area of the tool.
      <br/>
      The shimming magnets also reduce the gradient of the static magnetic field in the region of investigation.
    </p>
    <heading>SUMMARY OF THE INVENTION</heading>
    <p num="10">
      The above disadvantages of the prior art are overcome by means of the subject invention for an apparatus and method for computing a distribution of spin--spin relaxation times.
      <br/>
      A substantially axisymmetric static magnetic field is applied into a formation traversed by a wellbore.
      <br/>
      An oscillating magnetic field is also applied to the formation.
      <br/>
      Nuclear magnetic resonance signals from the formation are detected and transmitted to a signal processor located in the wellbore.
      <br/>
      The signal processor computes a distribution of spin--spin relaxation times from the detected signals.
      <br/>
      The spin--spin relaxation times may be transmitted to a surface of the wellbore (uphole).
    </p>
    <p num="11">The plurality of signals are detected having a signal plus noise amplitude, Aj, characterized by the following relationship:  (Equation image '1' not included in text)</p>
    <p num="12">where  ETA j is the noise in the measurement Aj, ai is the amplitude of the T2 distribution taken at T2,i,  (Equation image '2' not included in text)</p>
    <p num="13">
      represents the elements of matrix X, where tw is the wait time and c is a constant (the T1 /T2 ratio),  DELTA t is the echo spacing, and j=1,2, . . . N, where N is the number of echoes collected in a single pulse sequence.
      <br/>
      In matrix notation, the equation becomes A=Xa+ ETA .
      <br/>
      The noise,  ETA , is unknown, therefore, a is approximated by finding a minimum of the functional J=.parallel.A-Xa.parallel.2. A regularization term,  LAMBDA .parallel.a.parallel.2, may be added to the functional and the functional, J LAMBDA  (a)=.parallel.A-Xa.parallel.2 + LAMBDA .parallel.a.parallel.2, minimized using a suitable iterative minimization algorithm.
    </p>
    <heading>BRIEF DESCRIPTION OF THE DRAWINGS</heading>
    <p num="14">
      The advantages of the present invention will become apparent from the following description of the accompanying drawings. It is to be understood that the drawings are to be used for the purpose of illustration only, and not as a definition of the invention.
      <br/>
      In the drawings:
      <br/>
      FIG. 1 illustrates a logging-while-drilling apparatus;
      <br/>
      FIG. 2 depicts the low gradient sonde;
      <br/>
      FIGS. 2a-2d illustrate the contour lines .vertline.B0.vertline. corresponding to four low gradient magnet configurations;
      <br/>
      FIGS. 3a-3d represent the contour lines of the gradient .vertline..gradient.B0.vertline. corresponding to four low gradient magnet configurations;
      <br/>
      FIG. 4 depicts the high gradient sonde;
      <br/>
      FIG. 4a represents the contour lines .vertline.B0.vertline. corresponding to the high gradient magnet configuration;
      <br/>
      FIG. 4b represents the contour lines of the gradient .vertline..gradient.B0.vertline. corresponding to the high gradient magnet configuration;
      <br/>
      FIG. 5 depicts the simple data acquisition mode;
      <br/>
      FIG. 6 depicts the interleaved data acquisition mode;
      <br/>
      FIG. 7 depicts the burst data acquisition mode; and,
      <br/>
      FIG. 8 represents a block diagram of the pulse programmer.
    </p>
    <heading>DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENT</heading>
    <p num="15">
      Referring to FIG. 1, a nuclear magnetic resonance (NMR) logging-while-drilling tool 10 is illustrated.
      <br/>
      The tool 10 comprises a drill bit 12, drill string 14, a plurality of RF antennas 36, 38, and at least one gradient coil 56.
      <br/>
      The tool 10 further comprises electronic circuitry 20 housed within the drill collar 22.
      <br/>
      The electronic circuitry 20 comprises RF resonance circuitry for the antennas 36, 38, a microprocessor, a digital signal processor, and a low voltage bus.
      <br/>
      The tool 10 further comprises a plurality of tubular magnets 30, 32, and 34 which are polarized in a direction parallel to the longitudinal axis of the tool 10 but opposite to each other, i.e., with like magnetic poles facing each other.
      <br/>
      The magnets 30, 32, and 34 comprise either a conductive or nonconductive material.
      <br/>
      The configuration of magnets 30, 32, and 34 and antennas 36, 38 provides for at least two NMR regions of investigation 60, 62 with a substantially axisymmetric static and RF magnetic field.
    </p>
    <p num="16">
      A means for drilling a borehole 24 in the formation comprises drill bit 12 and drill collar 22.
      <br/>
      The drill collar 22 may include a stabilizing means (not shown) for stabilizing radial motion of the tool 10 in the borehole during drilling, however, the stabilizing means is not required therefore the tool 10 may operate unstabilized or stabilized.
      <br/>
      Mud flow sleeve 28 defines a channel 90 for carrying the drilling fluid through the drill string 14.
      <br/>
      A drive mechanism 26 rotates the drill bit 12 and drill string 14.
      <br/>
      This drive mechanism is adequately described in U.S. Pat. No. 4,949,045 issued to Clark et al.
      <br/>
      However, a downhole mud motor may be placed in the drill string as the drive mechanism 26.
    </p>
    <p num="17">
      It is within contemplation of the subject invention to combine N+1 magnets to obtain at least N regions of investigation in the formation.
      <br/>
      The combinations contemplated by this invention include, but are not limited to, a low gradient-low gradient, high gradient-high gradient, high gradient-low gradient, low gradient-high gradient, or a combination of high gradient, low gradient, and saddle point regions.
      <br/>
      The combination of high and low gradient static field regions in the formation offers several advantages.
      <br/>
      For example, the high gradient region may have a higher signal-to-noise ratio but may experience signal loss when the tool 10 undergoes lateral motion in the borehole.
      <br/>
      On the other hand, the low gradient region has lower susceptibility to signal loss problems when the tool 10 is in motion.
      <br/>
      Also, with moderate tool motion, longer echo trains can be acquired in the low gradient region than in the high gradient region thereby providing more information about permeability, bound and free fluid, and hydrocarbon types.
      <br/>
      Moreover, the combination of data acquired with both gradient regions may provide quantitative information about the amount of lateral motion the tool 10 experiences and can be used to motion correct the NMR data, or, at least, quality control the data.
      <br/>
      Measurements of devices, such as strain gauges, accelerometers, or magnetometers, or any combinations of these devices, may be integrated with NMR information to quality control the data or make corrections to the spin-echo train.
      <br/>
      With the combination of high and low gradient static magnetic fields, the high gradient region exhibits more diffusion effect and therefore is of greater interest for hydrocarbon typing techniques than the low gradient region.
      <br/>
      Finally, the low gradient region has a static magnetic field having a low amplitude and therefore, this region with its lower Larmor frequency is less affected by formation and borehole fluid conductivity.
    </p>
    <p num="18">Low Gradient Sonde</p>
    <p num="19">
      Referring to FIG. 2, in one section of the tool, hereinafter referred to as the low gradient sonde, a central magnet 30 is axially separated from a lower magnet 32.
      <br/>
      These magnets 30, 32 generate a substantially axisymmetric static magnetic field that is radial in its polarization and, over a reasonably long cylindrical shell, the static magnetic field has a fairly constant magnitude.
      <br/>
      It is within contemplation of the subject invention to excite a plurality of cylindrical shells of spins in the formation where each shell is resonant at a different RF frequency, and to sequentially interrogate each shell with sequences of RF pulses.
    </p>
    <p num="20">
      The area between magnets 30, 32 is suitable for housing elements such as electronic components, an RF antenna, and other similar items.
      <br/>
      For example, a plurality of electronic pockets 70 may form an integral part of the mud sleeve 28.
      <br/>
      These pockets 70 may house the RF circuitry (e.g., Q-switch, duplexer, and pre-amplifier), preferably in close proximity of the RF antenna.
      <br/>
      In a preferred embodiment of the invention, the pockets 70 form an integral part of magnetically permeable member 16.
      <br/>
      In that case, to maintain the axial symmetry of the magnetic field, a highly magnetically permeable cover 72 is located over each pocket 70.
    </p>
    <p num="21">
      The magnetically permeable member 16 is positioned inside the drill collar 22 between the magnets 30, 32.
      <br/>
      Member 16 may consist of a single piece or a plurality of sections combined between the magnets 30, 32.
      <br/>
      Member 16 is constructed of a suitable magnetically permeable material, such as ferrite, permeable steel or another alloy of iron and nickel, corrosion resistant permeable steel, or permeable steel having a structural role in the member design, such as 15-5 Ph stainless steel.
      <br/>
      The magnetically permeable member 16 focuses the magnetic field and may also either carry drilling fluid through the drill string or provide structural support to the drill collar.
      <br/>
      Further, member 16 improves the shape of the static magnetic field generated by magnets 30, 32 and minimizes variations of the static magnetic field due to vertical and lateral tool motion during the period of acquiring the NMR signal.
      <br/>
      The segment of sleeve 28 between magnets 30, 32 may comprise magnetically permeable member 16.
      <br/>
      In that case, the segments of sleeve 28 under magnets 30, 32 shall consist of a non-magnetic member.
      <br/>
      Alternatively, a magnetically permeable chassis surrounding the segment of sleeve 28 between magnets 30, 32 defines member 16.
      <br/>
      In this case, the segment may consist of a magnetic or non-magnetic material.
      <br/>
      It is within contemplation of this invention to integrate the chassis and segment to form member 16.
    </p>
    <p num="22">
      The magnets 30, 32 are polarized in a direction parallel to the longitudinal axis of the tool 10 with like magnetic poles facing each other.
      <br/>
      For each magnet 30, 32, the magnetic lines of induction travel outward from an end of the magnet 30, 32 into the formation, along the axis of the tool 10, and travel inward to the other end of the magnet 30, 32.
      <br/>
      In the region between central magnet 30 and lower magnet 32, the magnetic lines of induction travel from the center outward into the formation, creating a static field in a direction substantially perpendicular to the axis of the tool 10.
      <br/>
      The magnetic lines of induction then travel inward symmetrically above the central magnet 30 and below the lower magnet 32 and converge in the longitudinal direction inside sleeve 28.
      <br/>
      Because of the separation, the magnitude of the static magnetic field in the central region between the central 30 and lower 32 magnet is spatially homogeneous in comparison to a saddle-point field.
    </p>
    <p num="23">
      The amount of separation between the magnets 30, 32 is determined based on several factors: (1) selecting the requisite magnetic field strength and homogeneity characteristics; (2) generating a field having small radial variations in the region of interest so that the echoes received during a pulse sequence (i.e., CPMG, CPI, or other sequences) are less sensitive to lateral tool motion; (3) depth of investigation; and (4) minimizing interference between the resonance circuitry and the low voltage telemetry bus in order to improve isolation of the receiving antenna which detects NMR signals from the formation.
      <br/>
      As the separation between the magnets 30, 32 decreases, the magnetic field becomes stronger and less homogeneous.
      <br/>
      Conversely, as the separation between the magnets 30, 32 increases, the magnetic field becomes weaker and more homogenous.
    </p>
    <p num="24">
      FIGS. 2a-2d illustrate the contour lines of .vertline.B0.vertline. corresponding to four laboratory modeled configurations of central 30 and lower 32 magnets.
      <br/>
      These modeled results were computed using a tool having a preselected diameter (a constant diameter was used for modeling all configurations).
      <br/>
      The configuration corresponding to FIG. 2a comprises a non-magnetically permeable member separating a central 30 and lower 32 magnet by 25 inches.
      <br/>
      The configuration corresponding to FIG. 2b comprises a non-magnetically permeable member separating a central 30 and lower 32 magnet by 18 inches.
      <br/>
      The configuration corresponding to FIG. 2c comprises a non-magnetically permeable member separating a central 30 and lower 32 magnet by eight inches.
      <br/>
      The low gradient sonde, corresponding to FIG. 2d, comprises a magnetically permeable member 16 separating a central 30 and lower 32 magnet by 25 inches.
      <br/>
      The aforementioned dimensions were modeled to merely illustrate the affect of distance and/or a magnetically or non-magnetically permeable member on .vertline.B0.vertline.. FIGS. 3a-3d represent the contour lines of the gradient .vertline..gradient.B0.vertline. corresponding respectively to configurations illustrated in FIGS. 2a-2d.
    </p>
    <p num="25">
      In the low gradient sonde, the magnetically permeable member 16 shunts a significant portion of the magnetic flux into the center of the tool 10.
      <br/>
      To illustrate, the magnitude of the B0 field shown in FIG. 2d at a distance of approximately seven inches radially from the longitudinal axis of tool 10 is twice as large as the B0 field shown in FIG. 2a which was generated by the same magnet configuration separated by a non-magnetically permeable member.
      <br/>
      Furthermore, the low gradient sonde produces a longer and more uniform extent of the static magnetic field in the axial direction.
      <br/>
      The NMR signal measured in this section of the tool is substantially less sensitive to the vertical motion of the tool.
      <br/>
      Referring to FIG. 3d, with the low gradient sonde, a relatively small, approximately 3 Gauss/cm, gradient is measured at a distance of approximately seven inches radially from the longitudinal axis of tool.
      <br/>
      This low gradient results in a measured NMR signal which is substantially less sensitive to the lateral motion of the tool 10.
      <br/>
      When motion is moderate, longer echo trains may be acquired in this region thereby providing more information about permeability, bound and free fluid, and hydrocarbon types.
      <br/>
      In the case of the low gradient sonde, as with other gradient designs, the proton rich borehole region surrounding the tool 10 will resonate only at frequencies higher than those being applied to the volume of investigation, i.e., there is no proton borehole signal.
      <br/>
      Other NMR sensitive nuclei found in drilling mud, such as sodium-23, resonate at significantly higher static magnetic field strengths than hydrogen when excited at the same RF frequency.
      <br/>
      For the low gradient sonde, these higher field strengths are not produced in the borehole region surrounding the tool or near the antenna where such unwanted signals could be detected.
    </p>
    <p num="26">High Gradient Sonde</p>
    <p num="27">
      Referring to FIG. 4, in another section of the tool, hereinafter referred to as the high gradient sonde, a central magnet 30 is axially separated from an upper magnet 34.
      <br/>
      The magnets 30, 34 are polarized in a direction parallel to the longitudinal axis of the tool 10 with like magnetic poles facing each other.
      <br/>
      These magnets 30, 34 generate a substantially axisymmetric static magnetic field that is radial in its polarization and, over a reasonably long cylindrical shell, the static magnetic field has a fairly constant magnitude.
      <br/>
      It is within contemplation of the subject invention to excite a plurality of cylindrical shells of spins in the formation where each shell is resonant at a different RF frequency.
    </p>
    <p num="28">
      As illustrated in FIG. 2c, if the magnet separation between 30 and 34 is approximately eight inches, the contour lines of the static magnetic field strength are substantially straight and the strength of .vertline.B0.vertline. is greater than the static magnetic field strength of the low gradient region.
      <br/>
      However, the gradient .vertline..gradient.B0.vertline. becomes larger, as illustrated in FIG. 3c, at a distance of approximately seven inches radially from the longitudinal axis of the tool.
      <br/>
      The contour lines of .vertline..gradient.B0.vertline. are curved denoting variation of the gradient in the axial direction.
    </p>
    <p num="29">
      The high gradient sonde is improved by inserting a magnetically permeable member 16 between magnets 30, 34.
      <br/>
      FIG. 4a represents contour lines of .vertline.B0.vertline. corresponding to a configuration where magnetically permeable member 16 separates the upper 34 and central 30 magnets by eight inches.
      <br/>
      The contour lines of FIG. 4a show a slightly stronger field indicating a better signal-to-noise ratio and less curvature in the axial direction than the contour lines of FIG. 2c. Also, as illustrated in FIG. 4b, the magnetically permeable member 16 produces a more constant gradient .vertline..gradient.B0.vertline. in the axial direction that may simplify interpretation of the NMR measurements influenced by diffusion.
    </p>
    <p num="30">
      In the case of the high gradient sonde, as with other gradient designs, the proton rich borehole region surrounding the tool 10 will resonate only at frequencies higher than those being applied to the volume of investigation, i.e., there is no proton borehole signal.
      <br/>
      The high gradient sonde is sensitive to a small part of the sodium from the borehole fluid.
      <br/>
      For a 30% NaCl concentration borehole fluid, possibly the worst case, the error of the estimated porosity due to the sodium signal is approximately 0.08 pu. In the low gradient sonde, the sodium signal is substantially smaller than in the high gradient sonde.
      <br/>
      Consequently, the sodium signal is negligible for both NMR sondes.
    </p>
    <p num="31">Antennas and Gradient Coils</p>
    <p num="32">
      Referring to FIGS. 2 and 4, an RF magnetic field is created in the regions of investigation by antennas 36, 38 which are provided in recessed areas 50, 52.
      <br/>
      The RF field may be produced by one or more RF antenna segments that transmit and/or receive from different circumferential sectors of the logging device.
      <br/>
      See U.S. patent app.
      <br/>
      Ser. Nos. 08/880,343 and 09/094,201 assigned to Schlumberger Technology Corporation.
      <br/>
      Preferably, each antenna 36, 38 comprises a coil 18 wound circumferentially around the recessed area 50, 52.
      <br/>
      The RF field created by such a coil arrangement is substantially axisymmetric.
      <br/>
      It is within contemplation of the subject invention to utilize the antenna 36, 38 for detecting NMR signals.
      <br/>
      However, a separate antenna or receiver may be used to detect the signals.
      <br/>
      A non-conductive material 54 is provided in the recessed area 50, 52 beneath the antenna 36, 38.
      <br/>
      The material 54 is preferably a ferrite to increase the efficiency of the antenna 36, 38.
      <br/>
      Alternatively, the material 54 may comprise plastic, rubber, or a reinforced epoxy composite material.
      <br/>
      The antennas 36, 38 are resonated by RF circuitry to create an RF magnetic field in the regions of investigation.
    </p>
    <p num="33">
      The recessed area 52 forms a shallow groove in the drill collar without reducing the inner diameter of the drill collar, which is ordinarily done to increase strength in a region of drill collar where the outer diameter has been recessed to provide an antenna.
      <br/>
      The recessed area 50 has a greater depth than recessed area 52.
      <br/>
      Due to mechanical constraints, it is only possible to have one deeply recessed area where the drill collar inner diameter is substantially reduced.
      <br/>
      It is within contemplation of the subject invention for the recessed areas 50, 52 to have substantially the same depth or for recessed area 52 to have a greater depth than area 50.
    </p>
    <p num="34">
      The cylindrical shells of spins in the region of investigation can be segmented axially or, preferably, azimuthally by using at least one directionally sensitive gradient coil 56 arranged in the recessed area 50 and/or 52.
      <br/>
      In a preferred embodiment of the invention, three gradient coils are positioned circumferentially around the recessed area and separated by an angular distance segment of 120 (degree) . Other quantities of gradient coils may be defined, either lesser or greater in number than three, and such coils may be separated by angular distances other than 120 (degree)  and/or unequal angular segments.
      <br/>
      Each coil 56 is constructed with loops of wire, which conform to the curvature of the outer surface of the material 54.
      <br/>
      The magnetic field produced by each gradient coil 56 in a region of the formation facing the coil is substantially parallel to the static magnetic field produced by the magnets.
    </p>
    <p num="35">
      As is known to those skilled in the art, in the basic NMR measurement, a pulse sequence is applied to the formation under investigation.
      <br/>
      In U.S. Pat. No. 5,596,274 issued to Abdurrahman Sezginer and U.S. Pat. No. 5,023,551 issued to Kleinberg et al., a pulse sequence, such as the Carr-Purcell-Meiboom-Gill (CPMG) sequence, first applies an excitation pulse, a 90 (degree)  pulse, to the formation that rotates the spins into the transverse plane.
      <br/>
      After the spins are rotated by 90 (degree)  and start to dephase, the carrier of the refocusing pulses, the 180 (degree)  pulses, is phase shifted relative to the carrier of the 90 (degree)  pulse sequence according to the following relationship:
      <br/>
      t90 (degree)  +- x  -t0 -�t180 (degree) y -t1 -echomaxn -t2 �n,
    </p>
    <p num="36">
      where the bracketed expression is repeated for n=1,2, . . . N, where N is the number of echoes collected in a single CPMG sequence and the echo spacing is
      <br/>
      techo =2tcp =t180 (degree) y  +t1 +t2.
    </p>
    <p num="37">
      90 (degree)  +- x denotes an RF pulse that causes the spins to rotate by a 90 (degree)  angle about the  +- x-axis, as commonly defined in the rotating frame of magnetic resonance measurements (phase alternated).
      <br/>
      The time between application of the 90 (degree)  pulse and the 180 (degree)  pulse, t0, is less than tcp, half the echo spacing.
      <br/>
      The CPMG sequence enables acquisition of a symmetric measurement (i.e., a measurement without using the gradient coils).
      <br/>
      The exact timing parameters, t0, t1, and t2, depend on various factors (e.g., the shape of the applied pulses).
    </p>
    <p num="38">
      In the subject invention, a current pulse applied to gradient coil 56 generates an additional magnetic field, substantially parallel to the static magnetic field.
      <br/>
      The current pulse is applied between the first 90 (degree)  and the 180 (degree)  phase reversing pulse.
      <br/>
      This additional field causes an additional phase shift for the spins.
      <br/>
      Since the 180 (degree)  phase reversing pulse does not compensate for the additional phase shift, the spins subjected to the additional field do not form a spin-echo.
      <br/>
      However, for spins not subjected to the additional field, a spin-echo occurs at time 2tcp with spin-echoes of successively lower amplitude occurring at time tcp after each phase reversing pulse.
      <br/>
      The pulse sequence is
      <br/>
      t90 (degree)  +- x  -t0a - DELTA -t0b -�t180 (degree) y  -t1 -echomaxn -t2 �n,
    </p>
    <p num="39">
      where t0a is the time between the 90 (degree)  pulse and the gradient pulse of duration  DELTA , t0b is the time between the gradient pulse and the 180 (degree)  reversing pulse, and
      <br/>
      t0a + DELTA +t0b =t0.
    </p>
    <p num="40">
      Due to the succeeding 180 (degree) y pulses and the inhomogeneous fields, the x-component of the NMR signal will decay within a few echoes.
      <br/>
      Therefore, we focus only on the y-component of the signal.
      <br/>
      Thus, neglecting relaxation, the first NMR echo signal can be represented as:
      <br/>
      Signal=.Fourier.m�.intg.r.di-elect cons.R3  (Mx0 +iMy0)(r) exp (-i GAMMA G(r) DELTA )dc(r)�,
    </p>
    <p num="41">where i is the imaginary complex unit;  GAMMA  is the gyromagnetic ratio; Mx0 and My0 are respectively x and y components of the magnetization at location r at the time of the first echo in the absence of the gradient pulse; G(r) is the component of the gradient field parallel to B0 at the same location;  DELTA  is the duration of the gradient pulse; and dc(r) denotes the differential sensitivity of the NMR sonde.</p>
    <p num="42">
      The gradient coils 56 offer a number of advantages for obtaining azimuthal measurements.
      <br/>
      First, because the axisymmetric antenna detects the spin-echoes, long echo trains can be recorded while the tool rotates in the borehole.
      <br/>
      Second, the coil 56 simplifies the design of an NMR-LWD tool because the coil 56 does not have the tuning requirements of an RF antenna 36, 38.
      <br/>
      Third, the same antenna 36, 38 can be used to make symmetric and axisymmetric measurements.
      <br/>
      Fourth, the coils 56 can be used to obtain NMR measurements with excellent spatial resolution, particularly vertical resolution.
    </p>
    <p num="43">
      Different modes for obtaining azimuthal NMR measurements are contemplated by the present invention.
      <br/>
      For example, a "simple spoiling" mode uses at least one coil 56 to spoil the spins in a selected quadrant where a quadrant is defined as an angular distance segment about the periphery of the tool 10, however, more coils 56 may be used to spoil a plurality of quadrants.
      <br/>
      In either case, two measurements are obtained: a symmetric phase alternated pulse sequence (PAPS) with a fixed wait time followed by a gradient PAPS having a variable wait time, with the selected quadrant spoiled by firing the coil 56 in the quadrant.
      <br/>
      In a preferred embodiment of the invention, the aforementioned gradient pulse sequence is used.
      <br/>
      Subtracting the gradient measurement from the symmetric measurement creates the azimuthal measurement.
      <br/>
      In this mode, one symmetric measurement is obtained for every two PAPS and one azimuthal scan is obtained for every eight PAPS.
      <br/>
      The measurement noise for the azimuthal measurement is higher than the noise in the symmetric or gradient measurement because the two measurements are combined.
    </p>
    <p num="44">
      It is possible to reduce the noise contribution by combining different single quadrant spoiling measurements.
      <br/>
      For example, four gradient PAPS measurements may be obtained by spoiling each quadrant.
      <br/>
      The measurements are combined to create a synthetic azimuthal and symmetric measurement.
      <br/>
      By combining measurements made without the gradient coils 56 being fired with measurements made with one or more gradient coils 56 being fired, axially or azimuthally resolved "images" of the formation can be generated.
      <br/>
      The acquired data, particularly in the form of azimuthal images of porosity and bound fluid, are very desirable for improved petrophysical interpretation in highly deviated and horizontal wellbores and for decision-making while drilling for geologically based wellbore placement.
    </p>
    <p num="45">Optimizing the Pulse Length and Operating Frequency</p>
    <p num="46">
      For a chosen operating RF frequency, there is an optimum duration for the 90 (degree)  pulse, t90, as well as for the 180 (degree)  pulses, t180, which ensures a desired signal-to-noise ratio.
      <br/>
      The search for an optimal pulse length may be performed during the master calibration of the tool, so that all pulse lengths will be correctly initialized, or when the static magnetic field changes in an unpredictable manner, such as a change due to accumulation of magnetic debris during the drilling process.
      <br/>
      See U.S. patent app.
      <br/>
      Ser. No. 09/031,926 assigned to Schlumberger Technology Corporation.
      <br/>
      This technique may also be used to choose the appropriate frequency to meet other criteria, such as keeping the depth of investigation constant.
    </p>
    <p num="47">
      The optimal pulse length may be determined by measuring the NMR response of a sample using at least two different pulse durations and using a predefined mode independent of the NMR properties of the formation.
      <br/>
      Alternatively, the optimal pulse length may be determined using at least two different pulse durations and additionally using a mode computed from the NMR properties of the formation.
      <br/>
      In the first case, stacking the data improves the signal-to-noise ratio, however, the stacking procedure may require a long period of time to acquire data from the formation.
      <br/>
      Preferably, the measured data are accumulated during a stationary time window when the tool 10 pauses from the drilling operation, such as during the time when a new section of drill pipe is added to the drill string.
      <br/>
      In the second case, if the T2 distribution of the formation is known, a best acquisition mode may be constructed which provides the largest signal-to-noise ratio for a unit of acquisition time and provides an optimal linear combination of the acquired echoes.
      <br/>
      Laboratory simulations show that optimum timing for the best acquisition mode is achieved when the duration of the echo train is approximately equal to T2,max, the dominate T2 of the formation, and when the wait time, tw, is approximately equal to 2.5 * T2,max (assuming a constant T1 /T2 ratio of 1.5).
      <br/>
      The best acquisition mode determines the optimal pulse length to within a few percent over several seconds.
      <br/>
      A similar technique may be used to optimize the NMR signal with respect to the frequency (e.g., saddle point design).
      <br/>
      The T2 distribution effectively aids the efficient tuning of pulse lengths for the tool 10.
    </p>
    <p num="48">Data Acquisition Modes</p>
    <p num="49">
      As described above, tool 10 has a plurality of antennas 36, 38.
      <br/>
      In a preferred embodiment of the invention, these antennas 36, 38 do not transmit or acquire data simultaneously.
      <br/>
      Preferably, after one antenna 36 acquires data, the other antenna 38 experiences a minimum wait time while the power supply recharges in order to transmit the next pulse sequence.
      <br/>
      It is within contemplation of the subject invention to transmit or acquire data simultaneously.
      <br/>
      Further, this invention contemplates data acquisition without a requisite wait time.
    </p>
    <p num="50">
      Based on these design preferences, a plurality of data acquisition modes may be used.
      <br/>
      By way of example, three representative timings for NMR data acquisition are described below: a fast timing suitable for water-wet sandstone zones, a slow timing appropriate for carbonate zones, and a very slow timing designed for hydrocarbon bearing zones (or invasion of oil based mud).
      <br/>
      The timings are set forth in Table I.
    </p>
    <heading>--           TABLE I</heading>
    <p num="51">
      --           Wait Time (sec.) Echo spacing (msec) Number of Echoes
      <br/>
      -- Fast      2.3            0.5              400
      <br/>
      -- Slow      4.6            0.5              800
      <br/>
      -- very slow 9.2            1.0              800
    </p>
    <p num="52">
      Several different modes may be used with each data acquisition timing, including, but not limited to, the following: simple, interleaved, and bursts.
      <br/>
      The simplest way to acquire T2 information with the tool 10 is to perform CPMG measurements with both antennas 36, 38 using the same timing.
      <br/>
      FIG. 5 illustrates the simple data acquisition mode used with the fast decaying, slowly decaying, and very slowly decaying timing from Table I. Each antenna 36, 38 alternately acquires a long pulse sequence which provides an effective porosity measurement from each antenna 36, 38.
    </p>
    <p num="53">
      With the interleaved mode, the high gradient antenna measures at least two cylindrical shells at two different frequencies while the low gradient antenna obtains a measurement using a single frequency.
      <br/>
      FIG. 6 illustrates an interleaved measurement for fast decaying samples, slowly decaying components, and very slowly decaying components using the timing from Table I.
    </p>
    <p num="54">
      The burst mode enhances the signal-to-noise ratio, especially for the fast decaying components.
      <br/>
      In addition, the burst mode provides a useful T1 based bound fluid measurement.
      <br/>
      See WO 98/29639 assigned to Numar Corporation �describes a method for determining longitudinal relaxation times, T1 �. Also, see U.S. patent app.
      <br/>
      Ser. No. 09/096,320 assigned to Schlumberger Technology Corporation �describes a method for polarizing the bound fluid of a formation�. FIG. 7 illustrates burst measurements for fast decaying samples, slowly decaying components, and very slowly decaying components using slightly modified times from Table I.
    </p>
    <p num="55">
      In addition to the simple, interleaved, and burst modes, with the subject invention, it is possible to optimize formation evaluation measurements by detecting downhole conditions which create a pause during the drilling operation, determining the drilling mode, and using the mode to control data acquisition.
      <br/>
      Standard rotary drilling operations contain many natural pauses where the tool remains stationary: connection time as a new section of drill pipe is added to the drill string, circulation time when mud is circulated and the drill pipe is possibly rotated, and fishing or jarring time while the drill string is stuck and has to be freed before drilling can resume.
      <br/>
      These natural pauses, which occur without interrupting normal drilling operations, or deliberately initiated pauses, are utilized to make NMR measurements.
      <br/>
      The drilling modes include, but are not limited to, drilling, sliding, tripping, circulating, fishing, a short trip (up or down), and drill pipe connections.
      <br/>
      Determining the drilling mode enhances the ability to obtain NMR measurements that take a long time or that benefit from a quiet environment, e.g., T1, T2, antenna tuning, and hydrocarbon typing.
      <br/>
      See U.S. patent app.
      <br/>
      Ser. No. 09/031,926 assigned to Schlumberger Technology Corporation.
      <br/>
      It is also possible to adjust acquisition modes based on changes in the environment (e.g., washout, salinity, etc.) and/or changes in the formation NMR properties (e.g., long T1 versus short T1).
    </p>
    <p num="56">
      The spin-echo amplitudes are obtained by hardware integration of the receiver voltages over a time window.
      <br/>
      The tool 10 uses phase sensitive detection to measure the in-phase and quadrature components of the spin-echo signal-plus-noise amplitudes.
      <br/>
      The techniques disclosed in U.S. Pat. No. 5,381,092 issued to Robert Freedman may be used to compute window sums downhole and transmit the window sums to the surface for T2 inversion processing and presentation.
      <br/>
      Also, the techniques disclosed in U.S. Pat. No. 5,363,041 issued to Abdurrahman Sezginer may be implemented to utilize a linear operator to map a relaxation-time distribution to spin-echoes, produce a singular value decomposition (SVD) of the linear operator, determine vectors of the SVD, and compress the spin-echo data using the vectors.
      <br/>
      Preferably, the T2 spectrum is computed downhole and transmitted to the surface.
      <br/>
      This offers the advantage of eliminating a telemetry bottleneck created by transmitting the data required to compute the T2 spectrum to the surface.
      <br/>
      A digital signal processor may be used to invert the T2 data.
      <br/>
      The amplitudes, Aj, of the spin-echoes are characterized by the following relationship:  (Equation image '3' not included in text)
    </p>
    <p num="57">where  ETA j is the noise in the measurement Aj, ai is the amplitude of the T2 distribution taken at T2,i,  (Equation image '4' not included in text)</p>
    <p num="58">
      represents the elements of matrix X, where tw is the wait time and c is a constant (the T1 /T2 ratio),  DELTA t is the echo spacing, and j=1,2, . . . N, where N is the number of echoes collected in a single pulse sequence.
      <br/>
      In matrix notation, the equation becomes A=Xa+ ETA .
      <br/>
      Since the noise,  ETA , is unknown, a can be approximated by finding a least squares solution, i.e., a minimum of the functional J=.parallel.A-Xa.parallel.2. The solution of this equation is strongly affected by noise present in the data and the solution may have negative components even though the T2 spectrum does not have negative components.
      <br/>
      To overcome this problem, a regularization term,  LAMBDA .parallel.a.parallel.2, is added to the functional and the functional J LAMBDA  (a)=.parallel.A-Xa.parallel.2 + LAMBDA .parallel.a.parallel.2 is minimized using a suitable iterative minimization algorithm (e.g., Conjugated Gradient Projection Method) under the constraint that ai &gt;= 0 for i=1 . . . M. See Ron S. Dembo and Ulrich Tulowitzski, On the Minimization of Quadratic Functions Subject to Box Constraints, Yale Department of Computer Science (September 1984) (describes the Conjugated Gradient Projection Method).
      <br/>
      The necessary time for performing the T2 inversion using a digital signal processor is very reasonable.
      <br/>
      For example, assuming 1800 echoes and 30 samples in the T2 domain, the inversion on a digital signal processor requires less than two seconds.
    </p>
    <p num="59">Pulse Programmer</p>
    <p num="60">
      For the basic NMR measurement with tool 10, electronic circuitry applies a pulse sequence to the formation under investigation.
      <br/>
      Tool 10 includes a pulse programmer 80, which adaptively selects and controls the pulse sequences applied to the formation.
      <br/>
      The pulse programmer 80 establishes the pulse sequence using information found in the Measurement Control Block 82 (See FIG. 8) and the operating conditions of the tool 10.
      <br/>
      Preferably, the Measurement Control Block 82 is stored in a downhole memory device.
      <br/>
      The structure of block 82 is fixed to allow pulse programmer 80 easily to adapt and change the timing of the pulse sequences autonomously downhole.
      <br/>
      It is advantageous to partition a portion of block 82 into a plurality of tables 84, 86, and 88.
      <br/>
      Instead of controlling all tool operations that depend on the pulse sequence from the pulse programmer 80, the tables 84, 86, 88 are used to control these operations.
      <br/>
      This allows the pulse programmer 80 to vary the pulse sequences without introducing contradictions in the tool configuration.
      <br/>
      The plurality of tables 84, 86, and 88 may include, but are not limited to, the following: a buffer table which describes the layout of stacking buffers, an acquisition table which defines the acquired signals accumulated in buffers, a filter coefficient table which prescribes the detection filter employed with a signal acquisition, a spin dynamics correction table which designates the spin dynamics correction to be used for each buffer, and a data processing table which designates the nuclear magnetic resonance characteristic calculated from the acquired buffers.
    </p>
    <p num="61">
      The pulse programmer 80 includes a pulse sequence template 94, useful for generating pulse sequences, which comprises a sequence of states dependent on repetition and timing variables.
      <br/>
      These variables are calculated from sequence configuration parameters using the calculation block 92.
      <br/>
      The calculation block 92 may be implemented as an executable or interpretive structure.
      <br/>
      Based on the physical quantity that will be measured, e.g. T2, timing variables may be defined such as the wait time, tw, the echo spacing, techo, and the number of acquired echoes.
      <br/>
      The configuration parameters include, but are not limited to, t90, pulse amplitude, and pulse shape.
      <br/>
      These parameters may be calculated periodically during calibration of the tool 10 or during operation of the tool 10 since those parameters may vary as the operating conditions of the tool 10 vary.
      <br/>
      For example, the pulse amplitude and shape depends on the antenna quality factor and, therefore, on the conductivity of the formation surrounding the tool 10.
    </p>
    <p num="62">
      Normally, after pulse programmer 80 initiates a pulse sequence, the sequence runs deterministically until it is finished.
      <br/>
      To implement certain azimuthal measurement modes with tool 10, the pulse programmer 80 has the ability to vary the pulse sequence during execution of the sequence.
      <br/>
      Programmer 80 may stop execution of the pulse sequence and enter a HALT state until an external signal ends the state at time tc or until a maximum time period, tmax, has expired.
      <br/>
      As previously discussed in the Data Acquisition Modes section of this specification, since at least one of the different modes (interleaved) which may be used with the data acquisition timing contemplates interleaving several measurements, the programmer 80 compensates for the time that passed during the HALT state.
      <br/>
      Preferably, compensation is accomplished by grouping HALT events.
      <br/>
      For example, a grouping may comprise a pair of HALT events where one HALT event operates as previously described and the other HALT event is a normal event of duration tmax -tc.
      <br/>
      Grouping events allows the programmer 80 to combine sequences having variable and deterministic timing.
    </p>
    <p num="63">
      In addition, the sequence of states, as defined in the pulse sequence template 94, may comprise several alternatives for parts of the sequence.
      <br/>
      In real time, one of the alternatives (branching) is chosen dependent on external conditions of the tool (e.g., the azimuth of the tool).
    </p>
    <p num="64">
      The foregoing description of the preferred and alternate embodiments of the present invention has been presented for purposes of illustration and description.
      <br/>
      It is not intended to be exhaustive nor to limit the invention to the precise form disclosed.
      <br/>
      Obviously, many modifications and variations will be apparent to those skilled in the art.
      <br/>
      The embodiments were chosen and described in order to best explain the principles of the invention and its practical application thereby enabling others skilled in the art to understand the invention for various embodiments and with various modifications as are suited to the particular use contemplated.
      <br/>
      It is intended that the scope of the invention be defined by the accompanying claims and their equivalents.
    </p>
  </description>
  <claims format="original" lang="en" id="claim_en">
    <claim num="1">
      <claim-text>What we claim is:</claim-text>
      <claim-text>1.</claim-text>
      <claim-text>A method of logging a well, comprising the steps of:</claim-text>
      <claim-text>a) generating a substantially axisymmetric static magnetic field into a formation traversed by a wellbore; b) generating an oscillating magnetic field into the formation; c) detecting nuclear magnetic resonance signals from the formation; d) providing a signal processor in the wellbore;</claim-text>
      <claim-text>and, e) with the signal processor, computing a distribution of spin--spin relaxation times from the detected signals.</claim-text>
    </claim>
    <claim num="2">
      <claim-text>2. The method of claim 1 further comprising the step of transmitting the distribution of spin--spin relaxation times to a surface of the wellbore.</claim-text>
    </claim>
    <claim num="3">
      <claim-text>3. The method of claim 1 further comprising the steps of applying a sequence of RF magnetic field pulses to the formation, and utilizing the distribution of spin--spin relaxation times to determine an optimal length of time each pulse is applied to the formation.</claim-text>
    </claim>
    <claim num="4">
      <claim-text>4. The method of claim 1 further comprising the step of detecting a plurality of signals having a signal plus noise amplitude Aj, where  (Equation image '5' not included in text)</claim-text>
      <claim-text>where  ETA j is noise in the signal, ai is the amplitude of the spin--spin relaxation times taken at T2,i,  (Equation image '6' not included in text)</claim-text>
      <claim-text>represents elements of matrix X, where tw is the wait time and c is a constant,  DELTA t is the echo spacing, and j=1,2, . . . N, where N is the number of echoes collected in a single pulse sequence.</claim-text>
    </claim>
    <claim num="5">
      <claim-text>5. The method of claim 4 wherein the signal plus noise amplitude A=Xa+ ETA  and further comprising the step of approximating a under a constraint that a &gt;= 0.</claim-text>
    </claim>
    <claim num="6">
      <claim-text>6. The method of claim 5 further comprising the step of determining a minimum of the functional J LAMBDA  =.parallel.A-Xa.parallel.2.</claim-text>
    </claim>
    <claim num="7">
      <claim-text>7. The method of claim 5 further comprising the steps of selecting a regularization parameter,  LAMBDA , and determining a minimum of the functional J LAMBDA  (a)=.parallel.A-Xa.parallel.2 + LAMBDA .parallel.a.parallel.2.</claim-text>
    </claim>
    <claim num="8">
      <claim-text>8. The method of claim 6 further comprising the step of minimizing the functional using a Conjugated Gradient Projection algorithm.</claim-text>
    </claim>
    <claim num="9">
      <claim-text>9. The method of claim 7 further comprising the step of minimizing the functional using a Conjugated Gradient Projection algorithm.</claim-text>
    </claim>
    <claim num="10">
      <claim-text>10. The method of claim 1 further comprising the steps of applying a sequence of RF magnetic field pulses to the formation, and utilizing the distribution of spin--spin relaxation times to select an optimal operating frequency.</claim-text>
    </claim>
    <claim num="11">
      <claim-text>11. The method of claim 1 further comprising the steps of applying a sequence of RF magnetic field pulses to the formation, and utilizing the distribution of spin--spin relaxation times to maintain a substantially constant depth of investigation in the formation.</claim-text>
    </claim>
    <claim num="12">
      <claim-text>12. An apparatus for determining a nuclear magnetic resonance property in an investigation region of earth formations surrounding a borehole, comprising: a) means for generating a substantially axisymmetric static magnetic field into a formation traversed by a wellbore; b) means for generating an oscillating magnetic field into the formation; c) means for detecting nuclear magnetic resonance signals from the formation;</claim-text>
      <claim-text>and, d) located in the wellbore, means for computing a distribution of spin--spin relaxation times from the detected signals.</claim-text>
    </claim>
    <claim num="13">
      <claim-text>13. The apparatus of claim 12 further comprising means for transmitting the distribution of spin--spin relaxation times to a surface of the wellbore.</claim-text>
    </claim>
    <claim num="14">
      <claim-text>14. The apparatus of claim 12 further comprising means for applying a sequence of magnetic field pulses to the formation, and means for utilizing the distribution of spin--spin relaxation times to determine an optimal length of time each pulse is applied to the formation.</claim-text>
    </claim>
    <claim num="15">
      <claim-text>15. The apparatus of claim 12 further comprising means for applying a sequence of magnetic field pulses to the formation, and means for utilizing the distribution of spin--spin relaxation times to select an optimal operating frequency.</claim-text>
    </claim>
    <claim num="16">
      <claim-text>16. The apparatus of claim 15 further comprising means for applying a sequence of magnetic field pulses to the formation, and means for utilizing the distribution of spin--spin relaxation times to maintain a substantially constant depth of investigation in the formation.</claim-text>
    </claim>
    <claim num="17">
      <claim-text>17. The apparatus of claim 12 further comprising means for detecting a plurality of signals having a signal plus noise amplitude Aj, where  (Equation image '7' not included in text)</claim-text>
      <claim-text>where  ETA j is noise in the signal, ai is the amplitude of the spin--spin relaxation times taken at T2,i,  (Equation image '8' not included in text)</claim-text>
      <claim-text>represents elements of matrix X, where tw is the wait time and c is a constant,  DELTA t is the echo spacing, and j=1,2, . . . N, where N is the number of echoes collected in a single pulse sequence.</claim-text>
    </claim>
    <claim num="18">
      <claim-text>18. The apparatus of claim 17 wherein the signal plus noise amplitude A=Xa+ ETA  and further comprising means for approximating a under a constraint that a &gt;= 0.</claim-text>
    </claim>
    <claim num="19">
      <claim-text>19. The apparatus of claim 18 further comprising means for selecting a regularization parameter,  LAMBDA , and determining a minimum of the functional J LAMBDA  (a)=.parallel.A-Xa.parallel.2 + LAMBDA .parallel.a.parallel.2.</claim-text>
    </claim>
    <claim num="20">
      <claim-text>20. The apparatus of claim 19 further comprising means for minimizing the functional using a Conjugated Gradient Projection algorithm.</claim-text>
    </claim>
    <claim num="21">
      <claim-text>21. The apparatus of claim 18 further comprising means for determining a minimum of the functional J LAMBDA  =.parallel.A-Xa.parallel.2.</claim-text>
    </claim>
    <claim num="22">
      <claim-text>22. The apparatus of claim 21 further comprising means for minimizing the functional using a Conjugated Gradient Projection algorithm.</claim-text>
    </claim>
  </claims>
</questel-patent-document>