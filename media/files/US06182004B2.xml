<?xml version="1.0" encoding="UTF-8"?>
<questel-patent-document lang="en" date-produced="20180805" produced-by="Questel" schema-version="3.23" file="US06182004B2.xml">
  <bibliographic-data lang="en">
    <publication-reference publ-desc="Granted patent as second publication">
      <document-id>
        <country>US</country>
        <doc-number>06182004</doc-number>
        <kind>B2</kind>
        <date>20010130</date>
      </document-id>
      <document-id data-format="questel">
        <doc-number>US6182004</doc-number>
      </document-id>
    </publication-reference>
    <original-publication-kind>B2</original-publication-kind>
    <application-reference family-id="16237493" extended-family-id="13746829">
      <document-id>
        <country>US</country>
        <doc-number>09321872</doc-number>
        <kind>A</kind>
        <date>19990528</date>
      </document-id>
      <document-id data-format="questel">
        <doc-number>1999US-09321872</doc-number>
      </document-id>
      <document-id data-format="questel_Uid">
        <doc-number>14043554</doc-number>
      </document-id>
    </application-reference>
    <language-of-filing>en</language-of-filing>
    <language-of-publication>en</language-of-publication>
    <priority-claims>
      <priority-claim kind="national" sequence="1">
        <country>JP</country>
        <doc-number>18921598</doc-number>
        <kind>A</kind>
        <date>19980703</date>
        <priority-active-indicator>Y</priority-active-indicator>
      </priority-claim>
      <priority-claim data-format="questel" sequence="1">
        <doc-number>1998JP-0189215</doc-number>
      </priority-claim>
    </priority-claims>
    <dates-of-public-availability>
      <publication-of-grant-date>
        <date>20010130</date>
      </publication-of-grant-date>
    </dates-of-public-availability>
    <classifications-ipcr>
      <classification-ipcr sequence="1">
        <text>F02D  45/00        20060101AFI20051220RMJP</text>
        <ipc-version-indicator>
          <date>20060101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>F</section>
        <class>02</class>
        <subclass>D</subclass>
        <main-group>45</main-group>
        <subgroup>00</subgroup>
        <symbol-position>F</symbol-position>
        <classification-value>I</classification-value>
        <generating-office>
          <country>JP</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>M</classification-data-source>
        <action-date>
          <date>20051220</date>
        </action-date>
      </classification-ipcr>
      <classification-ipcr sequence="2">
        <text>G05B  11/36        20060101ALI20051220RMJP</text>
        <ipc-version-indicator>
          <date>20060101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>G</section>
        <class>05</class>
        <subclass>B</subclass>
        <main-group>11</main-group>
        <subgroup>36</subgroup>
        <symbol-position>L</symbol-position>
        <classification-value>I</classification-value>
        <generating-office>
          <country>JP</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>M</classification-data-source>
        <action-date>
          <date>20051220</date>
        </action-date>
      </classification-ipcr>
      <classification-ipcr sequence="3">
        <text>G06F   1/26        20060101ALI20051220RMJP</text>
        <ipc-version-indicator>
          <date>20060101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>G</section>
        <class>06</class>
        <subclass>F</subclass>
        <main-group>1</main-group>
        <subgroup>26</subgroup>
        <symbol-position>L</symbol-position>
        <classification-value>I</classification-value>
        <generating-office>
          <country>JP</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>M</classification-data-source>
        <action-date>
          <date>20051220</date>
        </action-date>
      </classification-ipcr>
      <classification-ipcr sequence="4">
        <text>G06F  12/16        20060101ALI20051220RMJP</text>
        <ipc-version-indicator>
          <date>20060101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>G</section>
        <class>06</class>
        <subclass>F</subclass>
        <main-group>12</main-group>
        <subgroup>16</subgroup>
        <symbol-position>L</symbol-position>
        <classification-value>I</classification-value>
        <generating-office>
          <country>JP</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>M</classification-data-source>
        <action-date>
          <date>20051220</date>
        </action-date>
      </classification-ipcr>
      <classification-ipcr sequence="5">
        <text>G11C  16/10        20060101A I20051008RMEP</text>
        <ipc-version-indicator>
          <date>20060101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>G</section>
        <class>11</class>
        <subclass>C</subclass>
        <main-group>16</main-group>
        <subgroup>10</subgroup>
        <classification-value>I</classification-value>
        <generating-office>
          <country>EP</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>M</classification-data-source>
        <action-date>
          <date>20051008</date>
        </action-date>
      </classification-ipcr>
    </classifications-ipcr>
    <classification-national>
      <country>US</country>
      <main-classification>
        <text>701114000</text>
        <class>701</class>
        <subclass>114000</subclass>
      </main-classification>
      <further-classification sequence="1">
        <text>365185040</text>
        <class>365</class>
        <subclass>185040</subclass>
      </further-classification>
      <further-classification sequence="2">
        <text>701102000</text>
        <class>701</class>
        <subclass>102000</subclass>
      </further-classification>
      <further-classification sequence="3">
        <text>701115000</text>
        <class>701</class>
        <subclass>115000</subclass>
      </further-classification>
    </classification-national>
    <classifications-ecla>
      <classification-ecla sequence="1">
        <text>G11C-016/10E</text>
        <section>G</section>
        <class>11</class>
        <subclass>C</subclass>
        <main-group>016</main-group>
        <subgroup>10E</subgroup>
      </classification-ecla>
    </classifications-ecla>
    <patent-classifications>
      <patent-classification sequence="1">
        <classification-scheme office="EP" scheme="CPC">
          <date>20130101</date>
        </classification-scheme>
        <classification-symbol>G11C-016/102</classification-symbol>
        <section>G</section>
        <class>11</class>
        <subclass>C</subclass>
        <main-group>16</main-group>
        <subgroup>102</subgroup>
        <symbol-position>F</symbol-position>
        <classification-value>I</classification-value>
        <classification-status>B</classification-status>
        <classification-data-source>H</classification-data-source>
        <action-date>
          <date>20130101</date>
        </action-date>
      </patent-classification>
    </patent-classifications>
    <number-of-claims>8</number-of-claims>
    <exemplary-claim>1</exemplary-claim>
    <figures>
      <number-of-drawing-sheets>6</number-of-drawing-sheets>
      <number-of-figures>11</number-of-figures>
      <image-key data-format="questel">US6182004</image-key>
    </figures>
    <invention-title format="original" lang="en" id="title_en">Apparatus and method for controlling electric power supply in nonvolatile memory rewriting operation</invention-title>
    <references-cited>
      <citation srep-phase="examiner">
        <patcit num="1">
          <text>HOSOE KATSUHARU, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5745864</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5745864</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="2">
          <text>IWATA KATSUMI</text>
          <document-id>
            <country>US</country>
            <doc-number>5881295</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5881295</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="3">
          <text>KOMORI HIROKAZU, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>6044014</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US6044014</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="4">
          <text>KOMORI HIROKAZU, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>6046937</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US6046937</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="5">
          <text>REFSUM EDVARD, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>925724</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US-925724</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="6">
          <text>ZIMMERMANN JUERGEN, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5712969</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5712969</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="7">
          <text>TOKYO ELECTRIC CO LTD</text>
          <document-id>
            <country>JP</country>
            <doc-number>H02100743</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>JP02100743</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="8">
          <text>HITACHI LTD, et al</text>
          <document-id>
            <country>JP</country>
            <doc-number>H07271634</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>JP07271634</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="9">
          <text>HITACHI LTD</text>
          <document-id>
            <country>JP</country>
            <doc-number>H07311603</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>JP07311603</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="10">
          <text>INSIDE TECHNOLOGIES, et al</text>
          <document-id>
            <country>WO</country>
            <doc-number>9748100</doc-number>
            <kind>A1</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>WO9748100</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="11">
          <text>SCHNEIDER AUTOMATION, et al</text>
          <document-id>
            <country>WO</country>
            <doc-number>9808161</doc-number>
            <kind>A1</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>WO9808161</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <nplcit num="1">
          <text>U.S. application No. 09/257240, Ozeki et al., filed Feb. 1999.</text>
        </nplcit>
      </citation>
      <citation srep-phase="applicant">
        <nplcit num="2">
          <text>"Data Integrity of EEPROM Data During Power Up/Down Cycles" IBM Technical Diclosure bulletin, US, IMB Corp. New York, vol. 32, No. 9B, 2/1990 pp. 277-278.</text>
        </nplcit>
      </citation>
    </references-cited>
    <parties>
      <applicants>
        <applicant data-format="original" app-type="applicant" sequence="1">
          <addressbook lang="en">
            <orgname>Denso Corporation</orgname>
            <address>
              <address-1>Kariya, JP</address-1>
              <city>Kariya</city>
              <country>JP</country>
            </address>
          </addressbook>
          <nationality>
            <country>JP</country>
          </nationality>
        </applicant>
        <applicant data-format="questel" app-type="applicant" sequence="2">
          <addressbook lang="en">
            <orgname>DENSO</orgname>
          </addressbook>
          <nationality>
            <country>JP</country>
          </nationality>
        </applicant>
      </applicants>
      <inventors>
        <inventor data-format="original" sequence="1">
          <addressbook lang="en">
            <name>Komori, Hirokazu</name>
            <address>
              <address-1>Okazaki, JP</address-1>
              <city>Okazaki</city>
              <country>JP</country>
            </address>
          </addressbook>
          <nationality>
            <country>JP</country>
          </nationality>
        </inventor>
      </inventors>
      <agents>
        <agent sequence="1" rep-type="agent">
          <addressbook lang="en">
            <orgname>Nixon &amp; Vanderhye P.C.</orgname>
          </addressbook>
        </agent>
      </agents>
    </parties>
    <examiners>
      <primary-examiner>
        <name>Yuen, Henry C.</name>
      </primary-examiner>
    </examiners>
    <lgst-data>
      <lgst-status>GRANTED</lgst-status>
    </lgst-data>
  </bibliographic-data>
  <abstract format="original" lang="en" id="abstr_en">
    <p id="P-EN-00001" num="00001">
      <br/>
      A boot program or an internal combustion engine control program and data stored in a flash ROM is rewritten in a flash ROM rewriting processing by a microcomputer of an ECU.
      <br/>
      In this instance, a main relay control circuit is controlled to hold an electric power supply from a main relay, as the rewriting is disabled to be made repeatedly once the electric power supply is interrupted in the midst of the boot program.
      <br/>
      An entire electric power supply is interrupted by an ignition switch to enable the interruption in the midst of rewriting with respect to other programs.
      <br/>
      Thus, the electric power supply at the time of the program rewriting can be set to hold/stop in correspondence with the importance of the programs stored in the flash ROM.
    </p>
  </abstract>
  <description format="original" lang="en" id="desc_en">
    <heading>CROSS REFERENCE TO RELATED APPLICATION</heading>
    <p num="1">This application relates to and incorporates herein by reference Japanese Patent Application No. 10-189215 filed on Jul. 3, 1998.</p>
    <heading>BACKGROUND OF THE INVENTION</heading>
    <p num="2">
      1.
      <br/>
      Field of the Invention
    </p>
    <p num="3">The present invention relates to an apparatus and method for controlling memory rewriting operation, and more particularly to an apparatus and method which has a function of holding an electric power supply during rewriting of programs and data stored in a rewritable nonvolatile memory.</p>
    <p num="4">2. Description of Related Art</p>
    <p num="5">
      A conventional electronic control unit for controlling a predetermined control object such as an internal combustion engine has a function of holding an electric power supply during a rewriting of a program stored in a rewritable nonvolatile memory.
      <br/>
      This apparatus is so constructed that a main relay is controlled to hold the electric power supply, thereby preventing a failure of program rewriting due to an accidental interruption of the electric power supply when rewriting data are transmitted from a memory rewriting device connected externally and the program stored in the rewritable nonvolatile memory is rewritten.
    </p>
    <p num="6">
      When the communication with the memory rewriting device fails or a rewriting processing program in the electronic control unit fails to run normally, the program rewriting is interrupted and the rewriting operation need to be started again from the beginning.
      <br/>
      If the electronic control unit continues to hold the main relay turned on in this instance, the electric power supply is not stopped and the rewriting processing can not be stopped forcibly even when an ignition switch is turned off.
    </p>
    <p num="7">
      It is proposed to avoid this problem that the main relay is turned off by the ignition switch when needed.
      <br/>
      It is however disadvantageous that, when the ignition switch is turned off accidentally during a rewriting of a boot program for initiating the rewriting processing program, the boot program is destroyed disabling the program rewriting again.
    </p>
    <heading>SUMMARY OF THE INVENTION</heading>
    <p num="8">It is an object of the present invention to provide a nonvolatile memory rewriting apparatus and method which is capable of setting a hold/stop condition of an electric power supply during a program rewriting in correspondence with the importance or priority of programs stored in a rewritable nonvolatile memory.</p>
    <p num="9">
      According to the present invention, a control program for controlling a predetermined control object and a rewriting processing program including a rewriting program or a boot program, which are stored in storage areas in a rewritable nonvolatile memory and rewritable are rewritten when needed.
      <br/>
      In this instance, an electric power supply is maintained irrespective of an external interruption operation of the electric power supply, as the rewriting can not be restarted again once the electric power supply is interrupted in the course of rewriting of the rewriting processing program in the nonvolatile memory.
      <br/>
      On the other hand, the electric power supply is interrupted entirely in response to the external interruption operation of the electric power supply in the course of rewriting the control program in the nonvolatile memory.
      <br/>
      Thus, the hold/stop of the electric power supply at the time of rewriting can be set based on the importance of programs stored in the nonvolatile memory.
    </p>
    <p num="10">
      Further, the boot program in the nonvolatile memory is reduced in size to a small one which enables writing of the rewriting program from the outside into a readable/writable volatile memory.
      <br/>
      Thus, the nonvolatile memory can be reduced in its storage capacity by that reduced amount.
    </p>
    <p num="11">
      Still further, the nonvolatile memory stores therein a program which controls an electric power control circuit to hold the electric power supply irrespective of the external interruption operation of the electric power supply in the course of rewriting of the nonvolatile memory.
      <br/>
      The electric power supply is maintained similarly irrespective of the external interruption of the electric power supply during rewriting of the program which controls the electric power control circuit.
      <br/>
      Thus, as the rewriting of the program which controls the electric power control circuit is not interrupted to prevent program breakage, the electric power supply is ensured during a later rewriting of important programs.
    </p>
    <heading>BRIEF DESCRIPTION OF THE DRAWINGS</heading>
    <p num="12">
      Other objects, features and advantages of the present invention will become more apparent from the following detailed description made with reference to the accompanying drawings. In the drawings:
      <br/>
      FIG. 1 is a block diagram showing an entire construction of an ECU which is mounted on a vehicle and to which an electronic control unit according to a first embodiment of the present invention is applied;
      <br/>
      FIGS. 2A and 2B are block diagrams showing internal constructions of a flash ROM and a RAM used in the electronic control unit according to the first embodiment;
      <br/>
      FIG. 3 is a flow diagram showing a flash ROM rewriting processing of a CPU in a microcomputer of the ECU used in the electronic control unit according to the first embodiment;
      <br/>
      FIG. 4 is a flow diagram showing a main relay control processing of the CPU in the microcomputer of the ECU used in the electronic control unit according to the first embodiment;
      <br/>
      FIG. 5 is a timing diagram showing timings of rewriting an internal combustion engine control program and data by a main relay control in the electronic control unit according to the first embodiment;
      <br/>
      FIG. 6 is a flow diagram showing timings of rewriting a boot program by the main relay control in the electronic control unit according to the first embodiment;
      <br/>
      FIGS. 7A and 7B are block diagrams showing internal constructions of a flash ROM and a RAM used in a microcomputer of an ECU according to a second embodiment of the present invention;
      <br/>
      FIG. 8 is a flow diagram showing a flash ROM rewriting processing of a CPU in the microcomputer of the ECU according to the second embodiment shown in FIG. 7; and
      <br/>
      FIG. 9 is a flow diagram showing the main relay control processing of the CPU in the microcomputer of the ECU according to the second embodiment shown in FIG. 7.
    </p>
    <heading>DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENT</heading>
    <p num="13">The present invention is described in further detail hereunder with reference to various embodiments.</p>
    <p num="14">(First Embodiment)</p>
    <p num="15">
      In FIG. 1 showing an entire construction of an internal combustion engine control apparatus mounted on a vehicle, an electronic control unit (ECU) for an internal combustion engine 20 is designated by numeral 10.
      <br/>
      Sensor signals from various sensors (not shown) which sense operation conditions of the internal combustion engine 20 are applied to the ECU 10.
      <br/>
      The sensor signals from those sensors are applied to a microcomputer 11 after waveform-shaping, A/D conversion and the like processing by an input circuit 16 in the ECU 10.
      <br/>
      In the microcomputer 11, optimum control amounts of the internal combustion engine 20 are calculated based on the sensor signals from the input circuit 16, and control signals indicative of the calculation results are produced to an output circuit 17.
      <br/>
      Actuators of the internal combustion engine 20, such as an igniter, injectors (fuel injection valves) and the like which are not shown in the figure, are driven by the control signals from the output circuit 17.
      <br/>
      Various warning lights (not shown) may be driven when needed by the ECU 10.
      <br/>
      Further, the ECU 10 includes a communication circuit 18 for executing data communications with a memory rewriting device 30, which is connectable when an internal combustion engine control program and data within the microcomputer 11 are to be rewritten.
    </p>
    <p num="16">
      The microcomputer 11 in the ECU 10 is constructed as a logic arithmetic circuit, which comprises a CPU 12 as a known central processing unit, a flash ROM 13 for storing therein programs and data, a RAM 14 for storing various data, an I/O (input-output) circuit 15 for receiving signals from the input circuit 16 and the communication circuit 18, etc. and applying the control signals to the output circuit 17, a bus line connecting those circuits, and the like.
      <br/>
      Here, the flash ROM 13 is a memory, that is, a rewritable nonvolatile memory, which is capable of erasing programs and data once written and writing programs and data again.
      <br/>
      An EEPROM or the like may be used therefor.
    </p>
    <p num="17">
      Further, a main relay control circuit 19 is provided in the ECU 10.
      <br/>
      This main relay control circuit 19 is constructed as an OR circuit which receives as input signals outputs of an ignition switch 21 and the microcomputer 1.
      <br/>
      That is, the main relay circuit 19 turns on a main relay 22 to supply a battery power voltage +B to the ECU 10 and other peripheral devices (not shown), when at least one of the control signals applied from the ignition switch 21 and the microcomputer 11 is leveled to ON (high level).
    </p>
    <p num="18">
      Thus, when the main relay 22 is to be controlled based on ON/OFF of the ignition switch 21, the control signal applied from the microcomputer 11 to the main relay control circuit 19 is leveled to OFF (low level).
      <br/>
      Further, when the main relay 22 is to be held at ON irrespective of ON/OFF condition of the ignition switch 21, the control signal from the microcomputer 11 to the main relay control circuit 19 is leveled to ON.
    </p>
    <p num="19">
      The internal constructions of the flash ROM 3 and RAM 14 of the microcomputer 11 used in the ECU 10 used in the electronic control unit according to this embodiment are shown in FIGS. 2A and 2B. That is, as shown in FIG. 2A, the flash ROM 13 is formed with a storage area 131 for a boot program, which is for reading out a flash ROM rewriting program from the memory rewriting device 30 as a rewriting program and writing the same into a flash ROM rewriting program storage area 141 within the RAM 14 (FIG. 2B), and storage area 132 for storing the internal combustion engine control program and data.
      <br/>
      Those storage areas 131 and 132 are separated from each other.
    </p>
    <p num="20">
      A sequence of the flash ROM rewriting processing of the CPU 12 in the microcomputer 11 of the ECU 10 used in the first embodiment is described next based on the flow diagram shown in FIG. 3.
      <br/>
      This flash ROM rewriting routine is executed repeatedly by the CPU 12 at every program rewriting request from the memory rewriting device 30.
      <br/>
      Here, the boot program is required to exist in the boot program storage area 131 for rewriting the boot program or the internal combustion engine control program and data in the flash ROM 13 shown in FIG. 2A, and hence the boot program is started first.
    </p>
    <p num="21">
      In FIG. 3, it is checked at step S101 whether there exists a program rewriting request from the memory rewriting device 30.
      <br/>
      If the check result at step S101 is YES, that is, there exists the program rewriting request from the memory rewriting device 30, the processing proceeds to step S102, the flash ROM rewriting program as the rewriting program is written from the memory rewriting device 30 into the flash ROM rewriting program storage area 141 in the RAM 14.
      <br/>
      The processing then proceeds to step S103, and jumps to the flash ROM rewriting program written into the flash ROM rewriting program in the RAM 14.
      <br/>
      Then proceeding to step S104, a rewritable program and data, that is, the boot program or the internal combustion engine control program and data, are read out through communications with the memory rewriting device 30 made by the flash ROM rewriting program.
      <br/>
      Then proceeding to step S105, the rewritable program and data read out at step S104, that is, the boot program or the internal combustion engine control program and data, are written into the boot program storage area 131 or the internal combustion engine control program and data storage area 132 (FIG. 2A).
      <br/>
      Thus, this routine ends.
    </p>
    <p num="22">
      If the check result at step S101 is NO, that is, there is no program rewriting request from the memory rewriting device 30, on the other hand, the processing proceeds to step S106 and executes a normal internal combustion engine control processing.
      <br/>
      In the internal combustion engine control processing, the optimum ignition timing, fuel injection amount and the like are calculated based on the various sensor signals from the input circuit 16 and the internal combustion engine control program and data stored in the internal combustion engine control program and data storage area 132 in the flash ROM 13.
      <br/>
      Based on the calculation results, the control signals for driving the actuators such as the igniter, injectors and the like (not shown) are produced through the output circuit 17.
      <br/>
      Thus, the operating condition of the internal combustion engine 20 is controlled to its optimum condition by the execution of the internal combustion engine control processing.
    </p>
    <p num="23">
      According to this construction, it is only required to provide in the flash ROM 13 the boot program storage area 131 for storing a small-sized boot program, which is for writing the flash ROM rewriting program into the RAM 14.
      <br/>
      That is, as long as the boot program exists in the boot program storage area 131 within the flash ROM 13, it is enabled to revive the contents stored in the internal combustion engine control program and data storage area 132 again by rewriting even when those are broken or lost accidentally.
    </p>
    <p num="24">
      A sequence of the main relay control processing of the CPU 12 in the microcomputer 11 of the ECU 10 used in the first embodiment of the present invention is described next based on the flow diagram shown in FIG. 4 with reference to FIGS. 5 and 6.
      <br/>
      Here, FIG. 5 is a timing diagram showing timings of rewriting the internal combustion engine control program and data by the main relay control, and FIG. 6 is a timing diagram showing timings of rewriting the boot program by the main relay control.
      <br/>
      It is to be noted that this main relay control routine shows details of the main relay control which corresponds to steps S104 and S105 in FIG. 3.
    </p>
    <p num="25">
      In FIG. 4, the rewritable program and data are read out from the memory rewriting device 30 at step S201 during time periods t01-t02 in FIG. 5 and t11-t12 in FIG. 6.
      <br/>
      Then, the processing proceeds to step S202 and checks by addresses whether the object of rewriting by the rewritable program and data read out at step S201 is the storage area 132 of the internal combustion engine control program and data in the flash ROM 13.
      <br/>
      If the check result at step S202 is YES, that is, the object of rewriting by the internal combustion engine control program and data read out from the memory rewriting device 30 is the storage area 132 of the internal combustion engine control program and data in the flash ROM 13, the processing proceeds to step S203 and sets the control signal from the microcomputer 11 to the main relay control circuit 19 to OFF at time t02 in FIG. 5 so that the main relay 22 is set to the OFF-enabling condition.
      <br/>
      Thus, the main relay 22 is controlled to the OFF-enabling condition, so that cancellation of the rewriting may be executed in response to OFF of the ignition switch 21.
      <br/>
      Proceeding next to step S204, the rewriting of the internal combustion engine control program and data is executed and the routine ends.
      <br/>
      At time t03 in FIG. 5, rewriting is canceled in the midst of the rewriting in response to OFF of the ignition switch 21.
      <br/>
      As the electric power output is stopped by the OFF of the main relay 22, the rewriting processing of the internal combustion engine control program and data is forcibly interrupted.
    </p>
    <p num="26">
      As described above, the main relay control signal from the microcomputer 11 is leveled to OFF at time t02 in FIG. 5 after the flash ROM rewriting program has been read out, in the case of rewriting the internal combustion engine control program and data.
      <br/>
      As a result, the interruption of program rewriting is enabled by the OFF of the ignition switch 21 at time t03 in FIG. 5.
    </p>
    <p num="27">
      If the check result at step S202 is NO, that is, the object of rewriting by the rewritable program and data read out from the memory rewriting device 30 is the storage area 131 of the boot program within the flash ROM 13, the processing proceeds to step S205.
      <br/>
      Here, the control signal from the microcomputer 11 to the main relay control circuit 19 is set to ON during time period t11-t14 in FIG. 6, so that the boot program stored in the boot program storage area 131 in the flash ROM 13 is protected from being broken in the midst of rewriting.
      <br/>
      Thus, as shown at time t13 in FIG. 6, the main relay 22 is held ON to maintain the electric power output irrespective of ON/OFF of the ignition switch 21.
      <br/>
      Proceeding next to step S206, the rewriting of the boot program is executed.
      <br/>
      At the following step S207, the control signal from the microcomputer to the main relay control circuit 19 is returned to OFF at time t14 in FIG. 6 to set the main relay 22 to the OFF-enabling condition, thus ending this routine.
    </p>
    <p num="28">
      As described above, as the main relay control signal from the microcomputer 11 is held ON during the boot program rewriting, the rewriting of the boot program is not interrupted even when the ignition switch 21 is turned to OFF.
      <br/>
      Thus, the boot program is not broken and hence disabling the next rewriting is prevented.
    </p>
    <p num="29">(Second Embodiment)</p>
    <p num="30">A modification of the internal construction of the flash ROM 14 and the RAM 14 in the microcomputer 11 as the second embodiment is described next with reference to the block diagram shown in FIGS. 7A and 7B. The same construction or similar parts as those in FIGS. 2A and 2B are designated by the same numerals and symbols in those figures, and the detailed description of those is omitted.</p>
    <p num="31">
      In this embodiment, as shown in FIG. 7A, the flash ROM rewriting program as the rewriting program is not read in from the memory rewriting device 30, but is stored in advance in the flash ROM rewriting program storage area 133 provided in the flash ROM 13.
      <br/>
      Thus, at the time of flash ROM rewriting, the flash ROM rewriting program is read out from the internal flash ROM rewriting program storage area 133 by the boot program stored in the boot program storage area 131, and is written into the flash ROM rewriting program storage area 141.
      <br/>
      Then, the flash ROM rewriting processing is executed with respect to the actual boot program in the boot program storage area 131 in the flash ROM 13, the internal combustion engine control program and data in the internal combustion engine control program and data storage area 132, or the flash ROM rewriting program in the flash ROM rewriting program storage area 133 is executed.
    </p>
    <p num="32">
      The flash ROM rewriting processing using the flash ROM 13 and the RAM 14 in FIGS. 7A and 7B by the CPU 12 in the microcomputer 11 of the ECU 10 is described next with reference to FIG. 8.
      <br/>
      It is to be noted that this flash ROM rewriting routine is executed repeatedly by the CPU 12 at every program rewriting request form the memory rewriting device 30.
      <br/>
      Here, as it is required that the boot program exists within the boot program storage area 131 to rewrite the internal combustion engine control program and data or the flash ROM rewriting program, the boot program is started first.
    </p>
    <p num="33">
      In FIG. 8, it is checked at step S301 whether there exists a program rewriting request from the memory rewriting device 30.
      <br/>
      If the check result at step S301 is YES, that is, there exists the program rewriting request from the memory rewriting device 30, the processing proceeds to step S302, the flash ROM rewriting program as the rewriting program stored in the flash ROM rewriting program storage area 133 within the flash ROM 13 is written into the flash ROM rewriting program storage area 141 in the RAM 14 (FIG. 7B).
      <br/>
      The processing then proceeds to step S303, and jumps to the flash ROM rewriting program written into the flash ROM rewriting program storage area 141 in the RAM 14.
      <br/>
      Then proceeding to step S304, a rewritable program and data, that is, the boot program, the internal combustion engine control program and data, or the flash ROM rewriting program are read out through communications with the memory rewriting device 30 made by the flash ROM rewriting program.
      <br/>
      Then proceeding to step S305, the rewritable program and data, that is, the boot program, the internal combustion engine control program and data or the flash ROM rewriting program is written into the boot program storage area 131, the internal combustion engine control program and data storage area 132 or the flash ROM rewriting program storage area 133 (FIG. 7A).
      <br/>
      Thus, this routine ends.
    </p>
    <p num="34">
      If the check result at step S301 is NO, that is, there is no program rewriting request from the memory rewriting device 30, on the other hand, the processing proceeds to step S306 and executes the normal internal combustion engine control processing.
      <br/>
      In the internal combustion engine control processing at step S306, the optimum ignition timing, fuel injection amount and the like are calculated based on the various sensor signals from the input circuit 16 and the internal combustion engine control program and data stored in the internal combustion engine control program and data storage area 132 in the flash ROM 13.
      <br/>
      Based on the calculation results, the control signals for driving the actuators such as the igniter, injectors and the like (not shown) are produced through the output circuit 17.
      <br/>
      Thus, the operating condition of the internal combustion engine 20 is controlled to its optimum condition by the execution of the internal combustion engine control processing.
    </p>
    <p num="35">
      The sequence of the main relay control processing of the CPU 12 in the microcomputer 11 of the ECU 10 using the flash ROM 13 and the RAM 14 in FIGS. 7A and 7B are described next based on the flow diagram shown in FIG. 9.
      <br/>
      It is to be noted that this main relay control routine shows details of the main relay control which corresponds to steps S304 and S305 in FIG. 8.
    </p>
    <p num="36">
      In FIG. 9, the rewritable program and data are read out from the memory rewriting device 30 at step S401.
      <br/>
      Then, the processing proceeds to step S402 and checks by addresses whether the object of rewriting by the rewritable program and data read out at step S401 is the storage area 132 of the internal combustion engine control program and data in the flash ROM 13.
      <br/>
      If the check result at step S402 is YES, that is, the object of rewriting by the internal combustion engine control program and data read out from the memory rewriting device 30 is the storage area 132 of the internal combustion engine control program and data in the flash ROM 13, the processing proceeds to step S403 and sets the control signal from the microcomputer 11 to the main relay control circuit 19 to OFF so that the main relay 22 is set to the OFF-enabling condition.
      <br/>
      Thus, the main relay 22 is controlled to the OFF-enabling condition, so that cancellation of the rewriting may be executed in response to OFF of the ignition switch 21.
      <br/>
      Proceeding next to step S404, the rewriting of the internal combustion engine control program and data is executed and the routine ends.
    </p>
    <p num="37">
      If the checkresult at step S402 is NO, that is, the object of rewriting by the rewritable program and data read out from the memory rewriting device 30 is the storage area 131 of the boot program or the flash ROM rewriting program storage area 133 within the flash ROM 13, the processing proceeds to step S405.
      <br/>
      Here, the control signal from the microcomputer 11 to the main relay control circuit 19 is set to ON, so that the boot program stored in the boot program storage area 131 in the flash ROM 13 or the flash ROM rewriting program stored in the flash ROM rewriting program storage area 133 as the rewriting program is protected from being broken in the midst of rewriting.
      <br/>
      Proceeding next to step S406, the rewriting of the boot program or the flash ROM rewriting program is executed under the condition that the main relay 22 is held ON by the control signal (ON) from the microcomputer 11.
      <br/>
      At the following step S407, the control signal from the microcomputer 11 to the main relay control circuit 19 is returned to OFF to set the main relay 22 to the OFF-enabling condition again, thus ending this routine.
    </p>
    <p num="38">
      As described above, as the main relay control signal from the microcomputer 11 is held ON during the boot program rewriting, the rewriting of the boot program or the flash ROM rewriting program is not interrupted even when the ignition switch 21 is turned to OFF.
      <br/>
      Thus, the boot program or the flash ROM rewriting program is not broken and hence disabling the next rewriting is prevented.
    </p>
    <p num="39">
      Thus, the ECU 10 according to the present embodiment enables the interruption of the entire electric power supply upon turning off of the ignition switch 21 when the storage area 132 of the internal combustion engine control program and data in the flash ROM 13 is being rewritten.
      <br/>
      The ECU 10, however, disables the interruption of the electric power supply to hold the electric power supply from the main relay 22 irrespective of the ON/OFF condition of the ignition switch 21 by controlling the main relay control circuit 19 when the boot program storage area 131 or the flash ROM rewriting program storage area 133 of the flash ROM 13 is being rewritten.
    </p>
    <p num="40">
      Therefore, the boot program stored in the boot program storage area 131 in the flash ROM 13, the flash ROM rewriting program stored in the flash ROM rewriting program storage area 133 and the internal combustion engine control program and data stored in the internal combustion engine control program and data storage area 132 can be rewritten as needed.
      <br/>
      In this instance, the rewriting can not be enabled again, once the electric power supply is interrupted in the midst of the rewriting of the boot program storage area 131 or the flash ROM rewriting program storage area 133 in the flash ROM 13.
      <br/>
      For this reason, the main relay control circuit 19 is controlled to hold the electric power supply from the main relay 22.
      <br/>
      The entire electric power supply is interrupted through the main relay 22 in response to the electric power interruption by the ignition switch 21 to enable electric power interruption in the midst of the rewriting when the rewriting is being made to the internal combustion engine control program and data storage area 132 in the flash ROM 13.
      <br/>
      Thus, it is made possible to set hold/stop of the electric power supply at the time of program rewriting based on the importance of the program stored in the flash ROM 13.
    </p>
    <p num="41">
      The rewriting processing program is the boot program for reading the flash ROM rewriting program from the outside, and the flash ROM rewriting program is written into the RAM 14 as the readable/writable volatile memory to operate, and includes the program therein which controls the main relay control circuit 19.
      <br/>
      As a result, the boot program in the flash ROM 13 is only required to read the flash ROM rewriting program from the outside into the RAM 14 and can be reduced in size.
      <br/>
      Thus, the flash ROM 13 can be a small storage capacity type in correspondence with the reduction in the boot program storage area 131.
    </p>
    <p num="42">
      Further, the program for controlling the main relay control circuit 19 as the electric power control means during the rewriting to the flash ROM 13 as the nonvolatile memory is stored in the flash ROM 13, and controls the main relay control circuit 19 to hold the electric power supply irrespective of the external interruption of the electric power supply by the ignition switch 21 when the storage area of the program is being rewritten.
      <br/>
      That is, the program for controlling the main relay control circuit 19 to hold the electric power supply irrespective of the external interruption of the electric power supply in the course of rewriting of the flash ROM 13 is stored in the flash ROM 13.
      <br/>
      The electric power supply is held also in the course of rewriting the program for controlling the main relay control circuit 19, irrespective of the external interruption of the electric power supply.
      <br/>
      Thus, as the rewriting of the program for controlling the main relay control circuit 19 is not interrupted, the electric power supply is not stopped or interrupted temporarily at the time of rewriting important programs.
    </p>
    <p num="43">The present invention should not be limited to the disclosed embodiments, but may be implemented in many other ways without departing from the spirit of the invention.</p>
  </description>
  <claims format="original" lang="en" id="claim_en">
    <claim num="1">
      <claim-text>What is claimed is:</claim-text>
      <claim-text>1.</claim-text>
      <claim-text>An electronic control apparatus comprising:</claim-text>
      <claim-text>a rewritable nonvolatile memory for storing in respective storage areas thereof a control program for controlling a predetermined control object and a rewriting processing program, which includes a rewriting program for executing a rewriting or a boot program for reading in the rewriting program from an outside; electronic control means for executing a processing corresponding to the control program or the rewriting processing program stored in the nonvolatile memory;</claim-text>
      <claim-text>and electric power control means for holding an electric power supply in response to an instruction from the electronic control means even when the electric power supply to the electronic control means is interrupted externally, wherein the electronic control means interrupts an entire electric power supply upon an external interruption of the electric power supply when the storage area of the control program in the nonvolatile memory is being rewritten, and the electronic control means holds the electric power supply irrespective of the external interruption of the electric power supply by controlling the electric power control means when the storage area of the rewriting processing in the nonvolatile memory is being rewritten.</claim-text>
    </claim>
    <claim num="2">
      <claim-text>2. An electronic control apparatus as in claim 1, wherein the rewriting processing program is the boot program for reading the rewriting program from the outside, and the rewriting program is written into a readable/writable volatile memory and includes a program therein which controls the electric power control means.</claim-text>
    </claim>
    <claim num="3">
      <claim-text>3. An electronic control apparatus as in claim 1, wherein the program for controlling the electric power control means during a rewriting to the nonvolatile memory is stored in the nonvolatile memory, and controls the electric power control means to hold the electric power supply irrespective of the external interruption of the electric power supply when the storage area of the program is being rewritten.</claim-text>
    </claim>
    <claim num="4">
      <claim-text>4. An electronic control apparatus as in claim 1, wherein the control object is an internal combustion engine, and the electric power control means includes a relay controlled by an ignition switch provided externally of the electronic control means and the control signal of the electronic control means.</claim-text>
    </claim>
    <claim num="5">
      <claim-text>5. A control method for an electronic control apparatus which is rendered operative with an electric power supply through a relay controllable by an external switch and capable of rewriting a control program for controlling a control object and a rewriting processing program including a boot program stored in a nonvolatile memory, the control method comprising the steps of: checking whether the control program and the rewriting processing program in the nonvolatile memory is requested to be rewritten by a memory rewriting device external of the electronic control apparatus; generating a relay control signal when the checking step determines that the rewriting processing program in the nonvolatile memory is requested to be rewritten;</claim-text>
      <claim-text>and controlling the electric power supply through the relay in response to the external switch when the relay control signal is absent, and in response to the relay control signal irrespective of the external switch when the relay control signal is present, so that the electric power supply is continued when the rewriting processing program is rewritten.</claim-text>
    </claim>
    <claim num="6">
      <claim-text>6. A control method as in claim 5, further comprising the steps of: copying a memory rewriting program from a memory rewriting device into a volatile memory of the electronic control apparatus when a rewriting is requested from the memory rewriting device;</claim-text>
      <claim-text>and rewriting the boot program in the nonvolatile memory with a new boot program read out from the memory rewriting device.</claim-text>
    </claim>
    <claim num="7">
      <claim-text>7. A control method as in claim 5, further comprising the steps of: copying a memory rewriting program of the rewriting processing program from the nonvolatile memory into a volatile memory of the electronic control apparatus when a rewriting is requested from the memory rewriting device;</claim-text>
      <claim-text>and rewriting at least one of the boot program and a memory rewriting program in the nonvolatile memory with a new one of a boot program and a memory rewriting program read out from the memory rewriting device.</claim-text>
    </claim>
    <claim num="8">
      <claim-text>8. A control method as in claim 5, wherein the control object is an internal combustion engine, and an external switch is an ignition switch.</claim-text>
    </claim>
  </claims>
</questel-patent-document>