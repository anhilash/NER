<?xml version="1.0" encoding="UTF-8"?>
<questel-patent-document lang="en" date-produced="20180805" produced-by="Questel" schema-version="3.23" file="US06181435B2.xml">
  <bibliographic-data lang="en">
    <publication-reference publ-desc="Granted patent as second publication">
      <document-id>
        <country>US</country>
        <doc-number>06181435</doc-number>
        <kind>B2</kind>
        <date>20010130</date>
      </document-id>
      <document-id data-format="questel">
        <doc-number>US6181435</doc-number>
      </document-id>
    </publication-reference>
    <original-publication-kind>B2</original-publication-kind>
    <application-reference family-id="16017888" extended-family-id="13724782">
      <document-id>
        <country>US</country>
        <doc-number>08886426</doc-number>
        <kind>A</kind>
        <date>19970701</date>
      </document-id>
      <document-id data-format="questel">
        <doc-number>1997US-08886426</doc-number>
      </document-id>
      <document-id data-format="questel_Uid">
        <doc-number>14020824</doc-number>
      </document-id>
    </application-reference>
    <language-of-filing>en</language-of-filing>
    <language-of-publication>en</language-of-publication>
    <priority-claims>
      <priority-claim kind="national" sequence="1">
        <country>JP</country>
        <doc-number>17668296</doc-number>
        <kind>A</kind>
        <date>19960705</date>
        <priority-active-indicator>Y</priority-active-indicator>
      </priority-claim>
      <priority-claim data-format="questel" sequence="1">
        <doc-number>1996JP-0176682</doc-number>
      </priority-claim>
    </priority-claims>
    <dates-of-public-availability>
      <publication-of-grant-date>
        <date>20010130</date>
      </publication-of-grant-date>
    </dates-of-public-availability>
    <classifications-ipcr>
      <classification-ipcr sequence="1">
        <text>G06K  15/00        20060101A I20051008RMEP</text>
        <ipc-version-indicator>
          <date>20060101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>G</section>
        <class>06</class>
        <subclass>K</subclass>
        <main-group>15</main-group>
        <subgroup>00</subgroup>
        <classification-value>I</classification-value>
        <generating-office>
          <country>EP</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>M</classification-data-source>
        <action-date>
          <date>20051008</date>
        </action-date>
      </classification-ipcr>
      <classification-ipcr sequence="2">
        <text>G06F  12/00        20060101AFI20051220RMJP</text>
        <ipc-version-indicator>
          <date>20060101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>G</section>
        <class>06</class>
        <subclass>F</subclass>
        <main-group>12</main-group>
        <subgroup>00</subgroup>
        <symbol-position>F</symbol-position>
        <classification-value>I</classification-value>
        <generating-office>
          <country>JP</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>M</classification-data-source>
        <action-date>
          <date>20051220</date>
        </action-date>
      </classification-ipcr>
      <classification-ipcr sequence="3">
        <text>G06T   9/00        20060101A I20051008RMEP</text>
        <ipc-version-indicator>
          <date>20060101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>G</section>
        <class>06</class>
        <subclass>T</subclass>
        <main-group>9</main-group>
        <subgroup>00</subgroup>
        <classification-value>I</classification-value>
        <generating-office>
          <country>EP</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>M</classification-data-source>
        <action-date>
          <date>20051008</date>
        </action-date>
      </classification-ipcr>
      <classification-ipcr sequence="4">
        <text>H04N   1/21        20060101ALI20051220RMJP</text>
        <ipc-version-indicator>
          <date>20060101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>H</section>
        <class>04</class>
        <subclass>N</subclass>
        <main-group>1</main-group>
        <subgroup>21</subgroup>
        <symbol-position>L</symbol-position>
        <classification-value>I</classification-value>
        <generating-office>
          <country>JP</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>M</classification-data-source>
        <action-date>
          <date>20051220</date>
        </action-date>
      </classification-ipcr>
      <classification-ipcr sequence="5">
        <text>H04N   1/393       20060101ALI20051220RMJP</text>
        <ipc-version-indicator>
          <date>20060101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>H</section>
        <class>04</class>
        <subclass>N</subclass>
        <main-group>1</main-group>
        <subgroup>393</subgroup>
        <symbol-position>L</symbol-position>
        <classification-value>I</classification-value>
        <generating-office>
          <country>JP</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>M</classification-data-source>
        <action-date>
          <date>20051220</date>
        </action-date>
      </classification-ipcr>
      <classification-ipcr sequence="6">
        <text>H04N   1/413       20060101ALI20051220RMJP</text>
        <ipc-version-indicator>
          <date>20060101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>H</section>
        <class>04</class>
        <subclass>N</subclass>
        <main-group>1</main-group>
        <subgroup>413</subgroup>
        <symbol-position>L</symbol-position>
        <classification-value>I</classification-value>
        <generating-office>
          <country>JP</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>M</classification-data-source>
        <action-date>
          <date>20051220</date>
        </action-date>
      </classification-ipcr>
    </classifications-ipcr>
    <classification-national>
      <country>US</country>
      <main-classification>
        <text>358001140</text>
        <class>358</class>
        <subclass>001140</subclass>
      </main-classification>
      <further-classification sequence="1">
        <text>341051000</text>
        <class>341</class>
        <subclass>051000</subclass>
      </further-classification>
      <further-classification sequence="2">
        <text>341107000</text>
        <class>341</class>
        <subclass>107000</subclass>
      </further-classification>
      <further-classification sequence="3">
        <text>358001120</text>
        <class>358</class>
        <subclass>001120</subclass>
      </further-classification>
      <further-classification sequence="4">
        <text>358426040</text>
        <class>358</class>
        <subclass>426040</subclass>
      </further-classification>
      <further-classification sequence="5">
        <text>358426070</text>
        <class>358</class>
        <subclass>426070</subclass>
      </further-classification>
      <further-classification sequence="6">
        <text>358450000</text>
        <class>358</class>
        <subclass>450000</subclass>
      </further-classification>
      <further-classification sequence="7">
        <text>375240120</text>
        <class>375</class>
        <subclass>240120</subclass>
      </further-classification>
      <further-classification sequence="8">
        <text>382173000</text>
        <class>382</class>
        <subclass>173000</subclass>
      </further-classification>
      <further-classification sequence="9">
        <text>382175000</text>
        <class>382</class>
        <subclass>175000</subclass>
      </further-classification>
      <further-classification sequence="10">
        <text>382232000</text>
        <class>382</class>
        <subclass>232000</subclass>
      </further-classification>
      <further-classification sequence="11">
        <text>382239000</text>
        <class>382</class>
        <subclass>239000</subclass>
      </further-classification>
    </classification-national>
    <classifications-ecla>
      <classification-ecla sequence="1">
        <text>G06K-015/00</text>
        <section>G</section>
        <class>06</class>
        <subclass>K</subclass>
        <main-group>15</main-group>
        <subgroup>00</subgroup>
      </classification-ecla>
      <classification-ecla sequence="2">
        <text>G06T-009/00P</text>
        <section>G</section>
        <class>06</class>
        <subclass>T</subclass>
        <main-group>009</main-group>
        <subgroup>00P</subgroup>
      </classification-ecla>
    </classifications-ecla>
    <patent-classifications>
      <patent-classification sequence="1">
        <classification-scheme office="EP" scheme="CPC">
          <date>20130101</date>
        </classification-scheme>
        <classification-symbol>G06K-015/00</classification-symbol>
        <section>G</section>
        <class>06</class>
        <subclass>K</subclass>
        <main-group>15</main-group>
        <subgroup>00</subgroup>
        <symbol-position>F</symbol-position>
        <classification-value>I</classification-value>
        <classification-status>B</classification-status>
        <classification-data-source>H</classification-data-source>
        <action-date>
          <date>20130101</date>
        </action-date>
      </patent-classification>
      <patent-classification sequence="2">
        <classification-scheme office="EP" scheme="CPC">
          <date>20130101</date>
        </classification-scheme>
        <classification-symbol>G06K-2215/0002</classification-symbol>
        <section>G</section>
        <class>06</class>
        <subclass>K</subclass>
        <main-group>2215</main-group>
        <subgroup>0002</subgroup>
        <symbol-position>L</symbol-position>
        <classification-value>A</classification-value>
        <classification-status>B</classification-status>
        <classification-data-source>H</classification-data-source>
        <action-date>
          <date>20130101</date>
        </action-date>
      </patent-classification>
      <patent-classification sequence="3">
        <classification-scheme office="EP" scheme="CPC">
          <date>20130101</date>
        </classification-scheme>
        <classification-symbol>G06K-2215/0005</classification-symbol>
        <section>G</section>
        <class>06</class>
        <subclass>K</subclass>
        <main-group>2215</main-group>
        <subgroup>0005</subgroup>
        <symbol-position>L</symbol-position>
        <classification-value>A</classification-value>
        <classification-status>B</classification-status>
        <classification-data-source>H</classification-data-source>
        <action-date>
          <date>20130101</date>
        </action-date>
      </patent-classification>
      <patent-classification sequence="4">
        <classification-scheme office="EP" scheme="CPC">
          <date>20130101</date>
        </classification-scheme>
        <classification-symbol>G06K-2215/0014</classification-symbol>
        <section>G</section>
        <class>06</class>
        <subclass>K</subclass>
        <main-group>2215</main-group>
        <subgroup>0014</subgroup>
        <symbol-position>L</symbol-position>
        <classification-value>A</classification-value>
        <classification-status>B</classification-status>
        <classification-data-source>H</classification-data-source>
        <action-date>
          <date>20130101</date>
        </action-date>
      </patent-classification>
      <patent-classification sequence="5">
        <classification-scheme office="EP" scheme="CPC">
          <date>20130101</date>
        </classification-scheme>
        <classification-symbol>G06T-009/004</classification-symbol>
        <section>G</section>
        <class>06</class>
        <subclass>T</subclass>
        <main-group>9</main-group>
        <subgroup>004</subgroup>
        <symbol-position>L</symbol-position>
        <classification-value>I</classification-value>
        <classification-status>B</classification-status>
        <classification-data-source>H</classification-data-source>
        <action-date>
          <date>20130101</date>
        </action-date>
      </patent-classification>
      <patent-classification sequence="6">
        <classification-scheme office="EP" scheme="ICO"/>
        <classification-symbol>S06K-215/00B</classification-symbol>
      </patent-classification>
      <patent-classification sequence="7">
        <classification-scheme office="EP" scheme="ICO"/>
        <classification-symbol>S06K-215/00B2</classification-symbol>
      </patent-classification>
      <patent-classification sequence="8">
        <classification-scheme office="EP" scheme="ICO"/>
        <classification-symbol>S06K-215/00B2F</classification-symbol>
      </patent-classification>
    </patent-classifications>
    <number-of-claims>29</number-of-claims>
    <exemplary-claim>1</exemplary-claim>
    <figures>
      <number-of-drawing-sheets>10</number-of-drawing-sheets>
      <number-of-figures>12</number-of-figures>
      <image-key data-format="questel">US6181435</image-key>
    </figures>
    <invention-title format="original" lang="en" id="title_en">Image forming method and apparatus</invention-title>
    <references-cited>
      <citation srep-phase="examiner">
        <patcit num="1">
          <text>NAKAMURA KOZO, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5299027</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5299027</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="2">
          <text>PARDO LUIS TRABB, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5680521</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5680521</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="3">
          <text>GORMISH MICHAEL J, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5689589</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5689589</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="4">
          <text>TANAKA KIMIYUKI</text>
          <document-id>
            <country>US</country>
            <doc-number>5832126</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5832126</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="5">
          <text>CAMPBELL RUSS, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5479587</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5479587</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="6">
          <text>GENTILE RONALD S</text>
          <document-id>
            <country>US</country>
            <doc-number>5504842</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5504842</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="7">
          <text>GENTILE RONALD S</text>
          <document-id>
            <country>US</country>
            <doc-number>5506944</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5506944</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="8">
          <text>GENTILE RONALD S</text>
          <document-id>
            <country>US</country>
            <doc-number>5539865</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5539865</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="9">
          <text>GENTILE RONALD S</text>
          <document-id>
            <country>US</country>
            <doc-number>5544290</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5544290</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="10">
          <text>CANON KK</text>
          <document-id>
            <country>EP</country>
            <doc-number>0510923</doc-number>
            <kind>A2</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>EP-510923</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="11">
          <text>CANON KK</text>
          <document-id>
            <country>JP</country>
            <doc-number>H04323060</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>JP04323060</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="12">
          <text>CANON KK</text>
          <document-id>
            <country>JP</country>
            <doc-number>H0687251</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>JP06087251</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="13">
          <text>HEWLETT PACKARD CO</text>
          <document-id>
            <country>JP</country>
            <doc-number>H06233141</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>JP06233141</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="14">
          <text>ADOOBU SYST INC</text>
          <document-id>
            <country>JP</country>
            <doc-number>H06284297</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>JP06284297</doc-number>
          </document-id>
        </patcit>
      </citation>
    </references-cited>
    <parties>
      <applicants>
        <applicant data-format="original" app-type="applicant" sequence="1">
          <addressbook lang="en">
            <orgname>Canon Kabushiki Kaisha</orgname>
            <address>
              <address-1>Tokyo, JP</address-1>
              <city>Tokyo</city>
              <country>JP</country>
            </address>
          </addressbook>
          <nationality>
            <country>JP</country>
          </nationality>
        </applicant>
        <applicant data-format="questel" app-type="applicant" sequence="2">
          <addressbook lang="en">
            <orgname>CANON</orgname>
          </addressbook>
          <nationality>
            <country>JP</country>
          </nationality>
        </applicant>
      </applicants>
      <inventors>
        <inventor data-format="original" sequence="1">
          <addressbook lang="en">
            <name>Onodera, Ken</name>
            <address>
              <address-1>Yokohama, JP</address-1>
              <city>Yokohama</city>
              <country>JP</country>
            </address>
          </addressbook>
          <nationality>
            <country>JP</country>
          </nationality>
        </inventor>
      </inventors>
      <agents>
        <agent sequence="1" rep-type="agent">
          <addressbook lang="en">
            <orgname>Fitzpatrick, Cella, Harper &amp; Scinto</orgname>
          </addressbook>
        </agent>
      </agents>
    </parties>
    <examiners>
      <primary-examiner>
        <name>Zimmerman, Mark K.</name>
      </primary-examiner>
    </examiners>
    <lgst-data>
      <lgst-status>LAPSED</lgst-status>
    </lgst-data>
  </bibliographic-data>
  <abstract format="original" lang="en" id="abstr_en">
    <p id="P-EN-00001" num="00001">
      <br/>
      A printer converts print data in page description language into coded band data as a set of objects such as run-length data, trapezoid data and the like, in band units.
      <br/>
      Processing time to generate raster data from the coded band data is predicted, and the predicted time is used for determining whether or not the raster-data generation takes time longer than time for transmitting data to a printer engine.
      <br/>
      If it is determined that the raster-data generation time is longer than the data transmission time, raster data is generated from coded band data, and compressed and stored as preparation for printing.
      <br/>
      At this time, preparatory compression is performed to predict time for expanding the compressed data, for determining whether or not time for expansion is longer than data transmission time.
      <br/>
      If the expansion time is longer than the data trasnmission time, a coding method is changed, and the preparatory compression is performed again.
      <br/>
      If the expansion time is not longer than the data transmission time, the data is compressed and stored.
    </p>
  </abstract>
  <description format="original" lang="en" id="desc_en">
    <heading>BACKGROUND OF THE INVENTION</heading>
    <p num="1">This invention relates to an image forming method and apparatus for forming an image on a print medium.</p>
    <heading>DESCRIPTION OF RELATED ART</heading>
    <p num="2">Conventionally, an image forming apparatus, called a page printer such as a laser-beam printer, performs image formation while holding raster data for one page in a raster memory.</p>
    <p num="3">
      In recent years, the resolution of such image forming apparatus has been improved.
      <br/>
      In 600 dpi resolution, for example, a memory capacity of 4 MB is required for forming an image of one page of A4 size.
      <br/>
      Thus, the resolution is being greatly improved.
      <br/>
      Conventionally, one pixel has been represented by two levels (1 bit), however, the representation is being improved to 16 levels (4 bits) to 256 levels (8 bits), requiring an increasingly large capacity of raster memory.
    </p>
    <p num="4">To suppress the increase in cost due to the increase of memory capacity, various memory-saving techniques have been proposed.</p>
    <p num="5">
      For example, Japanese Patent Application Laid-Open No. 6-87251 discloses temporarily translating image data in page description language into coded raster representation as intermediate data, and storing the data represented in coded raster representation.
      <br/>
      In the coded raster representation, objects which were described in the page description language are objects such as "bitmap", "run-length", "trapezoid", "box" and "fast boundary encoding bitmap" in a format which can be subjected to high-speed conversion to raster data, with data amounts less than the amounts of raster data.
      <br/>
      Note that the data translated into the coded raster representation is referred to "coded raster data".
      <br/>
      Thereafter, upon printing, the coded raster data is transferred to a printing unit (printer engine), while being converted into raster data where dots are arranged in the order of raster scanning.
    </p>
    <p num="6">
      In this manner, the memory resource is saved by holding image data to be printed as coded raster data.
      <br/>
      However, in this method, there are possibilities that the processing time for rasterizing coded raster data is longer than time for transmitting data to the printer engine (this status is called "over-run"), and that coded raster data cannot be stored in a predetermined memory.
      <br/>
      To solve the inconvenience, memory requirement for these cases are predicted.
      <br/>
      If this technique is used, the resolution of an image as the object of printing and/or the tone-level representation is degraded, thus the necessary memory capacity and processing time are reduced.
    </p>
    <p num="7">
      However, this method degrades the quality of output image.
      <br/>
      Japanese Patent Application Laid-Open Nos. 4-323060, 6-233141 and 6-284297 propose to compress raster data for reducing memory capacity.
      <br/>
      Especially, Japanese Patent Application Laid-Open No. 6-233141 discloses temporarily converting data in page description language into intermediate data and storing the intermediate data.
      <br/>
      In a case where the memory capacity for storing the intermediate data is short, or processing for generating the raster data from intermediate data is complicated and it takes too much time, the raster data is generated and compressed prior to printing.
    </p>
    <p num="8">
      However, compressing, especially lossless compressing provides variation in compression ratio, therefore, the size of compressed data is unknown before compression.
      <br/>
      Accordingly, this prior art requires processing such as garbage collection upon each data compression on all the available memory areas to generate a series of available areas, or processing for dividing the memory into cells and linking the cells to manage the set of cells as a continuity of virtual available memory areas.
    </p>
    <p num="9">
      The former processing must perform the garbage collection for each data compression, which causes overhead in processing time for memory rearrangement, thus degrading the overall performance.
      <br/>
      The latter processing causes memory overhead for link structure or for writing/reading data.
    </p>
    <p num="10">Further, upon expansion of compressed data, there is no problem if the expansion speed is faster than the time for transmitting data to the printer engine; however, in use of complicated compression method, the expansion speed cannot follow data transmission time, which causes over-run.</p>
    <heading>SUMMARY OF THE INVENTION</heading>
    <p num="11">The present invention has been made in consideration of the above conventional techniques, and has its object to provide an image forming method and apparatus which reliably performs image formation without causing over-run.</p>
    <p num="12">
      Other objects and advantages besides those discussed above shall be apparent to those skilled in the art from the description of a preferred embodiment of the invention which follows.
      <br/>
      In the description, reference is made to accompanying drawings, which form a part thereof, and which illustrate an example of the invention.
      <br/>
      Such example, however, is not exhaustive of the various embodiments of the invention, and therefore reference is made to the claims which follow the description for determining the scope of the invention.
    </p>
    <heading>BRIEF DESCRIPTION OF THE DRAWINGS</heading>
    <p num="13">
      The accompanying drawings, which are incorporated in and constitute a part of the specification, illustrate embodiments of the invention and, together with the description, serve to explain the principles of the invention.
      <br/>
      FIG. 1 is a cross-sectional view showing the structure of a printer according to an embodiment of the present invention;
      <br/>
      FIG. 2 is a block diagram showing the construction of a control system of the printer of the embodiment;
      <br/>
      FIG. 3 is a flowchart showing an operation procedure of the printer;
      <br/>
      FIGS. 4 to 6 are flowcharts showing a compression processing procedure;
      <br/>
      FIG. 7 is a line graph showing the correlation between a compression ratio and expansion processing speed;
      <br/>
      FIG. 8 is a schematic diagram showing an example of a pixel of interest and reference pixels used in compression and expansion processings;
      <br/>
      FIG. 9 is an example of a probability prediction table used in compression and expansion processings;
      <br/>
      FIGS. 10 and 11 are flowcharts showing an expansion processing procedure; and
      <br/>
      FIG. 12 is a flowchart showing input-data obtaining processing called at step S1002 in FIG. 10 and step S1102 in FIG. 11.
    </p>
    <heading>DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENTS</heading>
    <p num="14">Preferred embodiments of the present invention will now be described in detail in accordance with the accompanying drawings.</p>
    <p num="15">First, the outline of an image forming method and apparatus according to embodiments bf the present invention will be described, and detailed description will be made thereafter.</p>
    <p num="16">The image forming method and apparatus of the embodiments temporarily converts input page description language data into coded raster data in band units, and performs transmission, while generating raster data from the coded raster data, to a printer engine.</p>
    <p num="17">The image forming method and apparatus reduces the memory capacity requirements by generating raster data from coded raster data by band, and compressing and storing the raster data, in any of the following cases:</p>
    <p num="18">
      1. when memory shortage is detected during generation of a band of coded raster data;
      <br/>
      2. when the predicted processing time for generating raster data from the band of coded raster data is longer than time for transmitting data to the printer engine, determined from predicted time for raster-data generation; or
      <br/>
      3. when a mapping that is instruction to perform mapping impossible in band units, such as filling a closed area between bands, has been received.
    </p>
    <p num="19">
      More specifically,
      <br/>
      A. the size of compressed data is predicted before raster data is compressed;
      <br/>
      B. if the predicted compressed data size is less than a currently-obtainable memory size, a memory area for the predicted data size is assigned, and compression is performed;
      <br/>
      C. further, if the predicted compressed data size is greater than the currently-obtainable memory size, memory rearrangement is performed to expand the currently-obtainable memory size.
      <br/>
      Then, the memory size is again compared with the predicted data size, and if the memory size is greater than the predicted data size, a memory area for the predicted data size is assigned, then compression is performed.
    </p>
    <p num="20">
      If the currently-obtained memory size is still insufficient, the current compression method is changed to another compression method requiring less memory, otherwise, the resolution and/or tone-level representation is degraded to reduce data amount.
      <br/>
      Then, compression is performed.
    </p>
    <p num="21">
      Further, according to another embodiment, the image forming method and apparatus performs compression processing while updating a probability prediction table used for arithmetic compression.
      <br/>
      In this case, the compressed data size is predicted while updating the probability prediction table, and the data of the updated probability prediction table is stored.
      <br/>
      Then, upon actual compression, the stored data of the probability prediction table is used as the initial data of the probability prediction table.
    </p>
    <p num="22">
      Further, the image forming method and apparatus according to another embodiment predicts an expansion processing speed at the same time of prediction of compressed data size, and determines whether or not the expansion processing speed is sufficient to follow data transmission to the printer engine.
      <br/>
      If the predicted expansion processing speed is not sufficient to follow data transmission, the current compression is changed to another compression method, otherwise, the resolution and/or tone-level representation is degraded to reduce data amount.
      <br/>
      Then, compression is performed.
    </p>
    <p num="23">�First Embodiment�</p>
    <p num="24">Hereinbelow, as an embodiment of the present invention, a printing system where a printer is connected to a host computer will be described in detail.</p>
    <p num="25">
      FIG. 1 is a cross-sectional view showing the mechanical structure of a laser-beam printer (hereinafter abbreviated to "LBP") applied to the present embodiment.
      <br/>
      In the LBP, a typical format of character pattern (form data) can be registered from a data source (not shown).
    </p>
    <p num="26">
      In FIG. 1, an LBP main body 1000 inputs character information (character coded) and form information supplied from the host computer (11 in FIG. 2) connected as an external device, or macro-instruction and the like, and stores the input data.
      <br/>
      Further, the LBP main body 1000 generates a character pattern or a form pattern in accordance with the input information, and forms an image on a print sheet as a print medium.
    </p>
    <p num="27">An operation panel 1012 has operation switches, an LED display and the like.</p>
    <p num="28">
      A printer control unit 1001 controls the overall LBP 1000, and analyzes character information and the like supplied from the host computer.
      <br/>
      The control unit 1001 mainly converts character information into a video signal of a corresponding character pattern, and outputs the video signal to a laser driver 1002.
    </p>
    <p num="29">
      The laser driver 1002 is a circuit for driving a semiconductor laser 1003.
      <br/>
      The laser driver 1002 turns on/off a laser beam 1004 emitted from the semiconductor laser 1003 in accordance with the input video signal.
    </p>
    <p num="30">
      The laser beam 1004 is scanned in left and right directions by a rotating polygon mirror 1005, scanning on an electrostatic drum 1006.
      <br/>
      This forms an electrostatic latent image of the character pattern on the electrostatic drum 1006.
    </p>
    <p num="31">A latent image is developed by a developing unit 1007 around the electrostatic drum 1006, then transferred to a print sheet.</p>
    <p num="32">
      A print sheet is a cut sheet contained in a paper cassette 1008 attached to the LBP 1000.
      <br/>
      The print sheet is fed into the apparatus by a paper-feed roller 1009 and conveyance rollers 1010 and 1011, and supplied to the electrostatic drum 1006.
    </p>
    <p num="33">
      FIG. 2 is a block diagram showing the construction of a control system of the printing system of the present embodiment.
      <br/>
      The control system mainly comprises the printer control unit 1001 and the host computer 11 connected to the printer control unit 1001 via a predetermined interface using an interface cable 21.
    </p>
    <p num="34">The printer control unit 1001 comprises a printer CPU 12, an RAM 18, a ROM 13, a system bus 14, an input unit 17, a printing interface (I/F) unit 15 and the like.</p>
    <p num="35">
      These elements are inter connected via the system bus 14.
      <br/>
      The system bus 14 is connected to an operation unit 1012.
      <br/>
      The printing I/F unit 15 is connected to a printing unit 16.
    </p>
    <p num="36">The input unit 17 is connected via the inter face cable 21 to the host computer 11.</p>
    <p num="37">The host computer 11 sends data of a figure, a character, a bitmap image and the like, in command-format page description language, to the printer control unit 1001.</p>
    <p num="38">
      The printer CPU 12 controls the respective devices connected to the system bus 14, based on control programs stored in the ROM 13.
      <br/>
      Further, the printer CPU 12 controls output of image information to the printing unit 16 via the printing I/F unit 15.
      <br/>
      Further, the printer CPU 12 performs communication processing with the host computer 11 via the input unit 17.
      <br/>
      The printing I/F unit 15 has two band memories 151 respectively for mapping image data to be print-outputted from the printing unit 16.
      <br/>
      Upon printing, the printer CPU 12 generates raster data in one band memory, while outputs raster data from the other band memory.
      <br/>
      For printing for one page, the raster-data generation control and raster-data output control are alternately performed by using the two band memories.
      <br/>
      The printing unit 16 prints an image based on the image information inputted via the printing I/F unit 15.
    </p>
    <p num="39">The ROM 13 holds programs for the controls of the printer CPU 12, including a program for compressing/expanding raster data, and a preparatory compression program for predicting a compressed data size.</p>
    <p num="40">
      The RAM 18 functions as a main memory or a work memory for the printer CPU 12.
      <br/>
      The RAM 18 is used as a buffering area, an area for mapping image data, a storage area for storing environmental data and the like.
      <br/>
      Further, the RAM 18 is constructed so as to expand its memory capacity by an optional RAM 19 connected to an expansion port.
    </p>
    <p num="41">Next, processing operation of the printer as the image forming apparatus of the present embodiment will be described with reference to FIG. 3.</p>
    <p num="42">When the power of the printer is turned on, the process enters step S301, at which the controller 1001 of the printer 1000 receives image data generated in page description language from the host computer 11 via the input unit 17.</p>
    <p num="43">
      At step S302, the input page description language is converted into coded raster data in band units.
      <br/>
      The coded raster data in band units will be particularly referred to as "coded band data".
    </p>
    <p num="44">The coded band data includes coded image objects such as band-based divided "bitmap", "run-length", "trapezoid", "box" and "fast boundary encoding bitmap", and a background pattern.</p>
    <p num="45">Note that the coded raster representation is disclosed in detail in Japanese Patent Application Laid-Open No. 6-87251.</p>
    <p num="46">
      At step S303, the resource necessary for mapping the coded band data into full-raster image data, i.e., processing time and memory capacity necessary for storing the coded band data for one page, are predicted.
      <br/>
      That is, by each coded band data included in one page,
      <br/>
      (a) processing time necessary for generating raster image data from coded band data, and
      <br/>
      (b) memory capacity necessary for storing the coded band data are predicted.
      <br/>
      For the above prediction, the prediction method disclosed in Japanese Patent Application Laid-Open No. 6-87251 may be employed.
      <br/>
      Briefly, an approximate time for generating raster data from objects such as "bitmap", "run-length", "trapezoid", "box" and "fast boundary encoding bitmap" included in the coded band data is given as a function between the data size and data type.
      <br/>
      Accordingly, if processing time is predicted for the respective objects included in one coded band data and the respective processing time are summed for all band data, the processing time for the band can be predicted.
    </p>
    <p num="47">
      Further, a necessary memory capacity can be obtained from the size of the area in which the coded band data is stored.
      <br/>
      At step S304, it is determined whether or not the resource necessary for generating raster image data from coded band data of the current band can be obtained, based on the result of prediction at step S303.
      <br/>
      Regarding the memory capacity, a determination is not only made as to whether or not the memory capacity for generating raster data from the coded band data is sufficient.
      <br/>
      For example, regarding one band, if the predicted processing time necessary for generating raster image data from the coded band data exceeds a predetermined period, the raster data of the band is held as compressed raster data.
      <br/>
      In this case, a work area for compressing the raster data as well as the work area for generating the raster data is required.
      <br/>
      The determination is made on memory requirement, including such work area.
    </p>
    <p num="48">
      Note that the processing at step S304 may be performed after one coded band data has been generated, or after coded band data of all the bands included in one page has been generated.
      <br/>
      Upon determining whether or not the memory resource is insufficient, it is preferable to perform the processing at step S304 periodically, e.g., upon each generation of new coded band data from input data.
    </p>
    <p num="49">
      At step S304, if it is determined that the resource necessary for generating bitmap data of the current band is sufficient, the process proceeds to step S313.
      <br/>
      At step S313, it is determined whether or not processing of the current page has been completed.
      <br/>
      If coded band data still remains, the process returns to step S301, and the processing is performed on the remaining data in page description language.
    </p>
    <p num="50">On the other hand, if it is determined at step S304 that the printer resource is insufficient, i.e., the available memory capacity is insufficient or too much time is necessary for generating raster data, the process proceeds to step S305.</p>
    <p num="51">
      At step S305 and the subsequent steps, the coded band data is converted into compressed raster data.
      <br/>
      Hereinbelow, the procedure of conversion will be described.
    </p>
    <p num="52">At step S305, regarding a band for which it has been predicted that too much time is required for generating raster data or the memory capacity is insufficient, raster data is generated from the coded band data and mapped in one of two pre-allocated band memory areas.</p>
    <p num="53">Next, at step S306, the compressed data size of the raster data is determined by preparatory compression processing, and probability prediction table data for actual compression is obtained.</p>
    <p num="54">Note that the preparatory compression processing will be described in detail later with reference to the flowcharts of FIGS. 4 to 6.</p>
    <p num="55">
      At step S307, processing time for expansion is predicted from the compressed data size predicted at step S306.
      <br/>
      The prediction of expansion time depends on the compression method.
      <br/>
      Generally, expansion time is in strong correlation with a compression ratio.
      <br/>
      In an arithmetic compression method using prediction from peripheral pixels around a pixel of interest, used in the present embodiment, it is experimentally determined that the compression ratio and the expansion processing speed are in correlation as shown in FIG. 7.
      <br/>
      Accordingly, processing time for expansion can be substantially predicted by using the compressed data size predicted at step S306.
    </p>
    <p num="56">
      Then, the predicted expansion time is compared with time necessary for transferring band raster data by the printing I/F unit 15.
      <br/>
      As a result, if it is determined that the expansion time is shorter, i.e., the expansion processing can follow the printing, the process proceeds to step S308.
      <br/>
      At step S308, the compressed data size predicted at step S306 is compared with the currently-available memory capacity.
      <br/>
      If it is determined that the memory capacity is sufficient, the process proceeds to step S312, where the band raster data mapped in the band memory is compressed and stored in the memory, and the process returns to step S313.
    </p>
    <p num="57">If it is determined at step S308 that the memory capacity is insufficient, the process proceeds to step S309, at which memory area containing coded band data that has been already used for generating raster data, and memory area containing compressed raster data that has become unnecessary are released, thus garbage collection on the entire memory is performed, to obtain a continuity of available memory areas by memory rearrangement.</p>
    <p num="58">
      At step S310, the available memory capacity after the memory rearrangement is compared with the compressed data size predicted at step S306.
      <br/>
      If it is determined that the memory capacity is sufficient, the process proceeds to step S312.
      <br/>
      If it is determined that the memory capacity is still insufficient, the process proceeds to step S311, to change the compressing means.
    </p>
    <p num="59">
      More specifically, in the present embodiment, the compression method of the compressing means is changed to a method which reduces the data amount of raster data while appropriately thinning the data, and again compresses the raster data by the same compression method, and upon expansion, interpolates the thinned data with peripheral pixels.
      <br/>
      This method is an irreversible compression method which causes image degradation.
      <br/>
      When the compressing means has been changed, the process returns to step S306, at which the prediction of compressed data size is performed again.
    </p>
    <p num="60">On the other hand, if it is determined at step S313 that the mapping of the current page has been completed, the process proceeds to step S314, at which printing of the page is started.</p>
    <p num="61">
      At step S314, raster data is generated from the coded band data obtained at step S302, by each band, otherwise, the compressed raster data compressed at step S312 is expanded, and mapped alternately in the two band memories 151.
      <br/>
      At this time, it is assured that the time for mapping the raster data in the band memory is shorter than time for transmitting the band raster data to the printing unit 16, therefore, over-run never occurs.
    </p>
    <p num="62">At step S315, the raster data is transferred by the printing I/F unit 15 to the printing unit 16.</p>
    <p num="63">
      Steps S314 and S315 are executed in parallel in the two band memories, and in one band memory, sequentially executed.
      <br/>
      That is, when one band raster image has been transferred from one band memory by the printing I/F unit 15, the subsequent band raster image is mapped in the other band memory.
      <br/>
      The data generation and data output are alternately performed in the two band memories.
    </p>
    <p num="64">When the current page has been outputted, the process proceeds to step S316 for processing of the next page.</p>
    <p num="65">An image for one page is outputted by the above procedure.</p>
    <p num="66">&lt;Algorithms of Preparatory and Actual Compression&gt;</p>
    <p num="67">Next, algorithms of the preparatory compression at step S306 and the actual compression at step S312 will be described in detail with reference to the flowchart of FIGS. 4 to 6.</p>
    <p num="68">This procedure is based on the ITUT Reccommendations T.81 (so-called JBIG (Joint Bi-level Image Group) compression).</p>
    <p num="69">
      When preparatory or actual compression has been started, it is determined at step S401 whether preparatory compression or actual compression is currently performed.
      <br/>
      If it is determined that preparatory compression is currently performed, the process proceeds to step S403, at which all the values of columns ST� � and MPS� � of a prediction table for compression are initialized with a predetermined initial value "0".
    </p>
    <p num="70">On the other hand, if it is determined that actual compression is currently performed, the process proceeds to step S402, at which all the values of prediction table columns ST'� � and MPS'� �, obtained by preparatory compression and stored in the RAM 18, are read and stored in the prediction table columns ST� � and MPS� �.</p>
    <p num="71">
      Next, at step S404, register variables SC, A, C and CT necessary for arithmetic compression are initialized to predetermined values (SC=0, A=0 * 10000, C=0, CT=11).
      <br/>
      The meanings of these register variables are:
    </p>
    <p num="72">
      --
      <br/>
      --                    SC:    counter
      <br/>
      --                    A:     interval register
      <br/>
      --                    C:     coded register
      <br/>
      --                    CT:    counter
    </p>
    <p num="73">Next, at step S405, as shown in FIG. 8, the value of a pixel of interest "?" to be encoded is entered in a register PIX, and its peripheral reference pixels "X" are entered in a register CX.</p>
    <p num="74">
      Note that in the present embodiment, ten pixels, as shown in FIG. 8, are employed as the peripheral reference pixels.
      <br/>
      The number of pixels is not limited to ten, and further, reference pixel positions are arbitrarily set.
      <br/>
      In this case, however, as the number of pixels increases, the size of prediction table increases, and if the number of pixels is too small, the compression ratio is degraded.
      <br/>
      Further, the compression ratio degrades unless the reference pixel positions are determined in consideration of the characteristic of image data to be compressed.
    </p>
    <p num="75">
      Next, at step S406, a predicted pixel value MPS�CX� corresponding to the reference pixel stored in the register CX is compared with the value of the pixel of interest PIX to determine whether or not they correspond with each other.
      <br/>
      If these values correspond with each other, the process proceeds to step S414, at which a subinterval value (LSZ�ST�CX��) of current inferior probability is obtained from the table in FIG. 9, then subtracted from a current interval value A, thus a subinterval value of superior probability is obtained.
    </p>
    <p num="76">
      Next, at step S415, if the superior-probability subinterval value is less than 50% (0 * 8000), the process proceeds to step S416.
      <br/>
      If the superior-probability subinterval value is equal to or greater than the inferior-probability subinterval value, the process proceeds to step S417, at which the inferior-probability subinterval value is added to the coded strings, and the interval value is updated with this inferior-probability subinterval value.
    </p>
    <p num="77">
      Note that in FIG. 9, the column ST contains reference numbers of pixel pattens; LSZ; probability values of the pixel patterns.
      <br/>
      The table as shown in FIG. 9 is prepared in advance.
    </p>
    <p num="78">
      Next, the process proceeds to step S418, at which the prediction probability corresponding to the reference pixel value CX is updated to a value of the superior probability table from the table in FIG. 9.
      <br/>
      At step S419, coded-output processing (RENORM to be described later) from the coded strings is performed, then process proceeds to step S420.
    </p>
    <p num="79">
      On the other hand, if it is determined at step S406 that the predicted pixel value MPS�CX� corresponding to the reference pixel value CX does not correspond to the value of the pixel of interest PIX, the process proceeds to step S407, at which the current inferior-probability subinterval value (LSZ�ST�CX��) is obtained from the table in FIG. 9.
      <br/>
      Then, the obtained value is subtracted from the current interval value A, thus a superior-probability subinterval value is obtained.
    </p>
    <p num="80">Next, at step S408, if this superior-probability subinterval value is greater than the inferior-probability subinterval value, the process proceeds to step S409, at which the inferior-probability subinterval is added to the coded array, and the interval value is updated with this inferior-probability subinterval value.</p>
    <p num="81">
      At step S410, it is determined whether or not a superior pixel/inferior pixel inverse switch (SWITCH�ST�CX��) of the current probability table is ON (1).
      <br/>
      If it is ON (1), the process proceeds to step S411, at which the value of the predicted pixel value MPS�CX� is inversed.
    </p>
    <p num="82">
      Next, at step S412, the prediction probability table column ST�CX� corresponding to the reference pixel CX is updated to a value of the inferior probability table from the table in FIG. 9.
      <br/>
      At step S413, coded-output processing (RENORM_E to be described later) from the coded strings is performed, and the process proceeds to step S420.
    </p>
    <p num="83">
      At step S420, it is determined whether or not compression of the entire image data has been completed.
      <br/>
      If NO, the process returns to step S405, at which compression is continued with the next pixel as a new pixel of interest.
    </p>
    <p num="84">On the other hand, if it is determined at step S420 that all the compression of the entire image data has been completed, the process proceeds to step S421, at which termination processing of compression (FLUSH to be described later) is executed, thus the compression ends.</p>
    <p num="85">Next, the coded-output processing RENORM_E at steps S413 and S419 will be described with reference to the flowchart of FIG. 5.</p>
    <p num="86">
      At step S501, the interval register A and the coded register C are shifted by one bit.
      <br/>
      The number of shifts is counted by the counter CT.
    </p>
    <p num="87">
      At step S502, the counter CT is checked.
      <br/>
      If the value of the counter CT is "0", the process proceeds to step S503 and the subsequent steps, and compressed data for one byte is read from the coded register C. on the other hand, if the value of the counter CT is not "0", the process proceeds to step S518, at which if the value of the interval register A is not less than "0 * 8000", the RENORM_E processing is terminated, while if the interval register A is less than "0 * 8000", the process returns to step S501.
    </p>
    <p num="88">At step S503, first, the head one byte of the value of the coded register C, to be outputted to a variable TEMP, and a carry display bit are stored.</p>
    <p num="89">At step S504, if the variable TEMP is greater than "0 * ff", i.e., it has a carry, the process proceeds to step S505.</p>
    <p num="90">At step S505, the carry is added to a variable BUFFER holding the latest temporary output, which is not equal to "0 * ff".</p>
    <p num="91">If it is determined at step S521 that the current compression is not preparatory compression, the value is outputted (written) at step S506.</p>
    <p num="92">
      Note that in preparatory compression, the output (write) is not made by actually writing the value in the memory, but only by incrementing the data counter.
      <br/>
      In the present compression, with the increment of the data counter, data for one byte is written in the actual memory, and an output-data pointer is updated.
    </p>
    <p num="93">Next, at step S507, if the byte in the BUFFER has been temporarily outputted, all the bytes that were converted by the carry and resulted in "0 * 00" are outputted, the number of bytes is equal to the value of the counter SC that counted the number of "0 * 00" bytes since the value of the variable BUFFER was temporarily outputted.</p>
    <p num="94">Next, at step S508, the counter SC is cleared.</p>
    <p num="95">
      At step S509, the value from which the carry has been subtracted from the variable TEMP is set in the BUFFER as a new temporary output byte.
      <br/>
      If it is determined at step S521 that the current compression is preparatory compression, the amount of data to be written into a predetermined counter Camt is integrated at step S522.
    </p>
    <p num="96">On the other hand, returning to step S504, if it is determined that there is no carry, "TEMP=0 * ff", the process proceeds to step S510.</p>
    <p num="97">
      At step S510, it is checked whether or not the output byte TEMP is "0 * ff".
      <br/>
      If it is determined that the output byte TEMP is "0 * ff", the process proceeds to step S515, at which the counter SC is simply incremented so as to delay output until the carry is resolved.
      <br/>
      On the other hand, if it is determined at step S510 that the output byte TEMP is not "0 * ff", and if it is determined at step S519 that the current compression is not the preparatory compression, the process proceeds to step S511, at which the value of the variable BUFFER, holding the latest temporary output that is not equal to "0 * ff", is outputted (written).
      <br/>
      Then, at step S512, all the bytes that were converted by the carry and resulted in "0 * 00" are outputted, the number of bytes is equal to the value of the counter SC that counted the number of "0 * 00" bytes since the value of the variable BUFFER was temporarily outputted.
    </p>
    <p num="98">At step S513, the counter SC is cleared.</p>
    <p num="99">At step S514, the variable TEMP is set to the variable BUFFER as a new temporary output byte.</p>
    <p num="100">
      If it is determined at step S519 that the current compression is the preparatory compression, the amount of data to be written into the predetermined counter Camt is integrated.
      <br/>
      This counter is the same as that used at step S522.
      <br/>
      The value of the counter Camt becomes a predicted compressed data amount.
    </p>
    <p num="101">At step S516, codes for one byte are removed from the value of the coded register C.</p>
    <p num="102">At step S517, the value of the bit-number counter CT is initialized to "8", then, the process proceeds to step S518.</p>
    <p num="103">
      At step S518, it is checked whether or not the interval register A is less than "0 * 8000".
      <br/>
      If YES, the process returns to step S501 to repeat the processing, while if NO, terminates the RENORM_E processing.
    </p>
    <p num="104">&lt;Termination of Compression Processing&gt;</p>
    <p num="105">Next, the termination of compression (FLUSH) at step S421 will be described with reference to the flowchart of FIG. 6.</p>
    <p num="106">
      At step S601, the value of the interval register A and the value of the coded register C are added, then "1" is subtracted from the value result from the addition, and sixteen significant bits are masked.
      <br/>
      The resulting value is set to the variable TEMP.
    </p>
    <p num="107">
      At step S602, the variable TEMP is compared with the value of the coded register C. If the variable TEMP is less than the value of the coded register C, the process proceeds to step S603, at which the coded register C is set to "TEMP+0 * 8000".
      <br/>
      If the variable TEMP is not less than the value of the coded register C, the process proceeds to step S604, at which the coded register C is set to the variable TEMP.
    </p>
    <p num="108">Thus, the coded register C has been set to a value with the possible maximum number of zero bits in �C, C+A-1�.</p>
    <p num="109">
      At step S605, the coded register C is shifted by the value of the bit counter CT.
      <br/>
      At step S606, it is determined whether or not the coded register value has a carry.
      <br/>
      If YES, the process proceeds to step S607, while if NO, proceeds to step S609.
    </p>
    <p num="110">At step S607, the value obtained by adding the carry to the variable BUFFER is outputted (written).</p>
    <p num="111">At step S608, all the bytes that were converted by the carry and resulted in "0 * 00" are outputted, the number of bytes is equal to the value of the counter SC that counted the number of "0 * ff" bytes since the value of the variable BUFFER was temporarily outputted.</p>
    <p num="112">On the other hand, if it is determined at step S606 that the coded register value has no carry, the process proceeds to step S609, at which the variable BUFFER is outputted (written).</p>
    <p num="113">At step S610, all the bytes from the BUFFER are outputted as "0 * ff ". The number of bytes is equal to the value of the counter SC that has counted the number of "0 * ff" bytes since the value of the variable BUFFER was temporarily outputted.</p>
    <p num="114">Next, the process proceeds to steps S611 and S612, at which codes for two bytes are outputted (written) from the coded register C.</p>
    <p num="115">
      Finally, at step S613, it is determined whether or not the current compression is preparatory compression.
      <br/>
      If YES, the process proceeds to step S614, at which all the values of the final prediction table columns ST� � and MPS� �, sequentially updated by the preparatory compression, are stored in the prediction table columns ST'� � and MPS'� � which are storage areas in the RAM 18.
      <br/>
      The stored values are read and used upon actual compression and expansion.
    </p>
    <p num="116">&lt;Expansion Processing&gt;</p>
    <p num="117">Next, the expansion processing on compressed raster data, at step S314 (FIG. 3) will be described with reference to the flowcharts of FIGS. 10 and 11.</p>
    <p num="118">At step S1001, the prediction table columns ST'� � and MPS'� �, generated in the above preparatory compression and stored, are read into the prediction table columns ST� � and MPS� �.</p>
    <p num="119">
      At step S1002, the coded register C is cleared to "0", then the data is obtained for one byte by input-data obtaining processing (BYTEIN) to be described later, and the register is shifted by eight bits.
      <br/>
      Thus, data for three bytes are obtained, and the interval register A is initialized to "0 * 10000".
    </p>
    <p num="120">
      At step S1003, the peripheral reference pixel "X" of the pixel of interest "?" as shown in FIG. 8 is entered in the register CX.
      <br/>
      Note that the peripheral reference pixel must be the same as that upon compression.
    </p>
    <p num="121">Although the detailed explanation will be omitted, processing similar to that upon compression is performed at steps S1004 to S1008, thus the pixel value PIX is reproduced.</p>
    <p num="122">Note that CHIGH (S1005) in FIG. 10 denotes the value of the sixteen significant bits of the coded register C. FIG. 11 shows the flowchart of coded-input processing (RENORM_D) at step S1017, and FIG. 12, the flowchart of input-data obtaining processing (BYTEIN) called at step S1002 in FIG. 10 and S1102 in FIG. 11.</p>
    <p num="123">
      As described above, in the printer according to the present embodiment, data which seems to cause over-run due to too much time for mapping raster data from coded band data, or data requiring too large memory capacity, are converted into raster data and compressed in advance.
      <br/>
      This prevents over-run or status where the data cannot be stored into a memory.
      <br/>
      Further, the present embodiment employs, as a method for compressing raster data, a method which easily predicts expansion time from the result of compression.
      <br/>
      This more exactly predicts occurrence of over-run or memory shortage.
      <br/>
      Accordingly, regarding data that requires no mapping into raster data and compression, such processings are avoided, thus overhead of processing for prevention of over-run can be minimized.
    </p>
    <p num="124">
      The present embodiment employes the compression procedure based on the JBIG method, therefore, prediction tables LST and MPS, more suitable to data to be compressed, can be generated by preparatory compression.
      <br/>
      Accordingly, the preparatory compression can improve the compression ratio as well as prediction of compressed data size.
    </p>
    <p num="125">�Other Embodiments�</p>
    <p num="126">
      In the above embodiment, the compression is made by utilizing a part of sequential mode in so-called JBIG compression.
      <br/>
      The compression mode may be a progressive mode, otherwise, an arbitrary optional function such as ATMOVE may be added.
      <br/>
      Further, any other arithmetic coding compression method may be employed.
    </p>
    <p num="127">Further, if the improvement in compression ratio by the preparatory compression is not intended, the compression method is not limited to arithmetic coding compression, but an arbitrary compression method can be adopted from various methods such as a packbits compression, LZ77 and LZ78 compressions, a Huffman compression, an MR compression, an MH compression, an MMR compression, FBE compression and a JPEG compression.</p>
    <p num="128">
      Further, if a sufficient compression ratio has not been obtained, the present embodiment employs a lossy compression that reduces data amount by thinning pixels and retries compression, then interpolates the compressed data upon expansion.
      <br/>
      However, it may be arranged such that a compression method having a relatively-low compression ratio such as a packbits compression is switched to a compression method having a relatively-high compression ratio such as a JBIG or LZ77 compression; otherwise, a lossless compression with a low compression ratio such as a Huffman compression is switched to a lossy compression with a high compression ratio such as a JPEG compression.
    </p>
    <p num="129">Further, it is more preferable that the same JPEG compression is used, and its compression ratio is changed to a higher compression ratio (low quality) by parameters.</p>
    <p num="130">In the above embodiments, the processing speed upon expansion is predicted by experimentally using the compression ratio (ratio between data size before compression and compressed data size), however, the prediction method differs in use of compression method(s) other than that of the present embodiment.</p>
    <p num="131">
      Similar to the above embodiment, in use of a compression method having a strong correlation between expansion time and compression ratio, the expansion time may be predicted by experimentally using the correlation as in the above embodiment.
      <br/>
      In use of compression method(s) without such correlation, upon preparatory compression, preparatory expansion may also be performed to obtain expansion time.
      <br/>
      In this case, it provides a demerit of increase in processing time for preparatory compression, however, it provides a merit of more exact prediction of expansion time.
    </p>
    <p num="132">The present invention can be applied to a system constituted by a plurality of devices or to an apparatus comprising a single device.</p>
    <p num="133">
      Furthermore, the invention is also applicable to a case where the invention is embodied by supplying a program to a system or apparatus.
      <br/>
      In this case, a storage medium, storing a program according to the invention, constitutes the invention.
      <br/>
      The system or apparatus installed with the program read from the medium realizes the functions according to the invention.
    </p>
    <p num="134">The present invention can be applied to a system constituted by a plurality of devices (e.g., host computer, interface, reader, printer) or to an apparatus comprising a single device (e.g., copy machine, facsimile).</p>
    <p num="135">Further, the object of the present invention can be also achieved by providing a storage medium storing program codes for performing the aforesaid processes to a system or an apparatus, reading the program codes with a computer (e.g., CPU, MPU) of the system or apparatus from the storage medium, then executing the program.</p>
    <p num="136">In this case, the program codes read from the storage medium realize the functions according to the embodiments, and the storage medium storing the program codes constitutes the invention.</p>
    <p num="137">Further, the storage medium, such as a floppy disk, a hard disk, an optical disk, a magneto-optical disk, CD-ROM, CD-R, a magnetic tape, a non-volatile type memory card, and ROM can be used for providing the program codes.</p>
    <p num="138">Furthermore, besides aforesaid functions according to the above embodiments are realized by executing the program codes which are read by a computer, the present invention includes a case where an OS (operating system) or the like working on the computer performs a part or entire processes in accordance with designations of the program codes and realizes functions according to the above embodiments.</p>
    <p num="139">Furthermore, the present invention also includes a case where, after the program codes read from the storage medium are written in a function expansion card which is inserted into the computer or in a memory provided in a function expansion unit which is connected to the computer, CPU or the like contained in the function expansion card or unit performs a part or entire process in accordance with designations of the program codes and realizes functions of the above embodiments.</p>
    <p num="140">In a case where the present invention is applied to the aforesaid storage medium, the storage medium stores program codes corresponding to the flowcharts described in the embodiments.</p>
    <p num="141">As described above, according to the embodiments, the compressed data size is predicted by preparatory compression, which minimizes the number of times of garbage correction, and prevents degradation of the overall performance due to processing time overhead caused by memory rearrangement.</p>
    <p num="142">Further, the compression ratio of actual compression can be improved by reusing a prediction probability table generated upon preparatory compression.</p>
    <p num="143">Further, the prediction of expansion time upon preparatory expansion avoids over-run where expansion of compressed data does not follow the data transmission to the printer engine.</p>
    <p num="144">
      The present invention is not limited to the above embodiments and various changes and modifications can be made within the spirit and scope of the present invention.
      <br/>
      Therefore, to appraise the public of the scope of the present invention, the following claims are made.
    </p>
  </description>
  <claims format="original" lang="en" id="claim_en">
    <claim num="1">
      <claim-text>What is claimed is:</claim-text>
      <claim-text>1.</claim-text>
      <claim-text>An image forming apparatus which performs printing processing based upon print data inputted from a host computer and described in a page description language, said apparatus comprising:</claim-text>
      <claim-text>generation means for generating intermediate data in band units, based upon the print data; determination means for determining whether raster data of a band of interest should be generated from the intermediate data and stored prior to printing, or the raster data of the band of interest should be generated from the intermediate data synchronously with printing and transmitted to a printing unit; prediction means for predicting a size of compressed raster data of the band of interest compressed by a first compression method and an expansion time required to expand the compressed raster data based upon data size, in a case in which it is determined that the raster data of the band of interest should be generated from the intermediate data and stored prior to printing; change means for changing the first compression method to a second compression method, if the expansion time predicted by said prediction means is greater than a predetermined value, wherein an expansion time required to expand compressed raster data of the band of interest compressed by the second compression method is less than the predetermined value; compression means for compressing the raster data of the band of interest by the first compression method to generate compressed raster data if the expansion time predicted by said prediction means is less than the predetermined value, or compressing the raster data of the band of interest by the second compression method if the expansion time predicted by said prediction means is greater than the predetermined value;</claim-text>
      <claim-text>and print control means for expanding the compressed raster data compressed by said compression means and transmitting the expanded raster data to the printing unit.</claim-text>
    </claim>
    <claim num="2">
      <claim-text>2. The image forming apparatus according to claim 1, wherein said prediction means predicts the expansion time by utilizing correlation between a compression ratio and expansion processing time, based on the compressed data size of the raster data predicted by said prediction means.</claim-text>
    </claim>
    <claim num="3">
      <claim-text>3. The image forming apparatus according to claim 1, wherein said change means changes the compression method to a compression method which reduces the expansion processing time, if the expansion time predicted by said prediction means is greater than a predetermined value.</claim-text>
    </claim>
    <claim num="4">
      <claim-text>4. The image forming apparatus according to claim 1, wherein the predetermined value is an upper limitation of allowable expansion time so as to prevent over-run in image formation by the printing unit.</claim-text>
    </claim>
    <claim num="5">
      <claim-text>5. The image forming apparatus according to claim 1, wherein the raster data is generated by: said generation means, wherein the intermediate data is a coded-band representation; raster-data amount prediction means for predicting a raster-data amount when the coded band representation generated by said generation means into full-raster image data;</claim-text>
      <claim-text>and mapping means for mapping the coded-band representation generated by said generation means into full-raster image data, if the raster data amount predicted by said raster-data amount prediction means is greater than a predetermined storage capacity of storage means.</claim-text>
    </claim>
    <claim num="6">
      <claim-text>6. The image forming apparatus according to claim 1, wherein if a capacity of storage means for storing the compressed raster data is insufficient, the compression method is changed to a compression method which reduces a data size of the expanded raster data.</claim-text>
    </claim>
    <claim num="7">
      <claim-text>7. The image forming apparatus according to claim 5, wherein the coded-band representation includes bitmap data divided in band units.</claim-text>
    </claim>
    <claim num="8">
      <claim-text>8. The image forming apparatus according to claim 5, wherein the coded-band representation includes run-length data divided in band units.</claim-text>
    </claim>
    <claim num="9">
      <claim-text>9. The image forming apparatus according to claim 5, wherein the coded-band representation includes trapezoid data divided in band units.</claim-text>
    </claim>
    <claim num="10">
      <claim-text>10. The image forming apparatus according to claim 5, wherein the coded-band representation includes box data divided in band units.</claim-text>
    </claim>
    <claim num="11">
      <claim-text>11. The image forming apparatus according to claim 5, wherein the coded-band representation includes fast boundary encoding bitmap data divided in band units.</claim-text>
    </claim>
    <claim num="12">
      <claim-text>12. The image forming apparatus according to claim 1, wherein said prediction means performs arithmetic compression while updating a predetermined probability table to predict the size of data which will be obtained by compressing the raster data.</claim-text>
    </claim>
    <claim num="13">
      <claim-text>13. The image forming apparatus according to claim 1, wherein if the expansion time predicted by said prediction means is greater than the predetermined value, the compression is continued by reducing a raster-data amount by degrading resolution or tone-level representation, and performing compression again.</claim-text>
    </claim>
    <claim num="14">
      <claim-text>14. An image forming method which performs printing processing based upon print data inputted from a host computer and described in a page description language, said method comprising: a generating step of generating intermediate data in band units, based upon the print data; a determining step of determining whether raster data of a band of interest should be generated from the intermediate data and stored prior to printing, or the raster data of the band of interest should be generated from the intermediate data synchronously with printing and transmitted to a printing unit; a prediction step of predicting a size of compressed raster data of the band of interest compressed by a first compression method and an expansion time required to expand the compressed raster data based upon data size, in a case in which it is determined that the raster data of the band of interest should be generated from the intermediate data and stored prior to printing; a change step of changing the first compression method to a second compression method, if the expansion time predicted in said predicting step is greater than a predetermined value, wherein an expansion time required to expand compressed raster data of the band of interest compressed by the second compression method is less than the predetermined value; a compression step of compressing the raster data of the band of interest by the first compression method to generate compressed raster data if the expansion time predicted in said predicting step is less than the predetermined value, or compressing the raster data of the band of interest by the second compression method if the expansion time predicted by said prediction means is greater than the predetermined value;</claim-text>
      <claim-text>and a print controlling step of expanding the compressed raster data compressed at said compression step and transmitting the expanded raster data to the printing unit.</claim-text>
    </claim>
    <claim num="15">
      <claim-text>15. The image forming method according to claim 14, wherein at said prediction step, the expansion time is predicted by utilizing correlation between a compression ratio and expansion processing time, based on the compressed data size of the raster data predicted at said prediction.</claim-text>
    </claim>
    <claim num="16">
      <claim-text>16. The image forming method according to claim 14, wherein at said change step, the compression method is changed to a compression method which reduces the expansion processing time, if the expansion time predicted at said prediction step is greater than a predetermined value.</claim-text>
    </claim>
    <claim num="17">
      <claim-text>17. The image forming method according to claim 14, wherein the predetermined value is an upper limitation of allowable expansion time so as to prevent over-run in image formation by the printing unit.</claim-text>
    </claim>
    <claim num="18">
      <claim-text>18. The image forming method according to claim 14, wherein the raster data is generated at: said generating step, wherein the intermediate data is a coded-band representation; a raster-data amount prediction step of predicting a raster-data amount when the coded band representation generated at said generating step into full-raster image data;</claim-text>
      <claim-text>and a mapping step of mapping the coded-band representation generated at said generating step into full-raster image data, if the raster data amount predicted at said raster-data amount prediction step is greater than a predetermined storage capacity of storage step.</claim-text>
    </claim>
    <claim num="19">
      <claim-text>19. The image forming method according to claim 14, wherein if a capacity of storage step of storing the compressed raster data is insufficient, the compression method is changed to a compression method which reduces a data size of the expanded raster data.</claim-text>
    </claim>
    <claim num="20">
      <claim-text>20. The image forming method according to claim 18, wherein the coded-band representation includes bitmap data divided in band units.</claim-text>
    </claim>
    <claim num="21">
      <claim-text>21. The image forming method according to claim 18, wherein the coded-band representation includes run-length data divided in band units.</claim-text>
    </claim>
    <claim num="22">
      <claim-text>22. The image forming method according to claim 18, wherein the coded-band representation includes trapezoid data divided in band units.</claim-text>
    </claim>
    <claim num="23">
      <claim-text>23. The image forming method according to claim 18, wherein the coded-band representation includes box data divided in band units.</claim-text>
    </claim>
    <claim num="24">
      <claim-text>24. The image forming method according to claim 18, wherein the coded-band representation includes fast boundary encoding bitmap data divided in band units.</claim-text>
    </claim>
    <claim num="25">
      <claim-text>25. The image forming method according to claim 14, wherein at said prediction step, arithmetic compression is performed while updating a predetermined probability table to predict the size of data which will be obtained by compressing the raster data.</claim-text>
    </claim>
    <claim num="26">
      <claim-text>26. The image forming method according to claim 14, wherein if the expansion time predicted at said prediction step is greater than the predetermined value, the compression is continued by reducing a raster-data amount by degrading resolution or tone-level representation, and performing compression again.</claim-text>
    </claim>
    <claim num="27">
      <claim-text>27. A computer-usable storage medium storing an executable program for printing processing based upon print data inputted from a host computer and described in a page description language, the program comprising the steps of: generating intermediate data in band units, based upon the print data; determining whether raster data of a band of interest should be generated from the intermediate data and stored prior to printing, or the raster data of the band of interest should be generated from the intermediate data synchronously with printing and transmitted to a printing unit; predicting a size of compressed raster data of the band of interest compressed by a first compression method and an expansion time required to expand the compressed raster data based upon data size, in a case in which it is determined that the raster data of the band of interest should be generated from the intermediate data and stored prior to printing; changing the first compression method to a second compression method, if the expansion time predicted in said predicting step is greater than a predetermined value, wherein an expansion time required to expand compressed raster data of the band of interest compressed by the second compression method is less than the predetermined value; compressing the raster data of the band of interest by the first compression method to generate compressed raster data, if the expansion time predicted in said predicting step is less than the predetermined value, or compressing the raster data of the band of interest by the second compression method if the expansion time predicted by said prediction means is greater than the predetermined value;</claim-text>
      <claim-text>and forming an image by expanding the raster data and transmitting the expanded raster data to the printing unit.</claim-text>
    </claim>
    <claim num="28">
      <claim-text>28. The apparatus according to claim 1, wherein the change means changes the compression method such that the expansion time, required for expanding the compressed data compressed by the compression method, is less than the predetermined value.</claim-text>
    </claim>
    <claim num="29">
      <claim-text>29. The apparatus according to claim 14, wherein the compression method is changed in the change step such that the expansion time, required for expanding the compressed data compressed by the compression method, is less than the predetermined value.</claim-text>
    </claim>
  </claims>
</questel-patent-document>