<?xml version="1.0" encoding="UTF-8"?>
<questel-patent-document lang="en" date-produced="20180805" produced-by="Questel" schema-version="3.23" file="US06181756B2.xml">
  <bibliographic-data lang="en">
    <publication-reference publ-desc="Granted patent as second publication">
      <document-id>
        <country>US</country>
        <doc-number>06181756</doc-number>
        <kind>B2</kind>
        <date>20010130</date>
      </document-id>
      <document-id data-format="questel">
        <doc-number>US6181756</doc-number>
      </document-id>
    </publication-reference>
    <original-publication-kind>B2</original-publication-kind>
    <application-reference family-id="8553178" extended-family-id="14438083">
      <document-id>
        <country>US</country>
        <doc-number>09468583</doc-number>
        <kind>A</kind>
        <date>19991221</date>
      </document-id>
      <document-id data-format="questel">
        <doc-number>1999US-09468583</doc-number>
      </document-id>
      <document-id data-format="questel_Uid">
        <doc-number>14760432</doc-number>
      </document-id>
    </application-reference>
    <language-of-filing>en</language-of-filing>
    <language-of-publication>en</language-of-publication>
    <priority-claims>
      <priority-claim kind="national" sequence="1">
        <country>FI</country>
        <doc-number>982780</doc-number>
        <kind>A</kind>
        <date>19981222</date>
        <priority-active-indicator>Y</priority-active-indicator>
      </priority-claim>
      <priority-claim data-format="questel" sequence="1">
        <doc-number>1998FI-0002780</doc-number>
      </priority-claim>
    </priority-claims>
    <dates-of-public-availability>
      <publication-of-grant-date>
        <date>20010130</date>
      </publication-of-grant-date>
    </dates-of-public-availability>
    <classifications-ipcr>
      <classification-ipcr sequence="1">
        <text>H03L   7/093       20060101AFI20051220RMJP</text>
        <ipc-version-indicator>
          <date>20060101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>H</section>
        <class>03</class>
        <subclass>L</subclass>
        <main-group>7</main-group>
        <subgroup>093</subgroup>
        <symbol-position>F</symbol-position>
        <classification-value>I</classification-value>
        <generating-office>
          <country>JP</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>M</classification-data-source>
        <action-date>
          <date>20051220</date>
        </action-date>
      </classification-ipcr>
      <classification-ipcr sequence="2">
        <text>H03L   7/089       20060101A I20051008RMEP</text>
        <ipc-version-indicator>
          <date>20060101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>H</section>
        <class>03</class>
        <subclass>L</subclass>
        <main-group>7</main-group>
        <subgroup>089</subgroup>
        <classification-value>I</classification-value>
        <generating-office>
          <country>EP</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>M</classification-data-source>
        <action-date>
          <date>20051008</date>
        </action-date>
      </classification-ipcr>
      <classification-ipcr sequence="3">
        <text>H03L   7/18        20060101A N20051008RMEP</text>
        <ipc-version-indicator>
          <date>20060101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>H</section>
        <class>03</class>
        <subclass>L</subclass>
        <main-group>7</main-group>
        <subgroup>18</subgroup>
        <classification-value>N</classification-value>
        <generating-office>
          <country>EP</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>M</classification-data-source>
        <action-date>
          <date>20051008</date>
        </action-date>
      </classification-ipcr>
      <classification-ipcr sequence="4">
        <text>H04B   1/40        20060101A N20051008RMEP</text>
        <ipc-version-indicator>
          <date>20060101</date>
        </ipc-version-indicator>
        <classification-level>A</classification-level>
        <section>H</section>
        <class>04</class>
        <subclass>B</subclass>
        <main-group>1</main-group>
        <subgroup>40</subgroup>
        <classification-value>N</classification-value>
        <generating-office>
          <country>EP</country>
        </generating-office>
        <classification-status>R</classification-status>
        <classification-data-source>M</classification-data-source>
        <action-date>
          <date>20051008</date>
        </action-date>
      </classification-ipcr>
    </classifications-ipcr>
    <classification-national>
      <country>US</country>
      <main-classification>
        <text>375374000</text>
        <class>375</class>
        <subclass>374000</subclass>
      </main-classification>
      <further-classification sequence="1">
        <text>327157000</text>
        <class>327</class>
        <subclass>157000</subclass>
      </further-classification>
      <further-classification sequence="2">
        <text>375376000</text>
        <class>375</class>
        <subclass>376000</subclass>
      </further-classification>
    </classification-national>
    <classifications-ecla>
      <classification-ecla sequence="1">
        <text>H03L-007/089C2</text>
        <section>H</section>
        <class>03</class>
        <subclass>L</subclass>
        <main-group>007</main-group>
        <subgroup>089C2</subgroup>
      </classification-ecla>
      <classification-ecla sequence="2">
        <text>H03L-007/089C4</text>
        <section>H</section>
        <class>03</class>
        <subclass>L</subclass>
        <main-group>007</main-group>
        <subgroup>089C4</subgroup>
      </classification-ecla>
    </classifications-ecla>
    <patent-classifications>
      <patent-classification sequence="1">
        <classification-scheme office="EP" scheme="CPC">
          <date>20130101</date>
        </classification-scheme>
        <classification-symbol>H03L-007/0895</classification-symbol>
        <section>H</section>
        <class>03</class>
        <subclass>L</subclass>
        <main-group>7</main-group>
        <subgroup>0895</subgroup>
        <symbol-position>F</symbol-position>
        <classification-value>I</classification-value>
        <classification-status>B</classification-status>
        <classification-data-source>H</classification-data-source>
        <action-date>
          <date>20130101</date>
        </action-date>
      </patent-classification>
      <patent-classification sequence="2">
        <classification-scheme office="EP" scheme="CPC">
          <date>20130101</date>
        </classification-scheme>
        <classification-symbol>H03L-007/0893</classification-symbol>
        <section>H</section>
        <class>03</class>
        <subclass>L</subclass>
        <main-group>7</main-group>
        <subgroup>0893</subgroup>
        <symbol-position>L</symbol-position>
        <classification-value>I</classification-value>
        <classification-status>B</classification-status>
        <classification-data-source>H</classification-data-source>
        <action-date>
          <date>20130101</date>
        </action-date>
      </patent-classification>
      <patent-classification sequence="3">
        <classification-scheme office="EP" scheme="CPC">
          <date>20130101</date>
        </classification-scheme>
        <classification-symbol>H03L-007/18</classification-symbol>
        <section>H</section>
        <class>03</class>
        <subclass>L</subclass>
        <main-group>7</main-group>
        <subgroup>18</subgroup>
        <symbol-position>L</symbol-position>
        <classification-value>A</classification-value>
        <classification-status>B</classification-status>
        <classification-data-source>H</classification-data-source>
        <action-date>
          <date>20130101</date>
        </action-date>
      </patent-classification>
      <patent-classification sequence="4">
        <classification-scheme office="EP" scheme="CPC">
          <date>20130101</date>
        </classification-scheme>
        <classification-symbol>H04B-001/408</classification-symbol>
        <section>H</section>
        <class>04</class>
        <subclass>B</subclass>
        <main-group>1</main-group>
        <subgroup>408</subgroup>
        <symbol-position>L</symbol-position>
        <classification-value>A</classification-value>
        <classification-status>B</classification-status>
        <classification-data-source>H</classification-data-source>
        <action-date>
          <date>20130101</date>
        </action-date>
      </patent-classification>
      <patent-classification sequence="5">
        <classification-scheme office="EP" scheme="ICO"/>
        <classification-symbol>T03L-007/18</classification-symbol>
      </patent-classification>
      <patent-classification sequence="6">
        <classification-scheme office="EP" scheme="ICO"/>
        <classification-symbol>T04B-001/40C6</classification-symbol>
      </patent-classification>
    </patent-classifications>
    <number-of-claims>12</number-of-claims>
    <exemplary-claim>1</exemplary-claim>
    <figures>
      <number-of-drawing-sheets>5</number-of-drawing-sheets>
      <number-of-figures>8</number-of-figures>
      <image-key data-format="questel">US6181756</image-key>
    </figures>
    <invention-title format="original" lang="en" id="title_en">Phase locked loop based on a charge pump</invention-title>
    <references-cited>
      <citation srep-phase="examiner">
        <patcit num="1">
          <text>PALMER WYN, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5592120</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5592120</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="2">
          <text>BRUCCOLERI MELCHIORRE, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5736880</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5736880</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="3">
          <text>SHOJI NORIO</text>
          <document-id>
            <country>US</country>
            <doc-number>5864249</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5864249</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="4">
          <text>NARAHARA TETSUYA</text>
          <document-id>
            <country>US</country>
            <doc-number>5886551</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5886551</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="examiner">
        <patcit num="5">
          <text>BAILEY JAMES A, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>6040742</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US6040742</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="6">
          <text>MAR MONTE F, et al</text>
          <document-id>
            <country>US</country>
            <doc-number>5532636</doc-number>
            <kind>A</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>US5532636</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="7">
          <text>NEC CORP</text>
          <document-id>
            <country>EP</country>
            <doc-number>0642227</doc-number>
            <kind>A1</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>EP-642227</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="8">
          <text>NEC CORP</text>
          <document-id>
            <country>EP</country>
            <doc-number>0798862</doc-number>
            <kind>A1</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>EP-798862</doc-number>
          </document-id>
        </patcit>
      </citation>
      <citation srep-phase="applicant">
        <patcit num="9">
          <text>MINNESOTA MINING &amp; MFG</text>
          <document-id>
            <country>WO</country>
            <doc-number>9306659</doc-number>
            <kind>A1</kind>
          </document-id>
          <document-id data-format="questel">
            <doc-number>WO9306659</doc-number>
          </document-id>
        </patcit>
      </citation>
    </references-cited>
    <parties>
      <applicants>
        <applicant data-format="original" app-type="applicant" sequence="1">
          <addressbook lang="en">
            <orgname>Nokia Mobile Phones Ltd.</orgname>
            <address>
              <address-1>Espoo, FI</address-1>
              <city>Espoo</city>
              <country>FI</country>
            </address>
          </addressbook>
          <nationality>
            <country>FI</country>
          </nationality>
        </applicant>
        <applicant data-format="questel" app-type="applicant" sequence="2">
          <addressbook lang="en">
            <orgname>NOKIA MOBILE PHONES</orgname>
          </addressbook>
          <nationality>
            <country>FI</country>
          </nationality>
        </applicant>
      </applicants>
      <inventors>
        <inventor data-format="original" sequence="1">
          <addressbook lang="en">
            <name>Moloudi, Shervin</name>
            <address>
              <address-1>Los Angeles, CA, US</address-1>
              <city>Los Angeles</city>
              <state>CA</state>
              <country>US</country>
            </address>
          </addressbook>
          <nationality>
            <country>US</country>
          </nationality>
        </inventor>
      </inventors>
      <agents>
        <agent sequence="1" rep-type="agent">
          <addressbook lang="en">
            <orgname>Perman &amp; Green, LLP</orgname>
          </addressbook>
        </agent>
      </agents>
    </parties>
    <examiners>
      <primary-examiner>
        <name>Vo, Don N.</name>
      </primary-examiner>
    </examiners>
    <lgst-data>
      <lgst-status>LAPSED</lgst-status>
    </lgst-data>
  </bibliographic-data>
  <abstract format="original" lang="en" id="abstr_en">
    <p id="P-EN-00001" num="00001">
      <br/>
      The invention relates to a method for balancing the output current (iDELTA1) of a first charge pump (CHP1).
      <br/>
      The first charge pump (CHP1) comprises a first charging current source (CS1) and a first discharging current source (CS2).
      <br/>
      The output current (iDELTA1) of the first charge pump (CHP1) is supplied by at least one said current source (CS1, CS2).
      <br/>
      The method consists of the following steps: providing a second charge pump (CHP2) with a second charging current source (CS3) and a second discharging current source (CS4), supplying the output current (iDELTA2) of said second charge pump (CHP2) by at least one said second current source (CS3, CS4), and supplying a reference current (i5) on the basis of the output current (iDELTA2) supplied by said second charge pump (CHP2).
      <br/>
      The balancing is conducted by combining said reference current (i5) with the output current (iDELTA1) supplied by the first charge pump (CHP1).
    </p>
  </abstract>
  <description format="original" lang="en" id="desc_en">
    <p num="1">
      The present invention relates to a method for balancing the output current of a charge pump according to the appended claim 1.
      <br/>
      Also, the invention relates to a charge pump structure according to the appended claim 5.
      <br/>
      Furthermore, the invention relates to a wireless communication device according to the appended claim 10.
    </p>
    <p num="2">
      Particularly in wireless communication devices, phase-locked loops (PLL) are used as oscillators in frequency synthesis, and in the generation of clock signals.
      <br/>
      Phase-locked loops are generally implemented as integrated circuits, and the charge-pump technique is used in them.
      <br/>
      Appended FIG. 1 shows a phase-locked loop according to prior art, comprising a phase detector PD, a charge pump CHP with two current sources CS1, CS2 (FIG. 2), a loop filter LF which is typically implemented as a low pass filter, and a voltage-controlled oscillator VCO.
      <br/>
      FIG. 2 shows a charge pump CHP according to prior art.
      <br/>
      The phase detector PD receives two clock signals: a reference signal and a clock signal generated by the voltage-controlled oscillator.
      <br/>
      The phase detector PD comprises two output lines: UP and DOWN, the first output line DOWN being used for controlling the charging current source CS1 of the charge pump CHP, and the second output line UP being used for controlling the discharging current source CS2.
      <br/>
      In a situation in which the frequency of the reference signal is greater than the frequency of the clock signal generated by the voltage-controlled oscillator VCO, or the phase of the reference signal leads the signal generated by the voltage-controlled oscillator VCO, the phase detector generates a pulse in the UP line, wherein a second switch SW2 in the charge pump is turned off.
      <br/>
      Thus, the charging current source CS1 is allowed to supply current to the output of the charge pump.
      <br/>
      This current isource from the charging current source CS1 is supplied to the loop filter LF to increase the charge of a capacitor therein.
      <br/>
      This increase in the charge of the capacitor causes an increase in the voltage at the input of the voltage-controlled oscillator VCO.
      <br/>
      Consequently, the frequency of the clock signal generated by the voltage-controlled oscillator is increased.
      <br/>
      Correspondingly, in a situation where the frequency of the reference signal is smaller than the frequency of the clock signal generated by the voltage-controlled oscillator VCO, or the phase of the reference signal lags the signal generated by the voltage-controlled oscillator VCO, the phase detector generates a pulse in its first output, i.e. the output line DOWN, wherein a first switch SW1 in the charge pump is turned off.
      <br/>
      Thus, the discharging current source CS2 is allowed to drain current from the output of the charge pump, wherein the charge of the capacitor of the loop filter is discharged by the current isink of this discharging current source.
      <br/>
      This reduction in the current is manifested as a reduction in the voltage at the input of the voltage-controlled oscillator.
      <br/>
      Thus, the frequency of the clock signal generated by the voltage-controlled oscillator VCO is reduced.
    </p>
    <p num="3">
      The above description applies to a charge pump structure in which the switches SW1, SW2 are normally closed.
      <br/>
      It is also possible for the switches SW1, SW2 to be in a normally open condition.
      <br/>
      In that case the operation of the switches SW1, SW2 is slightly different.
      <br/>
      The UP line being used for controlling switch SW1 and the DOWN line being used for controlling switch SW2.
      <br/>
      In a situation in which the frequency of the reference signal is greater than the frequency of the clock signal generated by the voltage-controlled oscillator VCO, or the phase of the reference signal leads the signal generated by the voltage-controlled oscillator VCO, the phase detector generates a pulse in the UP line, wherein a first switch SW1 in the charge pump is turned on and the second switch SW2 remains open.
      <br/>
      Correspondingly, in a situation where the frequency of the reference signal is smaller than the frequency of the clock signal generated by the voltage-controlled oscillator VCO, or the phase of the reference signal lags the signal generated by the voltage-controlled oscillator VCO, the phase detector generates a pulse in its first output, i.e. the output line DOWN, wherein a second switch SW2 in the charge pump is turned on and the first switch SW1 remains open.
    </p>
    <p num="4">It is also possible to operate the voltage-controlled oscillator VCO to operate in the opposite way--i.e. a decrease in voltage produces an increase in frequency and vice versa.</p>
    <p num="5">
      In a situation in which the reference signal and the signal generated by the voltage-controlled oscillator have the same frequency and the same phase, i.e. the phase-locked loop is in locked condition, there is no pulse in the phase detector outputs UP and DOWN.
      <br/>
      Thus, the current sources CS1, CS2 of the charge pump are either switched off or both current sources CS1, CS2 of the charge pump are connected to the output of the charge pump.
      <br/>
      Ideally charging current isource and discharging current isink are designed to be the same.
      <br/>
      In an ideal situation, there should thus be no current in the output of the charge pump, and the charge of the capacitor of the loop filter should remain constant and also the frequency of the clock signal generated by the voltage-controlled oscillator VCO should remain substantially constant.
      <br/>
      In practical applications, however, the structures of the current sources CS1, CS2 of the charge pump cannot be made fully identical, e.g. for the reason that the charging current source CS1 is implemented by using a transistor of the P type or a P channel transistor, and the discharging current source CS2 is implemented with a transistor of the N type or an N channel transistor, which cannot be made identical in practice.
      <br/>
      This results in a current mismatch of typically in the order of 5 to 20% in the currents isource, isink of the current sources.
      <br/>
      As an example of such a known phase-locked loop, the integrated circuit LMX2335 by National Semiconductor company can be mentioned, in which the structures of the current sources are aimed at being made as identical as possible.
      <br/>
      However, also in this circuit, the current mismatch is of the order presented above.
    </p>
    <p num="6">
      In a situation where the phase-locked loop is in the locked condition and both current sources CS1, CS2 are connected to the output of the charge pump CHP, the current mismatch leads to the capacitor of the loop filter LF being discharged or charged, depending on which current source CS1, CS2 generates a current with a greater absolute value.
      <br/>
      This results in a change in the frequency of the clock signal generated by the voltage-controlled oscillator VCO.
      <br/>
      This change causes a need for correcting the phase-locked loop PLL.
      <br/>
      Thus, the frequency generated by the phase-locked loop is not constant, but it has slight variations which are manifested as an interfering signal on the other stages of the wireless communication device.
    </p>
    <p num="7">
      The difference in the currents isource, isink generated by the current sources CS1 and CS2 is also manifested in that the frequency of the clock signal generated by the voltage-controlled oscillator VCO increases faster, if the current isource supplied by the charging current source CS1 is greater, or decreases faster, if the current isink drained by the discharging current source CS2 is greater.
      <br/>
      As a result, the length of the pulses in the outputs UP and DOWN of the phase detector are not the same.
      <br/>
      This, in turn, causes interfering frequencies in the output of the phase-locked loop PLL and other spurious signals.
      <br/>
      One possibility to reduce this interference is to reduce the bandwidth of the loop filter, but this will slow down the operation of the phase-locked loop.
      <br/>
      Particularly in the next generation mobile communication systems, which are currently under development, such as the general packet radio service (GPRS), high requirements are set for the rate of frequency synthesis in the receiving and transmitting channel, because of an increasing need for channel switching during wireless communication.
    </p>
    <p num="8">
      It is an aim of the present invention to provide a method for reducing the unwanted effects caused by the non-ideal properties of a charge pump, as well as a charge pump structure in which the effects caused by the non-ideal properties of the charge pump are eliminated to a major extent.
      <br/>
      The invention is based on the idea of providing a second charge pump which is identical with the first charge pump and in which deviations caused by non-ideal properties are used to compensate for the effect of non-ideal properties of the first charge pump.
      <br/>
      The method according to the present invention is characterized in what is presented in the characterizing part of the appended claim 1.
      <br/>
      The charge pump structure of the present invention is characterized in what will be presented in the characterizing part of the appended claim 5.
      <br/>
      Furthermore, a wireless communication device according to the present invention is characterized in what will be presented in the characterizing part of the appended claim 10.
    </p>
    <p num="9">
      The present invention gives significant advantages in comparison with the solutions of prior art.
      <br/>
      To implement two substantially identical charge pumps is considerably easier than to balance the charging and discharging current sources of a charge pump.
      <br/>
      Particularly, in connection with the manufacture of integrated circuits, it is easy to copy a charge pump by geometrical copying of the charge pump section.
      <br/>
      Thus, the properties of both charge pumps are very similar to each other.
      <br/>
      In the charge pump structure of the invention, the second charge pump is used for providing reference information to the first charge pump.
      <br/>
      This reference information, which is advantageously information about the mismatch current, is used for correcting the output current generated by the first charge pump.
      <br/>
      The charge pump structure of the invention can also be advantageously implemented with separate components, wherein the mutual balancing of the current generators (source and sink) in each charge pump is not critical.
      <br/>
      Instead, it is easier to select the corresponding components in the charge pumps to have substantially identical properties, wherein the reference information corresponds to the non-ideal properties of the first charge pump as well as possible.
      <br/>
      The frequency synthesis implemented with the charge pump structure of the invention is considerably less prone to interference and does not contain such a high proportion to spurious frequencies as occur in solutions of prior art.
      <br/>
      Moreover, the frequency formed in the frequency synthesis does not fluctuate as strongly as in frequency synthesis using a phase-locked loop of prior art.
    </p>
    <p num="10">
      In the following, the invention will be described in more detail with reference to the appended drawings, in which
      <br/>
      FIG. 1 shows a phase-locked loop of prior art in a reduced block chart,
      <br/>
      FIG. 2 shows a charge pump of prior art in a reduced block chart,
      <br/>
      FIG. 3a shows a charge pump structure according to an advantageous embodiment of the invention, in a reduced block chart,
      <br/>
      FIG. 3b shows a charge pump structure according to another advantageous embodiment of the invention, in a reduced block chart,
      <br/>
      FIG. 4 shows a transmitter-receiver structure, in which the invention can be advantageously applied, and
      <br/>
      FIGS. 5a-5c shows as timing charts on the operation of a phase comparator.
    </p>
    <p num="11">
      FIG. 3a shows, in a reduced block chart, a charge pump structure according to an advantageous embodiment of the invention.
      <br/>
      It comprises two charge pumps CHP1, CHP2.
      <br/>
      Further, the charge pump structure comprises means CM for copying the reference information generated by the second charge pump CHP2 to the output of the first charge pump CHP1.
      <br/>
      The first charge pump CHP1 comprises two current sources CS1, CS2 as well as two switch means SW1, SW2.
      <br/>
      The charging current source CS1 is implemented e.g. with a transistor of the P type, as already disclosed above in this specification.
      <br/>
      In a corresponding manner, the discharging current source CS2 is implemented e.g. with a transistor of the N type.
      <br/>
      The aim is to select or fabricate the components of the current charges CS1, CS2 so that the current strengths isource1, isink1 are substantially the same.
      <br/>
      In practice, it is possible to achieve the accuracy of a few per cent.
      <br/>
      The charging current source CS1 is coupled, at one end, e.g. to an operating voltage source VCC and, at the other end, to the first switch means SW1.
      <br/>
      The discharging current source is coupled, at one end, advantageously to the ground potential and, at the other end, to the second switch means SW2.
      <br/>
      These switch means SW1, SW2 are controlled in the phase-locked loop application by signals generated by the phase detector PD (FIG. 4).
      <br/>
      The switch means SW1, SW2 are advantageously solid state switches or other electrically controllable switch solutions known as such.
      <br/>
      It is obvious that the switch means SW1, SW2 can also be implemented in another way, known as such, so that the current strength supplied by the respective current source CS1, CS2 in the output of the charge pump CHP1 is substantially zero.
    </p>
    <p num="12">
      With respect to the current sources CS1, CS2, the second charge pump CHP2 is implemented in such a way that it is as identical to the first charge pump CHP1 as possible.
      <br/>
      Thus, the charging current source of the second charge pump, which is indicated with the reference numeral CS3, is implemented in such a manner that it is as identical to the current source CS1 of the first charge pump as possible.
      <br/>
      Also, the discharging current source CS4 of the second charge pump is implemented in such a manner that it is as identical to the discharging current source CS2 of the first charge pump as possible.
      <br/>
      Thus, the current strengths supplied by the first charging current source CS1 and the second charging current source CS3 (indicated as i1 and i3 in FIG. 3a) are substantially identical.
      <br/>
      Also the current strengths drained by the first discharging current source CS2 and the second discharging current source CS4 (indicated as i2 and i4 in FIG. 3a) are substantially identical to each other.
    </p>
    <p num="13">
      In the following, the operation of a charge pump structure according to an advantageous embodiment of the invention will be described, with reference to FIG. 3a. It is assumed that the switch means SW1, SW2 are first closed.
      <br/>
      Thus, the current i1 supplied by the first charging current source CS1 passes through the first switch means SW1 to the output OUT1 of the first charge pump.
      <br/>
      The first discharging current source CS2 drains a current strength i2 from the output OUT1 via the second switch means SW2 to ground.
      <br/>
      Thus, the first charging current source CS1 and the first discharging current source CS2 generate a leakage current i DELTA 1 at the output OUT1 of the first charge pump.
      <br/>
      According to Kirchhoff's current law, the algebraic sum of currents toward any point in a network is zero.
      <br/>
      In the markings of FIG. 3a, the direction arrows of currents represent the direction of a positive current, wherein when the current strength is less than 0, the direction of the current is opposite to that indicated in the figure, which is known as such.
      <br/>
      Thus, the quantity of the leakage current i DELTA 1 is the difference between the current drained by the first discharging current source CS2 and the current supplied by the first charging current source CS1, and is represented by the formula:
      <br/>
      i DELTA 1 =i1 -i2  (Formula 1)
    </p>
    <p num="14">
      The operation of the second charge pump CHP2 is substantially identical to the operation of the first charge pump CHP1.
      <br/>
      In this advantageous embodiment of the invention the switch means SW1 and SW4 are both controlled simultaneously so that when the switch means SW1 is closed, the switch means SW4 is closed, too and vice versa.
      <br/>
      Also the switch means SW2 and SW3 are both controlled simultaneously so that when the switch means SW2 is closed, the switch means SW3 is closed, too and vice versa.
      <br/>
      In a situation where the switch means SW3, SW4 are closed, the current i3 supplied by the second charging current source CS3 passes through the switch means SW3 to the output OUT2 of the second charge pump.
      <br/>
      The second discharging current source CS4 drains a current strength i4 from the output OUT2 via the fourth switch means SW4 to ground.
      <br/>
      Consequently, the second charge pump CHP2 generates a reference current strength i DELTA 2 at its output OUT2.
      <br/>
      The quantity of this reference current can be calculated, according to the markings of FIG. 3a, by the formula:
      <br/>
      i DELTA 2 =i3 -i4  (Formula 2)
    </p>
    <p num="15">
      Now, referring to the markings of FIGS. 3a and 3b, especially to the arrows, which represent (positive) directions of the currents of the charge pump structure, the means CM for copying are arranged to generate a current i5 whose strenght is proportional by a factor k to the reference current i DELTA 2 and the direction is reversed.
      <br/>
      The reference current i DELTA 2 is conveyed to means CM for copying which generates, in its output line C, a current whose strength is proportional, preferably directly proportional, to the reference current i DELTA 2 supplied by the second charge pump CHP2, i.e. the amplification of the means CM for copying in this advantageous embodiment is ca. 1.
      <br/>
      This means that the factor k is approximately 1.
      <br/>
      The amplification of the means CM for copying can also be variable or tunable.
      <br/>
      This variability/tunability can be extended to other blocks of the charge pump structure.
      <br/>
      For example, the current ratio between the currents generated by the first charging current source CS1 and the second charging current source CS3 and respectively the current ratio between the currents generated by the first discharging current source CS2 and the second discharging current source CS4 can be greater than one or less than one.
      <br/>
      The means CM for copying is for example a current mirror or any current conveyor structure, any current or voltage sampler or the like.
      <br/>
      The current i5 supplied by the means CM for copying is conveyed to the output OUT1 of the first charge pump.
      <br/>
      Thus, the output current (indicated iOUT) of the charge pump structure of FIG. 3a is the difference between the leakage current i DELTA 1 and the current i5 supplied by the means CM for copying.
      <br/>
      Consequently, the output current iOUT can be calculated using the formula:
    </p>
    <p num="16">iOUT =i5 +i DELTA 1  (Formula 3)</p>
    <p num="17">
      By replacing in the formula 3 the current supplied by the copying means i5 =-k*i DELTA 2, the output current obtained is
      <br/>
      iOUT =i DELTA 1 -k*i DELTA 2  (Formula 4)
    </p>
    <p num="18">
      By substituting formulae 1 and 2 in to formula 4, the equation obtained for the output current iOUT is (k=1):
      <br/>
      iOUT =(i1 -i2)-(i3 -i4)=i1 -i2 -i3 +i4  (Formula 5)
    </p>
    <p num="19">In the situation presented above, the output current iOUT is very close to zero, due to the substantially identical nature of charge pumps CHP1, CHP2.</p>
    <p num="20">
      In a situation where the first switch means SW1 is open (ii.apprxeq.0), the output current iOUT of the charge pump structure is influenced by the current strength i2 drained by the first discharging current source CS2 as well as by the reference current i DELTA 2 supplied by the second charge pump CHP2.
      <br/>
      Because in this situation also the fourth switch means SW4 is open (i4.apprxeq.0), the output current i DELTA 2 of the second charge pump is the current i3 supplied by the second charging means CS3.
      <br/>
      This is conveyed to the means CM for copying, wherein according to Formula 5, the output current iOUT obtained for the charge pump structure is minus the sum of the current strength of the first discharging current source CS2 and the current strength of the second charging current source CS3, i.e. -(i2 +i3).
      <br/>
      On the other hand, the strength of the current i3 supplied by the second charging current source CS3 is substantially equal to the strength of the current supplied by the first charging current source CS1, wherein the output current of the charge pump can be presented also in the form
      <br/>
      iOUT =-(i1 +i2)  (Formula 6a)
    </p>
    <p num="21">i.e. as minus the sum of the currents drained by the first discharging current source CS2 and the first charging current source CS1.</p>
    <p num="22">
      Correspondingly, in a situation where the first switch means SW1 is closed and the second switch means SW2 is open (i2.apprxeq.0), wherein also the third switch means SW3 is open (i3.apprxeq.0) and the fourth switch means SW4 is closed, the output current iOUT of the charge pump structure can be calculated by following the principles presented above.
      <br/>
      Thus, the output current obtained is the sum of the current strength i1 supplied by the first charging current source CS1 and the current strength i4 drained by the second discharging current source CS4.
      <br/>
      Since the strength of the current i4 drained by the second discharging current source CS4 is substantially identical to the strength of the current i2 drained by the first discharging current source CS2, the output current iOUT of the charge pump structure in this situation can be presented as the sum of the currents i1, i2 supplied by the current sources CS1, CS2 of the first charge pump.
      <br/>
      iout =i1 +i2  (Formula 6b)
    </p>
    <p num="23">
      From the description above, it can be stated that in the charge pump structure according to the invention, the differences in the strengths of the currents supplied by the charging CS1, CS3 and drained by discharging current sources CS2, CS4 are not significant as such.
      <br/>
      Also the absolute directions of the currents i1 -i4, i DELTA 1, i DELTA 2, iOUT in practical implementations need not be the same as presented in the figures.
      <br/>
      They are presented as an example, only.
      <br/>
      What is relevant is that the ratio of the currents i1, i3 supplied by the charging current sources CS1, CS3 is substantially equal to the ratio of the currents i2, i4 drained by the discharging current sources CS2, CS4, i.e. the absolute strength of the currents in the second charge pump CHP2 could be some constant multiplied by the strength of the current in the first charge pump CHP1.
      <br/>
      As was mentioned above the ratio of the currents i1, i3 ; i2, i4 in an advantageous embodiment is ca. 1.
      <br/>
      The factor k prefarably equals the ratio i1 /i3 (or i2 /i4).
    </p>
    <p num="24">
      FIG. 3b shows, in a reduced block chart, a charge pump structure according to another advantageous embodiment of the invention.
      <br/>
      It also comprises two charge pumps CHP1, CHP2.
      <br/>
      Further, the charge pump structure comprises means CM for copying the reference information generated by the second charge pump CHP2 to the output of the first charge pump CHP1.
      <br/>
      The first charge pump CHP1 comprises two current sources CS1, CS2 as well as two switch means SW1, SW2.
    </p>
    <p num="25">
      The second charge pump CHP2 is implemented in such a way that it has the current sources CS3, CS4 as identical to the current sources CS1, CS2 of the first charge pump CHP1 as possible.
      <br/>
      The current i3 supplied by the second charging current source CS3 is allowed to flow continuously to the output OUT2 of the second charge pump CHP2.
      <br/>
      Also the second discharging current source CS4 is allowed to drain current i4 continuously from the output OUT2 of the second charge pump CHP2.
      <br/>
      Therefore the switch means SW3, SW4 can be replaced by wires or the like.
      <br/>
      The reference current i DELTA 2 generated by the second charge pump CHP2 at its output OUT2 is continuously injected by the means CM for copying into the output OUT1 of the first charge pump CHP1 to compensate the mismatch between the current i1 supplied by the first current source CS1 and the current i2 drained by the first discharging current source CS2.
    </p>
    <p num="26">
      Furthermore, the following is a description of the operation of the charge pump structure according to the invention in a high-frequency block of a wireless communication device such as that shown in FIG. 4, with reference to the timing charts of FIGS. 5a-5c. FIG. 4 shows only some functional features of the high-frequency block.
      <br/>
      The high-frequency block consists of a receiver block RX, a transmitter block TX, a reference oscillator LO1, as well as a phase-locked loop PLL.
      <br/>
      For practical reasons, the frequency of the reference oscillator LO1 is lower than local oscillator frequencies fRX, fTX required by the receiver block RX and the transmitter block TX.
      <br/>
      In the phase-locked loop PLL, this is taken into account e.g. so that the signal generated by the voltage-controlled oscillator VCO is conveyed to a first frequency divider DIV1 in which a desired divider value can be set with a control line TUNE.
      <br/>
      Thus, the output of the first divider DIV1 contains the frequency generated by the voltage-controlled oscillator VCO divided by the set divider value.
      <br/>
      In the embodiment of FIG. 4, the frequency of the signal generated by the reference oscillator LO1 is also divided in a second divider DIV2 before conveying it to the phase detector PD.
      <br/>
      The frequency of the reference oscillator LO1 as well as the divider values of the first divider DIV1 and the second divider DIV2 are selected so that when the voltage-controlled oscillator VCO is tuned to a desired frequency, the signals in the input lines of the phase detector PD have substantially the same frequency and the same phase.
      <br/>
      The frequency generated by the voltage-controlled oscillator VCO is used as a local oscillator frequency fTX for the transmitter block TX.
      <br/>
      The local oscillator frequency for the receiver block RX is generated by mixing in the mixer MIX the frequency generated by the voltage-controlled oscillator VCO and the frequency generated by the duplex oscillator LO2, which is known as such.
      <br/>
      Another alternative is that the local oscillator frequency for the transmitter block TX is generated by mixing in the mixer MIX the frequency generated by the voltage-controlled oscillator VCO and the frequency generated by the duplex oscillator LO2 and the frequency generated by the voltage-controlled oscillator VCO is used as a local oscillator frequency fRX for the receiver block RX.
      <br/>
      The duplex oscillator LO2 can also be omitted in some implementations.
    </p>
    <p num="27">
      A high frequency signal is received by the antenna and band bass filtered in the high frequency filter block HF so that the correct high frequency signals are sent to the receiver block RX.
      <br/>
      The high frequency signals are converted to intermediate frequencies or into base band frequencies and demodulated in the receiver block RX.
    </p>
    <p num="28">
      The signals to be transmitted are modulated and converted to high frequency signals in the transmitter block TX.
      <br/>
      The modulated, high frequency signal is low pass filtered in the high frequency filter block HF and transmitted via the antenna.
    </p>
    <p num="29">
      The phase detector PD comprises two outputs: UP and DOWN.
      <br/>
      The outputs UP, DOWN of the phase detector are used to control the operation of the charge pump according to the invention advantageously in the following way: When the phase-locked loop PLL is in locked condition, the outputs UP, DOWN of the phase detector PD are e.g. in the logical 0 state.
      <br/>
      In this advantageous example, this means that the switch means SW1-SW4 of the charge pumps CHP1, CHP2 are closed.
      <br/>
      As stated above in the description of the example of FIG. 3a, the current strength in the output of the charge pump structure CHP is substantially zero, wherein the charge of the capacitor of the loop filter LF is not changed significantly.
      <br/>
      This also keeps the frequency of the voltage-controlled oscillator VCO substantially unchanged.
      <br/>
      The timing chart corresponding to this situation is presented in FIG. 5a. It shows the output signal of the dividers DIV1, DIV2 for two cycles as well as the state of the outputs UP, DOWN of the phase detector PD.
    </p>
    <p num="30">
      In a situation in which e.g. the channel is changed, a new divider value is set in the first divider DIV1.
      <br/>
      If the channel change requires an increase in the frequency, the divider value is increased, wherein the frequency of the signal in the first input IN1 is lower than the frequency of the signal in the second input IN2.
      <br/>
      Apparently there exists a phase difference between the phase of the signal in the first input IN1 of the phase detector PD and the phase of the signal in the second input IN2.
      <br/>
      Thus, the phase detector PD generates pulses in the first output UP, until the input signals of the phase detector PD are substantially in the same frequency and phase.
      <br/>
      This situation is presented in the timing chart of FIG. 5b. These pulses make the switch means SW2 and SW3 of the charge pump CHP open for the time of the pulses.
      <br/>
      Thus, during each pulse, the output of the charge pump CHP has a current strength which causes charging of the capacitor in the loop filter, wherein the output voltage of the loop filter LF is increased.
      <br/>
      This will result in an increase in the frequency of the voltage-controlled oscillator.
      <br/>
      When the frequency of the voltage-controlled oscillator VCO corresponds to the set channel frequency, the phase-locked loop PLL is thus locked and the switch means SW1-SW4 of the charge pump CHP are closed.
    </p>
    <p num="31">
      In a corresponding manner, in a situation where the frequency of the voltage-controlled oscillator VCO is to be reduced, the divider value of the first divider is decreased, wherein the frequency of the signal in the first input IN1 is greater than the frequency of the signal in the second input IN2.
      <br/>
      Apparently there exists a phase difference between the phase of the signal in the first input IN1 of the phase detector PD and the phase of the signal in the second input IN2.
      <br/>
      Thus, the phase detector PD generates pulses in the second output DOWN, until the input signals of the phase detector PD are substantially in the same frequency and phase.
      <br/>
      This situation is presented in the timing chart of FIG. 5c. These pulses make the switch means SW1 and SW4 in the charge pump CHP open for the time of the pulses.
      <br/>
      Thus, during each pulse, the output of the charge pump CHP contains a current strength which causes discharging of the capacitor of the loop filter, wherein the output voltage of the loop filter LF decreases.
      <br/>
      This results in a reduction in the frequency of the voltage-controlled oscillator VCO, until the frequency of the voltage-controlled oscillator VCO corresponds to the set frequency.
    </p>
    <p num="32">
      The description above assumes that an increase in voltage produces an increase in frequency.
      <br/>
      As was mentioned earlier in the description, the voltage controlled oscillator may also operate in the opposite way, wherein the operation of the phase-locked loop PLL should be modified accordingly, which is known as such.
    </p>
    <p num="33">
      With the charge pump structure of the invention, the above-presented changes in the frequency take place at a substantially equal rate, irrespective of the direction of the change in the frequency.
      <br/>
      However, in the solutions of prior art, the charging and discharging current strengths are not equal because in practical applications the structures of the current sources CS1, CS2 of the charge pump cannot be made fully identical.
      <br/>
      This results in a current mismatch, wherein the change rate is affected also by the direction of the change.
    </p>
    <p num="34">The high-frequency block of FIG. 4 can be applied for example in wireless communication devices, base transceiver stations, satellite stations, etc.</p>
    <p num="35">In the charge pump structure according to the invention, the first charge pump CHP1 is in the signal path; i.e., the output signals of the phase detector PD are conveyed to the first charge pump CHP1, as in the solutions of prior art, but the second charge pump is separated from the signal path.</p>
    <p num="36">It is obvious that the invention can also be applied in a way that when the phase-locked loop PLL is in locked condition, the switch means SW1-SW4 of the charge pump CHP are open, which means in practice that there is substantially no current in the output of the charge pump CHP.</p>
    <p num="37">
      A simulation was conducted on a charge pump structure of the invention, using the following test values: First charge pump CHP1: charging current i1 =1.001 mA and discharging current i2 =988.8  MU A; matching accuracy of charge pumps 2% which means a maximum error of 20  MU A at a current of 1 mA.
      <br/>
      The simulation results indicated that in the charge pump structure of the invention, the output current was clearly less than 1  MU A in a situation where all the current sources were connected.
    </p>
    <p num="38">
      The charge pump structure of the invention can also be applied in other connections than in phase-locked loops.
      <br/>
      The present invention is not limited only to the embodiments presented above, but it can be modified within the scope of the appended claims.
    </p>
  </description>
  <claims format="original" lang="en" id="claim_en">
    <claim num="1">
      <claim-text>What is claimed is:</claim-text>
      <claim-text>1.</claim-text>
      <claim-text>A method for balancing the output current (i DELTA 1) of a first charge pump (CHP1), the first charge pump (CHP1) comprising a first charging current source (CS1) and a first discharging current source (CS2), and in which method the output current (i DELTA 1) of the first charge pump (CHP1) is supplied by at least one said current source (CS1, CS2), characterized in that the method consists of the following steps:</claim-text>
      <claim-text>providing a second charge pump (CHP2) with a second charging current source (CS3) and a second discharging current source (CS4), supplying the output current (i DELTA 2) of said second charge pump (CHP2) by at least one said second current source (CS3, CS4), and supplying a reference current (i5) on the basis of the output current (i DELTA 2) supplied by said second charge pump (CHP2),</claim-text>
      <claim-text>wherein the balancing is conducted by combining said reference current (i5) with the output current (i DELTA 1) supplied by the first charge pump (CHP1).</claim-text>
    </claim>
    <claim num="2">
      <claim-text>2. A method according to claim 1, characterized in that the second charge pump (CHP2) is formed substantially identical to the first charge pump (CHP1).</claim-text>
    </claim>
    <claim num="3">
      <claim-text>3. A method according to claim 1, characterized in that when supplying the output current (i DELTA 1) of the first charge pump (CHP1) by the first charging current source (CS1), the second discharging current source (CS4) is used for forming the reference current (i5), or when supplying the output current (i DELTA 1) of the first charge pump (CHP1) by the first discharging current source (CS2), the second charging current source (CS3) is used for forming the reference current (i5), or when supplying the output current (i DELTA 1) of the first charge pump (CHP1) by both the first charging current source (CS1) and the first discharging current source (CS2), both the second discharging current source (CS4) and the second charging current source (CS3) are used for forming the reference current (i5).</claim-text>
    </claim>
    <claim num="4">
      <claim-text>4. A method according to claim 1, characterized in that both the second discharging current source (CS4) and the second charging current source (CS3) are continuously used for forming the reference current (i5).</claim-text>
    </claim>
    <claim num="5">
      <claim-text>5. A charge pump structure, which comprises at least a first charge pump (CHP1) comprising a first charging current source (CS1) and a first discharging current source (CS2), and means (SW1, SW2) for supplying the output current (i DELTA 1) of the first charge pump (CHP1) by at least one said current source (CS1, CS2), characterized in that the charge pump structure (CHP) further comprises: a second charge pump (CHP2) with a second charging current source (CS3) and a second discharging current source (CS4), means (SW3, SW4) for supplying the output current (i DELTA 2) of said second charge pump (CHP2) by at least one said second current source (CS3, CS4), means (CM) for supplying a reference current (i5) on the basis of the output current (i DELTA 2) supplied by said second charge pump (CHP2), and means for combining said reference current (i5) with the output current (i DELTA 1) supplied by the first charge pump (CHP1).</claim-text>
    </claim>
    <claim num="6">
      <claim-text>6. A charge pump structure according to claim 5, characterized in that the second charge pump (CHP2) is formed substantially identical to the first charge pump (CHP1).</claim-text>
    </claim>
    <claim num="7">
      <claim-text>7. A charge pump structure according to claim 5, characterized in that means for supplying the output current (i DELTA 2) of said second charge pump (CHP2) comprises: means for supplying the output current (i DELTA 2) of said second charge pump (CHP2) by the second discharging current source (CS4) when supplying the output current (i DELTA 1) of the first charge pump (CHP1) by the first charging current source (CS1), and means for supplying the output current (i DELTA 2) of said second charge pump (CHP2) by the second charging current source (CS3) when supplying the output current (i DELTA 1) of the first charge pump (CHP1) by the first discharging current source (CS2).</claim-text>
    </claim>
    <claim num="8">
      <claim-text>8. A charge pump structure according to claim 5, characterized in that means (CM) for supplying a reference current (i5) comprises a current mirror, any current conveyor structure, any current or voltage sampler or the like.</claim-text>
    </claim>
    <claim num="9">
      <claim-text>9. A charge pump structure according to claim 5, characterized in that means for supplying the output current (i DELTA 2) of said second charge pump (CHP2) comprises means for continuously supplying the output current (i DELTA 2) of said second charge pump (CHP2) by the second charging current source (CS3) and by the second discharging current source (CS4).</claim-text>
    </claim>
    <claim num="10">
      <claim-text>10. A wireless communication device, which comprises at least a first charge pump (CHP1) comprising a first charging current source (CS1) and a first discharging current source (CS2), and means (SW1, SW2) for supplying the output current (i DELTA 1) of the first charge pump (CHP1) by at least one said current source (CS1, CS2), characterized in that the wireless communication device further comprises: a second charge pump (CHP2) with a second charging current source (CS3) and a second discharging current source (CS4), means (SW3, SW4) for supplying the output current (i DELTA 2) of said second charge pump (CHP2) by at least one said second current source (CS3, CS4), means (CM) for supplying a reference current (i5) on the basis of the output current (i DELTA 2) supplied by said second charge pump (CHP2), and means for combining said reference current (i5) with the output current (i DELTA 1) supplied by the first charge pump (CHP1).</claim-text>
    </claim>
    <claim num="11">
      <claim-text>11. A wireless communication device according to claim 10, characterized in that it is a mobile station.</claim-text>
    </claim>
    <claim num="12">
      <claim-text>12. A wireless communication device according to claim 10, characterized in that it is a base transceiver station.</claim-text>
    </claim>
  </claims>
</questel-patent-document>